<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PTW Register 工作許可紀錄表</title>
<script>window.addEventListener('error',e=>{e.preventDefault();return true});window.addEventListener('unhandledrejection',e=>e.preventDefault());console.log=()=>{};console.warn=()=>{};console.error=()=>{};console.info=()=>{};console.debug=()=>{};</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
#webpack-dev-server-client-overlay,iframe[style*="position: fixed"]{display:none!important}
body>div[style*="position: fixed"][style*="background: rgba"]{display:none!important}
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&family=JetBrains+Mono:wght@500;700&display=swap');
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans TC','Segoe UI',sans-serif;background:#0c1220;color:#e2e8f0}
::-webkit-scrollbar{width:5px;height:5px}
::-webkit-scrollbar-thumb{background:#253552;border-radius:4px}
input:focus,select:focus,textarea:focus{outline:none;border-color:#38bdf8!important;box-shadow:0 0 0 3px rgba(56,189,248,.15)!important}
select option{background:#141e30;color:#e2e8f0}
.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.7);z-index:200;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.editable-cell{min-height:20px;outline:none;cursor:text}
.editable-cell:focus{background:#ffffcc!important;outline:2px solid #38bdf8}
input[type="date"]::-webkit-calendar-picker-indicator{filter:invert(1);cursor:pointer}
@media print{
  @page{size:landscape A3;margin:6mm}
  body{background:#fff!important;color:#000!important;-webkit-print-color-adjust:exact;print-color-adjust:exact}
  .no-print{display:none!important}
  .print-view{display:block!important}
  .print-view table{width:100%;border-collapse:collapse;font-size:10px;page-break-inside:auto}
  .print-view th,.print-view td{border:1.5px solid #333!important;padding:5px 6px!important;color:#000!important;background:#fff!important;word-wrap:break-word!important;overflow-wrap:break-word!important;white-space:normal!important;vertical-align:top}
  .print-view th{background:#e8e8e8!important;font-weight:700!important;white-space:nowrap!important}
  .print-view tr{page-break-inside:avoid}
  .print-view .expired-date{background:#ff4444!important;color:#fff!important;font-weight:700!important}
  .print-view .green-date{color:#16a34a!important;font-weight:700!important}
  .print-view .no-work{text-align:center;color:#888!important;font-style:italic}
  .print-view .print-title{text-align:center;font-size:18px;font-weight:900;margin-bottom:6px;color:#000}
  .print-view .print-sub{text-align:center;font-size:11px;margin-bottom:12px;color:#555}
  .print-view .summary-table td,.print-view .summary-table th{font-size:12px!important;padding:6px 8px!important}
}
/* ===== MOBILE RESPONSIVE ===== */
/* ===== MOBILE: Tablet & Phone ===== */
@media(max-width:768px){
  /* Hide less critical table columns on mobile: 開始日, 申請人, 持有人, 證書 */
  .tbl-hide-m{display:none!important}
  .ptw-table-wrap table{min-width:750px!important;table-layout:auto!important}
  .ptw-table-wrap colgroup{display:none!important}
  .tbl-scroll-spacer{width:750px!important}
  /* --- Header: stack vertically, compact --- */
  .ptw-header{flex-direction:column!important;padding:8px 10px!important;gap:6px!important;align-items:stretch!important}
  .ptw-header .ptw-logo-area{width:100%!important;gap:8px!important}
  .ptw-header .ptw-logo-area .ptw-title-text{font-size:13px!important}
  .ptw-header .ptw-logo-area .ptw-sub-text{font-size:8px!important}
  .ptw-header .ptw-logo-area img:first-child{width:28px!important;height:28px!important}
  .ptw-header .ptw-logo-area img:nth-child(2){height:20px!important}
  .ptw-header .ptw-logo-area .ptw-auth-badge{font-size:9px!important}
  /* --- Nav: horizontal scroll, no wrap --- */
  .ptw-nav{width:100%!important;overflow-x:auto!important;-webkit-overflow-scrolling:touch;flex-wrap:nowrap!important;gap:2px!important;padding:4px 0!important;justify-content:flex-start!important;scrollbar-width:none}
  .ptw-nav::-webkit-scrollbar{display:none}
  .ptw-nav button{padding:7px 12px!important;font-size:11px!important;white-space:nowrap!important;flex-shrink:0!important;min-height:36px!important;border-radius:8px!important}
  .ptw-nav .ptw-sep{display:none!important}
  /* --- Main content area --- */
  .ptw-main{padding:12px 8px!important}
  /* --- Dashboard --- */
  .ptw-dash-header{flex-direction:column!important;gap:10px!important;align-items:stretch!important}
  .ptw-dash-header h2{font-size:16px!important}
  .ptw-dash-controls{width:100%!important;flex-wrap:wrap!important;gap:4px!important;justify-content:center!important}
  .ptw-dash-controls button{font-size:11px!important;padding:6px 10px!important;min-height:34px!important}
  .ptw-dash-controls input[type="date"]{font-size:12px!important;padding:6px 6px!important;min-height:34px!important;width:125px!important}
  .ptw-dash-controls span{font-size:10px!important}
  .ptw-dash-filter{flex-wrap:wrap!important;gap:6px!important;margin-bottom:12px!important}
  .ptw-dash-filter>span{width:100%!important;font-size:11px!important}
  .ptw-dash-filter select{flex:1!important;min-width:0!important;font-size:12px!important;min-height:36px!important;padding:6px 8px!important}
  .ptw-dash-filter button{min-height:36px!important;font-size:11px!important}
  /* --- KPI cards --- */
  .ptw-kpi-grid{grid-template-columns:repeat(2,1fr)!important;gap:8px!important}
  .ptw-kpi-card{padding:12px 10px!important;border-radius:10px!important}
  .ptw-kpi-card .ptw-kpi-val{font-size:22px!important}
  .ptw-kpi-card .ptw-kpi-icon{font-size:28px!important}
  .ptw-kpi-card .ptw-kpi-label{font-size:10px!important}
  .ptw-kpi-card .ptw-kpi-sub{font-size:9px!important}
  /* --- Chart/bar cards --- */
  .ptw-chart-grid{grid-template-columns:1fr!important;gap:10px!important}
  .ptw-chart-card{padding:14px 12px!important}
  /* --- Unclosed lists --- */
  .ptw-unclosed-grid{grid-template-columns:1fr!important}
  /* --- Table view --- */
  .ptw-table-wrap{overflow-x:auto!important;-webkit-overflow-scrolling:touch}
  /* --- Form --- */
  .ptw-form-grid{grid-template-columns:1fr!important}
  /* --- Persons --- */
  .ptw-persons-grid{grid-template-columns:1fr!important}
  /* --- Modals --- */
  .modal-overlay>div,.ptw-modal-box{width:96vw!important;max-width:none!important;padding:16px 12px!important;max-height:90vh!important;border-radius:12px!important}
  .modal-overlay>div input[type="date"]{width:100%!important}
  /* --- Export / Summary --- */
  .ptw-export-btns{flex-wrap:wrap!important;gap:6px!important}
  .ptw-summary-table{min-width:600px!important}
  /* --- Loading overlay text --- */
  .ptw-loading-text{font-size:16px!important}
  .ptw-loading-sub{font-size:12px!important}
  .ptw-loading-icon{font-size:48px!important}
}
/* ===== MOBILE: Small Phone ===== */
@media(max-width:420px){
  .ptw-kpi-grid{grid-template-columns:1fr 1fr!important;gap:6px!important}
  .ptw-kpi-card .ptw-kpi-val{font-size:20px!important}
  .ptw-nav button{padding:6px 9px!important;font-size:10px!important;min-height:32px!important}
  .ptw-header .ptw-logo-area .ptw-title-text{font-size:12px!important}
  .ptw-header .ptw-logo-area .ptw-sub-text{display:none!important}
  .ptw-dash-header h2{font-size:14px!important}
  .ptw-dash-controls input[type="date"]{width:110px!important}
  .ptw-main{padding:10px 4px!important}
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useMemo,useCallback,useEffect,useRef} = React;

const INIT=[{"srNo":0,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-T001","issuingDate":"2025-08-18","closingDate":"2025-08-25","issuingPerson":"PT","startDate":"2025-08-18","validDate":"2025-08-24","applicant":"陳怡君","holder":"陳怡君","supervisor":"-","ehs":"Jeffery","location":"台中工區","workDescription":"吊掛紐澤西護欄","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-000"},{"srNo":1,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-001","issuingDate":"2025-08-20","closingDate":"2025-08-25","issuingPerson":"PT","startDate":"2025-08-21","validDate":"2025-08-27","applicant":"顏正安","holder":"賴仲彥","supervisor":"Nandhu","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"以挖掘機進行工區整地，移除地表雜物，貨櫃吊掛\nLifting, leveling, excavation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-001","coldWork":"CWC-001"},{"srNo":2,"contPtwNo":"PTW-001","applyCompany":"MGT","ptwNumber":"PTW-002","issuingDate":"2025-08-25","closingDate":"2025-09-01","issuingPerson":"PT","startDate":"2025-08-26","validDate":"2025-09-01","applicant":"顏正安","holder":"賴仲彥","supervisor":"Nandhu","ehs":"Jin","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-002","coldWork":"CWC-002"},{"srNo":3,"contPtwNo":"PTW-002","applyCompany":"MGT","ptwNumber":"PTW-003","issuingDate":"2025-09-01","closingDate":"2025-09-08","issuingPerson":"PT","startDate":"2025-09-01","validDate":"2025-09-07","applicant":"顏正安","holder":"賴仲彥","supervisor":"Nandhu","ehs":"Jin","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-003","coldWork":"CWC-003"},{"srNo":4,"contPtwNo":"-","applyCompany":"GW","ptwNumber":"PTW-004","issuingDate":"2025-09-02","closingDate":"2025-09-11","issuingPerson":"PT","startDate":"2025-09-03","validDate":"2025-09-09","applicant":"李尚謙","holder":"羅祥羽","supervisor":"Nandhu","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-004"},{"srNo":5,"contPtwNo":"PTW-003","applyCompany":"MGT","ptwNumber":"PTW-005","issuingDate":"2025-09-08","closingDate":"2025-09-15","issuingPerson":"PT","startDate":"2025-09-08","validDate":"2025-09-14","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Jeffery","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"HWC-001","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-004","coldWork":"CWC-005"},{"srNo":6,"contPtwNo":"PTW-004","applyCompany":"GW","ptwNumber":"PTW-006","issuingDate":"2025-09-09","closingDate":"2025-09-25","issuingPerson":"PT","startDate":"2025-09-10","validDate":"2025-09-16","applicant":"洪正德","holder":"洪正德","supervisor":"Mr. Chung","ehs":"Jeffery","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-005","coldWork":"CWC-006"},{"srNo":7,"contPtwNo":"-","applyCompany":"KaoShen","ptwNumber":"PTW-007","issuingDate":"2025-09-15","closingDate":"2025-09-22","issuingPerson":"PT","startDate":"2025-09-15","validDate":"2025-09-21","applicant":"嚴正愷","holder":"嚴正愷","supervisor":"Eason","ehs":"Jin","location":"Taichung & TungHsiao","workDescription":"施工告示牌施作\nConstruction board installation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-006","coldWork":"CWC-007"},{"srNo":8,"contPtwNo":"PTW-005","applyCompany":"MGT","ptwNumber":"PTW-008","issuingDate":"2025-09-15","closingDate":"2025-09-22","issuingPerson":"PT","startDate":"2025-09-15","validDate":"2025-09-21","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Kong","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"HWC-002","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-007","coldWork":"CWC-008"},{"srNo":9,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-009","issuingDate":"2025-09-16","closingDate":"2025-09-25","issuingPerson":"PT","startDate":"2025-09-16","validDate":"2025-09-22","applicant":"顏正安","holder":"李宜恩","supervisor":"Mr. Bai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"Material lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-009"},{"srNo":10,"contPtwNo":"PTW-006","applyCompany":"GW","ptwNumber":"PTW-010","issuingDate":"2025-09-16","closingDate":"2025-09-25","issuingPerson":"PT","startDate":"2025-09-17","validDate":"2025-09-23","applicant":"李尚謙","holder":"嚴心衛","supervisor":"Mr. Chung","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-008","coldWork":"CWC-010"},{"srNo":11,"contPtwNo":"PTW-008","applyCompany":"MGT","ptwNumber":"PTW-011","issuingDate":"2025-09-22","closingDate":"2025-09-30","issuingPerson":"PT","startDate":"2025-09-22","validDate":"2025-09-28","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Jeffery","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"HWC-003","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-009","coldWork":"CWC-011"},{"srNo":12,"contPtwNo":"PTW-009","applyCompany":"MGT","ptwNumber":"PTW-012","issuingDate":"2025-09-22","closingDate":"2025-09-30","issuingPerson":"PT","startDate":"2025-09-22","validDate":"2025-09-28","applicant":"蔡孟娟","holder":"周泰安","supervisor":"Mr. Bai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"Material lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-012"},{"srNo":13,"contPtwNo":"PTW-010","applyCompany":"GW","ptwNumber":"PTW-013","issuingDate":"2025-09-24","closingDate":"2025-10-08","issuingPerson":"RH","startDate":"2025-09-24","validDate":"2025-09-30","applicant":"許雅婷","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-010","coldWork":"CWC-013"},{"srNo":14,"contPtwNo":"PTW-011","applyCompany":"MGT","ptwNumber":"PTW-014","issuingDate":"2025-09-26","closingDate":"2025-10-02","issuingPerson":"PT","startDate":"2025-09-28","validDate":"2025-10-04","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Jeffery","location":"台中工區\nTaichung","workDescription":"挖掘機開挖整地、圍籬吊掛作業、臨時工務所吊掛、現場圍籬放樣 Fencing, Lifting, excavation, leveling","hotWork":"HWC-004","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-014"},{"srNo":15,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-015","issuingDate":"2025-09-30","closingDate":"2025-10-02","issuingPerson":"PT","startDate":"2025-09-30","validDate":"2025-10-06","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Jeffery","location":"台中工區\nTaichung","workDescription":"現場辦公室貨櫃吊掛 Lifting for site office container","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-015"},{"srNo":16,"contPtwNo":"PTW-013","applyCompany":"GW","ptwNumber":"PTW-016","issuingDate":"2025-09-30","closingDate":"2025-10-09","issuingPerson":"PT","startDate":"2025-10-01","validDate":"2025-10-07","applicant":"許雅婷","holder":"嚴心衛","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-011","coldWork":"CWC-016"},{"srNo":17,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-017","issuingDate":"2025-10-03","closingDate":"2025-10-03","issuingPerson":"PT","startDate":"2025-10-03","validDate":"2025-10-09","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr. Bai","ehs":"Jin","location":"台中工區\nTaichung","workDescription":"圍籬浪板更換","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-017"},{"srNo":18,"contPtwNo":"PTW-016","applyCompany":"GW","ptwNumber":"PTW-018","issuingDate":"2025-10-08","closingDate":"2025-10-16","issuingPerson":"PT","startDate":"2025-10-08","validDate":"2025-10-14","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jet","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-012","coldWork":"CWC-018"},{"srNo":19,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-019","issuingDate":"2025-10-09","closingDate":"2025-10-09","issuingPerson":"PT","startDate":"2025-10-09","validDate":"2025-10-09","applicant":"顏正安","holder":"周泰安","supervisor":"Mr. Bai","ehs":"Paul","location":"管線暫置區\nPipeline stroage area","workDescription":"板車載運入場、堆高機協助、現場人員協助配料\nMaterial delivery, forklift opeartion","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-019"},{"srNo":20,"contPtwNo":"PTW-018","applyCompany":"GW","ptwNumber":"PTW-020","issuingDate":"2025-10-13","closingDate":"2025-10-28","issuingPerson":"PT","startDate":"2025-10-15","validDate":"2025-10-21","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-013","coldWork":"CWC-020"},{"srNo":21,"contPtwNo":"-","applyCompany":"Hi-E","ptwNumber":"PTW-021","issuingDate":"2025-10-20","closingDate":"2025-10-28","issuingPerson":"PT","startDate":"2025-10-21","validDate":"2025-10-27","applicant":"邱禹睿","holder":"賴奕杰","supervisor":"Eason","ehs":"Jin","location":"台中工區\nTaichung","workDescription":"Trail pit excavation 試挖井開挖作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-014","coldWork":"CWC-021"},{"srNo":22,"contPtwNo":"PTW-020","applyCompany":"GW","ptwNumber":"PTW-022","issuingDate":"2025-10-21","closingDate":"2025-11-08","issuingPerson":"PT","startDate":"2025-10-22","validDate":"2025-10-28","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jet","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-015","coldWork":"CWC-022"},{"srNo":23,"contPtwNo":"PTW-021","applyCompany":"Hi-E","ptwNumber":"PTW-023","issuingDate":"2025-10-27","closingDate":"2025-11-10","issuingPerson":"PT","startDate":"2025-10-27","validDate":"2025-11-02","applicant":"邱禹睿","holder":"賴奕杰","supervisor":"Katherine","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"Trail pit excavation 試挖井開挖作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-016","coldWork":"CWC-023"},{"srNo":24,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-024","issuingDate":"2025-10-28","closingDate":"2025-10-30","issuingPerson":"PT","startDate":"2025-10-28","validDate":"2025-11-03","applicant":"顏正安","holder":"賴仲彥","supervisor":"Mr.Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"圍籬試挖區拆除作業、吊鋼板 Lifting steel plate, fence remove","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-024"},{"srNo":25,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-025","issuingDate":"2025-10-28","closingDate":"2025-10-28","issuingPerson":"PT","startDate":"2025-10-28","validDate":"2025-11-03","applicant":"童保舜","holder":"Mr. Cheng","supervisor":"Mr. Cheng","ehs":"Wilson","location":"通霄工區\nTong Hsiao","workDescription":"貨櫃吊掛作業 Container lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-025"},{"srNo":26,"contPtwNo":"PTW-022","applyCompany":"GW","ptwNumber":"PTW-026","issuingDate":"2025-10-28","closingDate":"2025-11-11","issuingPerson":"PT","startDate":"2025-10-29","validDate":"2025-11-04","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-017","coldWork":"CWC-026"},{"srNo":27,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-027","issuingDate":"2025-10-29","closingDate":"2025-11-04","issuingPerson":"PT","startDate":"2025-10-29","validDate":"2025-11-04","applicant":"李宜恩","holder":"周泰安","supervisor":"Mr. Pai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"吊掛12m 管線 (5tons) Lifting 12m pipeline (5tons)","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-027"},{"srNo":28,"contPtwNo":"-","applyCompany":"Amtie","ptwNumber":"PTW-028","issuingDate":"2025-10-29","closingDate":"2025-11-07","issuingPerson":"PT","startDate":"2025-10-29","validDate":"2025-11-04","applicant":"黃柏鈞","holder":"黃柏鈞","supervisor":"Mr. Pai","ehs":"Wilson","location":"台中工區\nTaichung","workDescription":"CCTV 門禁貨櫃吊掛 Container lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-028"},{"srNo":29,"contPtwNo":"-","applyCompany":"Hi-E","ptwNumber":"PTW-029","issuingDate":"2025-11-03","closingDate":"2025-11-10","issuingPerson":"PT","startDate":"2025-11-04","validDate":"2025-11-10","applicant":"邱禹睿","holder":"徐凱鵬","supervisor":"Eason","ehs":"Jeffrey","location":"通霄工區\nTong Hsiao","workDescription":"圍籬組立、試挖坑挖掘 Fence installation, trail pit excavation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-018","coldWork":"CWC-029"},{"srNo":30,"contPtwNo":"-","applyCompany":"Hi-E","ptwNumber":"PTW-030","issuingDate":"2025-11-03","closingDate":"2025-11-09","issuingPerson":"PT","startDate":"2025-11-04","validDate":"2025-11-10","applicant":"邱禹睿","holder":"賴奕杰","supervisor":"Eason","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"挖沉砂挖掘、環場水路、洗車台、整地、吊掛作業\nExcavation grit tank, trench, car wast station, leveling, lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-019","coldWork":"CWC-030"},{"srNo":31,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-031","issuingDate":"2025-11-03","closingDate":"2025-11-04","issuingPerson":"PT","startDate":"2025-11-03","validDate":"2025-11-09","applicant":"Mr.Pai","holder":"Mr.Pai","supervisor":"Mr.Pai","ehs":"Jeffery","location":"台中工區\nTaichung","workDescription":"鐵板吊掛作業 Steel plate lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-031"},{"srNo":32,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-032","issuingDate":"2025-11-04","closingDate":"2025-11-04","issuingPerson":"PT","startDate":"2025-11-04","validDate":"2025-11-04","applicant":"Mr. Cheng","holder":"Mr. Cheng","supervisor":"Mr. Cheng","ehs":"Jeffery","location":"通霄工區\nTong Hsiao","workDescription":"貨櫃吊掛作業 Container lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CEC-032"},{"srNo":33,"contPtwNo":"26","applyCompany":"GW","ptwNumber":"PTW-033","issuingDate":"2025-11-04","closingDate":"2025-11-18","issuingPerson":"PT","startDate":"2025-11-05","validDate":"2025-11-11","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-020","coldWork":"CEC-033"},{"srNo":34,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-034","issuingDate":"2025-11-04","closingDate":"2025-11-17","issuingPerson":"PT","startDate":"2025-11-06","validDate":"2025-11-12","applicant":"顏正安","holder":"黃紹宸","supervisor":"Eason","ehs":"Jeffrey","location":"管線暫置區\nPipeline stroage area","workDescription":"吊掛20尺貨櫃 Lifting 20\" container、焊接動火作業 Welding hot work","hotWork":"HWC-001","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CEC-034"},{"srNo":35,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-035","issuingDate":"2025-11-05","closingDate":"2025-11-07","issuingPerson":"PT","startDate":"2025-11-06","validDate":"2025-11-12","applicant":"Pai","holder":"Pai","supervisor":"Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"吊掛40尺貨櫃 Lifting 40\" container、","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CEC-035"},{"srNo":36,"contPtwNo":"-","applyCompany":"Amtie","ptwNumber":"PTW-036","issuingDate":"2025-11-07","closingDate":"2025-11-17","issuingPerson":"PT","startDate":"2025-11-13","validDate":"2025-11-19","applicant":"黃柏鈞","holder":"黃柏鈞","supervisor":"Kevin","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"CCTV 裝設作業  CCTV installation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-036"},{"srNo":37,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-037","issuingDate":"2025-11-09","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-10","validDate":"2025-11-16","applicant":"白閔億","holder":"白閔億","supervisor":"Vicky","ehs":"Jeffrey","location":"台中港106碼頭","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-037"},{"srNo":38,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-038","issuingDate":"2025-11-09","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-10","validDate":"2025-11-16","applicant":"楊琮閔","holder":"楊琮閔","supervisor":"Vicky","ehs":"Jeffrey","location":"管線暫置區\nPipeline stroage area","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-038"},{"srNo":39,"contPtwNo":"29","applyCompany":"Hi-E","ptwNumber":"PTW-039","issuingDate":"2025-11-10","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-10","validDate":"2025-11-16","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Pai","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"圍籬組立、試挖坑挖掘 Fence installation, trail pit excavation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-021","coldWork":"CWC-039"},{"srNo":40,"contPtwNo":"30","applyCompany":"Hi-E","ptwNumber":"PTW-040","issuingDate":"2025-11-10","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-10","validDate":"2025-11-16","applicant":"徐凱鵬","holder":"賴奕杰","supervisor":"Pai","ehs":"Elson","location":"台中工區\nTaichung","workDescription":"挖沉砂挖掘、環場水路、洗車台、整地、吊掛作業\nExcavation grit tank, trench, car wast station, leveling, lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-022","coldWork":"CWC-040"},{"srNo":41,"contPtwNo":"33","applyCompany":"GW","ptwNumber":"PTW-041","issuingDate":"2025-11-11","closingDate":"2025-11-24","issuingPerson":"PT","startDate":"2025-11-12","validDate":"2025-11-18","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-023","coldWork":"CWC-041"},{"srNo":42,"contPtwNo":"34","applyCompany":"MGT","ptwNumber":"PTW-042","issuingDate":"2025-11-11","closingDate":"2025-11-28","issuingPerson":"PT","startDate":"2025-11-12","validDate":"2025-11-18","applicant":"黃紹宸","holder":"黃紹宸","supervisor":"Kevin","ehs":"Noah","location":"管線暫置區\nPipeline stroage area","workDescription":"管線吊運及包覆作業 Pipeline lifting and coating opeartion","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-042"},{"srNo":43,"contPtwNo":"37","applyCompany":"GAC","ptwNumber":"PTW-043","issuingDate":"2025-11-09","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-15","validDate":"2025-11-21","applicant":"白閔億","holder":"白閔億","supervisor":"Evan","ehs":"Kong","location":"台中港106碼頭","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-043"},{"srNo":44,"contPtwNo":"38","applyCompany":"GAC","ptwNumber":"PTW-044","issuingDate":"2025-11-09","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-15","validDate":"2025-11-21","applicant":"楊琮閔","holder":"楊琮閔","supervisor":"Evan","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-044"},{"srNo":45,"contPtwNo":"40","applyCompany":"Hi-E","ptwNumber":"PTW-045","issuingDate":"2025-11-17","closingDate":"2025-11-24","issuingPerson":"PT","startDate":"2025-11-17","validDate":"2025-11-23","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Eason","ehs":"Wilson","location":"台中工區\nTaichung","workDescription":"挖沉砂挖掘、環場水路、洗車台、整地、吊掛作業\nExcavation grit tank, trench, car wast station, leveling, lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-024","coldWork":"CWC-045"},{"srNo":46,"contPtwNo":"39","applyCompany":"Hi-E","ptwNumber":"PTW-046","issuingDate":"2025-11-17","closingDate":"2025-11-21","issuingPerson":"PT","startDate":"2025-11-17","validDate":"2025-11-23","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Eason","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"圍籬組立、試挖坑挖掘 Fence installation, trail pit excavation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-025","coldWork":"CWC-046"},{"srNo":47,"contPtwNo":"41","applyCompany":"GW","ptwNumber":"PTW-047","issuingDate":"2025-11-17","closingDate":"2025-11-28","issuingPerson":"PT","startDate":"2025-11-19","validDate":"2025-11-25","applicant":"胡正德","holder":"胡正德","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-026","coldWork":"CWC-047"},{"srNo":48,"contPtwNo":"36","applyCompany":"Amtie","ptwNumber":"PTW-048","issuingDate":"2025-11-18","closingDate":"2025-12-01","issuingPerson":"PT","startDate":"2025-11-18","validDate":"2025-11-24","applicant":"黃柏翔","holder":"黃柏翔","supervisor":"Kevin","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"CCTV 裝設、太陽能板安裝、線路測試\nCCTV installation, solar panel, line testing","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-048"},{"srNo":49,"contPtwNo":"42","applyCompany":"MGT","ptwNumber":"PTW-049","issuingDate":"2025-11-20","closingDate":"2025-11-28","issuingPerson":"PT","startDate":"2025-11-21","validDate":"2025-11-27","applicant":"黃紹宸","holder":"黃紹宸","supervisor":"Kevin","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"包覆作業、管線吊運作業、電銲作業、有機溶劑處理\nCoating, Lifting, Welding, Chemical","hotWork":"HWC-002","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-049"},{"srNo":50,"contPtwNo":"43","applyCompany":"GAC","ptwNumber":"PTW-050","issuingDate":"2025-11-21","closingDate":"2025-11-24","issuingPerson":"PT","startDate":"2025-11-22","validDate":"2025-11-28","applicant":"白閔億","holder":"白閔億","supervisor":"Evan","ehs":"Kong","location":"台中港106碼頭","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-050"},{"srNo":51,"contPtwNo":"44","applyCompany":"GAC","ptwNumber":"PTW-051","issuingDate":"2025-11-21","closingDate":"2025-11-24","issuingPerson":"PT","startDate":"2025-11-22","validDate":"2025-11-28","applicant":"鄭書凱","holder":"楊武智\n林慰欽","supervisor":"0","ehs":"Sue","location":"管線暫置區\nPipeline stroage area","workDescription":"天然氣管線卸貨吊掛作業 Pipeline offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-027","coldWork":"CWC-051"},{"srNo":52,"contPtwNo":"45","applyCompany":"Hi-E","ptwNumber":"PTW-052","issuingDate":"2025-11-21","closingDate":"2025-12-05","issuingPerson":"PT","startDate":"2025-11-24","validDate":"2025-11-30","applicant":"徐凱鵬","holder":"賴奕杰","supervisor":"Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"環場水道開挖、洗車台施作、防塵網覆蓋、沉砂池施作","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-028","coldWork":"CWC-052"},{"srNo":53,"contPtwNo":"46","applyCompany":"Hi-E","ptwNumber":"PTW-053","issuingDate":"2025-11-24","closingDate":"2025-12-03","issuingPerson":"PT","startDate":"2025-11-24","validDate":"2025-11-30","applicant":"徐凱鵬","holder":"許岱揚","supervisor":"Mr. Cheng","ehs":"Jeffrey","location":"通霄電廠\nTungHsiao power plant","workDescription":"試挖、防塵網覆蓋、路燈吊掛作業 Trail pit excavation, anti-dust net, lifting operation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-029","coldWork":"CWC-053"},{"srNo":54,"contPtwNo":"47","applyCompany":"GW","ptwNumber":"PTW-054","issuingDate":"2025-11-24","closingDate":"2025-12-13","issuingPerson":"PT","startDate":"2025-11-26","validDate":"2025-12-02","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Jeffrey","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-030","coldWork":"CWC-054"},{"srNo":55,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-055","issuingDate":"2025-11-27","closingDate":"2026-01-19","issuingPerson":"PT","startDate":"2025-11-27","validDate":"2025-12-03","applicant":"顏正安","holder":"黃紹宸","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"鐵板吊掛作業 Steel plate lifting","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-055"},{"srNo":56,"contPtwNo":"49","applyCompany":"MGT","ptwNumber":"PTW-056","issuingDate":"2025-11-28","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2025-11-28","validDate":"2025-12-04","applicant":"顏正安","holder":"黃紹宸","supervisor":"Hunter","ehs":"Jeffrey","location":"管線暫置區\nPipeline stroage area","workDescription":"管線包覆、吊掛及化學品作業Pipe coating, lifting, checmical operation","hotWork":"HWC-003","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-056"},{"srNo":57,"contPtwNo":"-","applyCompany":"Hi-E","ptwNumber":"PTW-057","issuingDate":"2025-11-28","closingDate":"2025-12-08","issuingPerson":"PT","startDate":"2025-11-28","validDate":"2025-12-04","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"鋼板樁施工作業、電焊、吊掛作業 Sheet pilling, welding, liftring","hotWork":"HWC-004","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-031","coldWork":"CWC-057"},{"srNo":58,"contPtwNo":"52","applyCompany":"Hi-E","ptwNumber":"PTW-058","issuingDate":"2025-12-01","closingDate":"2025-12-08","issuingPerson":"PT","startDate":"2025-12-01","validDate":"2025-12-07","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"環場水道作業、吊掛作業、整地作業、沉砂池施作","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-032","coldWork":"CWC-058"},{"srNo":59,"contPtwNo":"48","applyCompany":"Amtie","ptwNumber":"PTW-059","issuingDate":"2025-11-28","closingDate":"2025-12-04","issuingPerson":"PT","startDate":"2025-11-28","validDate":"2025-12-04","applicant":"黃柏翔","holder":"黃柏翔","supervisor":"Kevin","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"CCTV 裝設、太陽能板安裝、線路測試\nCCTV installation, solar panel, line testing","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-059"},{"srNo":60,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-060","issuingDate":"2025-12-02","closingDate":"2025-12-16","issuingPerson":"PT","startDate":"2025-12-02","validDate":"2025-12-08","applicant":"黃紹宸","holder":"黃紹宸","supervisor":"Hunter","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"運土作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-060"},{"srNo":61,"contPtwNo":"54","applyCompany":"GW","ptwNumber":"PTW-061","issuingDate":"2025-12-02","closingDate":"2025-12-13","issuingPerson":"PT","startDate":"2025-12-03","validDate":"2025-12-09","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"汙濁防止膜、回填、地工織布、護岸鋪設施工\nSilt curtain, backfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-033","coldWork":"CWC-61"},{"srNo":62,"contPtwNo":"53","applyCompany":"Hi-E","ptwNumber":"PTW-062","issuingDate":"2025-12-03","closingDate":"2025-12-06","issuingPerson":"PT","startDate":"2025-12-04","validDate":"2025-12-10","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄電廠\nTungHsiao power plant","workDescription":"消防管盲封試挖、防塵網覆蓋、警示區圈圍","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-034","coldWork":"CWC-062"},{"srNo":63,"contPtwNo":"57","applyCompany":"Hi-E","ptwNumber":"PTW-063","issuingDate":"2025-12-05","closingDate":"2025-12-13","issuingPerson":"PT","startDate":"2025-12-05","validDate":"2025-12-11","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"鋼板樁施工作業、電焊、吊掛作業 Sheet pilling, welding, liftring","hotWork":"HWC-005","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-035","coldWork":"CWC-063"},{"srNo":64,"contPtwNo":"61","applyCompany":"GW","ptwNumber":"PTW-064","issuingDate":"2025-12-06","closingDate":"2025-12-28","issuingPerson":"PT","startDate":"2025-12-10","validDate":"2025-12-16","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"回填、地工織布、護岸鋪設施工\nbackfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-036","coldWork":"CWC-064"},{"srNo":65,"contPtwNo":"60","applyCompany":"MGT","ptwNumber":"PTW-065","issuingDate":"2025-12-06","closingDate":"2025-12-16","issuingPerson":"PT","startDate":"2025-12-06","validDate":"2025-12-12","applicant":"蔡孟娟","holder":"黃紹宸","supervisor":"Kevin","ehs":"Noah","location":"管線暫置區\nPipeline stroage area","workDescription":"管線包覆、吊掛及化學品作業Pipe coating, lifting, checmical operation","hotWork":"HWC-006","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-065"},{"srNo":66,"contPtwNo":"62","applyCompany":"Hi-E","ptwNumber":"PTW-066","issuingDate":"2025-12-06","closingDate":"2025-12-10","issuingPerson":"PT","startDate":"2025-12-08","validDate":"2025-12-14","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Mr.cheng","ehs":"Elson","location":"通霄電廠\nTungHsiao power plant","workDescription":"消防管盲封試挖、防塵網覆蓋、警示區圈圍","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-037","coldWork":"CWC-066"},{"srNo":67,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-067","issuingDate":"2025-12-08","closingDate":"2025-12-16","issuingPerson":"PT","startDate":"2025-12-08","validDate":"2025-12-14","applicant":"黃紹宸","holder":"黃紹宸","supervisor":"Mr. Pai","ehs":"Wilson","location":"台中工區\nTaichung","workDescription":"開挖作業、HDD試鑽、吊掛管材","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-038","coldWork":"CWC-067"},{"srNo":68,"contPtwNo":"63","applyCompany":"Hi-E","ptwNumber":"PTW-068","issuingDate":"2025-12-08","closingDate":"2025-12-13","issuingPerson":"PT","startDate":"2025-12-08","validDate":"2025-12-14","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"環場水道作業、吊掛作業、整地作業、沉砂池施作","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-039","coldWork":"CWC-068"},{"srNo":69,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-069","issuingDate":"2025-12-12","closingDate":"2025-12-28","issuingPerson":"PT","startDate":"2025-12-12","validDate":"2025-12-18","applicant":"倪紹能","holder":"倪紹能","supervisor":"Mr. Pai","ehs":"Jet","location":"管線暫置區\nPipeline stroage area","workDescription":"管線運輸 Pipeling Transporation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-069"},{"srNo":70,"contPtwNo":"68","applyCompany":"Hi-E","ptwNumber":"PTW-070","issuingDate":"2025-12-13","closingDate":"2026-01-17","issuingPerson":"PT","startDate":"2025-12-15","validDate":"2025-12-21","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"環場水道作業、沉砂池施作、洗車台","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-040","coldWork":"CWC-070"},{"srNo":71,"contPtwNo":"63","applyCompany":"Hi-E","ptwNumber":"PTW-071","issuingDate":"2025-12-13","closingDate":"2026-01-17","issuingPerson":"PT","startDate":"2025-12-15","validDate":"2025-12-21","applicant":"徐雅誼","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"鋼板樁施工作業、電焊、吊掛作業 Sheet pilling, welding, liftring","hotWork":"HWC-007","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-041","coldWork":"CWC-071"},{"srNo":72,"contPtwNo":"64","applyCompany":"GW","ptwNumber":"PTW-072","issuingDate":"2025-12-13","closingDate":"2025-12-28","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"回填、地工織布、護岸鋪設施工\nbackfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-042","coldWork":"CWC-072"},{"srNo":73,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-073","issuingDate":"2025-12-16","closingDate":"2025-12-22","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"鄭書凱","holder":"楊武智","supervisor":"Vicky","ehs":"Wilson","location":"103號馬頭","workDescription":"Pipe offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-073"},{"srNo":74,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-074","issuingDate":"2025-12-16","closingDate":"2025-12-22","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"鄭書凱","holder":"楊琮閔","supervisor":"Vicky","ehs":"Wilson","location":"管線暫置區\nPipeline stroage area","workDescription":"Pipe offloading","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-074"},{"srNo":75,"contPtwNo":"-","applyCompany":"EGST","ptwNumber":"PTW-075","issuingDate":"2025-12-16","closingDate":"2025-12-26","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"Hunter","holder":"Hunter","supervisor":"Hunter","ehs":"Wilson","location":"通霄電廠\nTungHsiao power plant","workDescription":"鑽測機搬運、試鑽工作","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-043","coldWork":"CWC-075"},{"srNo":76,"contPtwNo":"67","applyCompany":"MGT","ptwNumber":"PTW-076","issuingDate":"2025-12-16","closingDate":"2025-12-22","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"蔡孟娟","holder":"黃紹宸","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"Taichung","workDescription":"HDD 設備架設、挖掘、試鑽作業、吊掛管材","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-044","coldWork":"CWC-076"},{"srNo":77,"contPtwNo":"65","applyCompany":"MGT","ptwNumber":"PTW-077","issuingDate":"2025-12-16","closingDate":"2025-12-22","issuingPerson":"PT","startDate":"2025-12-16","validDate":"2025-12-22","applicant":"蔡孟娟","holder":"蔡孟娟","supervisor":"Mr. Pai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-008","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-077"},{"srNo":78,"contPtwNo":"71","applyCompany":"Hi-E","ptwNumber":"PTW-078","issuingDate":"2025-12-18","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-22","validDate":"2025-12-28","applicant":"邱禹睿","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"鋼板樁作業 Sheet pilling","hotWork":"HWC-009","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-045","coldWork":"CWC-078"},{"srNo":79,"contPtwNo":"70","applyCompany":"Hi-E","ptwNumber":"PTW-079","issuingDate":"2025-12-18","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-22","validDate":"2025-12-28","applicant":"邱禹睿","holder":"賴奕杰","supervisor":"Mr. Pai","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台 Grit tank, trench, car wash station","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-046","coldWork":"CWC-079"},{"srNo":80,"contPtwNo":"72","applyCompany":"GW","ptwNumber":"PTW-080","issuingDate":"2025-12-18","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2025-12-23","validDate":"2025-12-29","applicant":"胡正得","holder":"胡正得","supervisor":"Hunter","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"回填、地工織布、護岸鋪設施工\nbackfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-047","coldWork":"CWC-080"},{"srNo":81,"contPtwNo":"-","applyCompany":"Hi-E","ptwNumber":"PTW-081","issuingDate":"2025-12-19","closingDate":"2025-12-29","issuingPerson":"PT","startDate":"2025-12-20","validDate":"2025-12-26","applicant":"賴奕杰","holder":"邱禹睿","supervisor":"Hunter","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"沉砂池及環場水路開挖 Excavation of grit tank and trench","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-048","coldWork":"CWC-081"},{"srNo":82,"contPtwNo":"76","applyCompany":"MGT","ptwNumber":"PTW-082","issuingDate":"2025-12-22","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-22","validDate":"2025-12-28","applicant":"蔡孟娟","holder":"Sam","supervisor":"Mr.pai","ehs":"Noah","location":"Taichung","workDescription":"HDD 設備架設、挖掘、試鑽作業、吊掛管材","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-049","coldWork":"CWC-082"},{"srNo":83,"contPtwNo":"77","applyCompany":"MGT","ptwNumber":"PTW-083","issuingDate":"2025-12-22","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-22","validDate":"2025-12-28","applicant":"蔡孟娟","holder":"蔡孟娟","supervisor":"Mr.pai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-010","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-083"},{"srNo":84,"contPtwNo":"83","applyCompany":"MGT","ptwNumber":"PTW-084","issuingDate":"2025-12-26","closingDate":"2026-01-19","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"邱小語","holder":"蔡孟娟","supervisor":"Mr.pai","ehs":"Noah","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-011","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-084"},{"srNo":85,"contPtwNo":"75","applyCompany":"EGST","ptwNumber":"PTW-085","issuingDate":"2025-12-22","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-23","validDate":"2025-12-29","applicant":"Hunter","holder":"Hunter","supervisor":"Hunter","ehs":"Jin","location":"通霄電廠\nTungHsiao power plant","workDescription":"鑽測機搬運、試鑽工作","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-050","coldWork":"CWC-085"},{"srNo":86,"contPtwNo":"82","applyCompany":"MGT","ptwNumber":"PTW-086","issuingDate":"2025-12-26","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"邱小語","holder":"黃紹宸","supervisor":"Mr.pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"HDD 設備架設、挖掘、試鑽作業、吊掛管材","hotWork":"HWC-012","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-051","coldWork":"CWC-086"},{"srNo":87,"contPtwNo":"78","applyCompany":"Hi-E","ptwNumber":"PTW-087","issuingDate":"2025-12-26","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr.pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"鋼板樁作業 Sheet pilling","hotWork":"HWC-013","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-052","coldWork":"CWC-087"},{"srNo":88,"contPtwNo":"79","applyCompany":"Hi-E","ptwNumber":"PTW-088","issuingDate":"2025-12-26","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr.pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台 Grit tank, trench, car wash station","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-053","coldWork":"CWC-088"},{"srNo":89,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-089","issuingDate":"2025-12-29","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"鄭書凱","holder":"李志國、陳怡如、曹梗誠","supervisor":"Jamie","ehs":"Noah","location":"37號馬頭\nBerth 37","workDescription":"後線布置 Sand bag preperation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-089"},{"srNo":90,"contPtwNo":"81","applyCompany":"Hi-E","ptwNumber":"PTW-090","issuingDate":"2025-12-29","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-29","validDate":"2026-01-04","applicant":"賴奕杰","holder":"邱禹睿","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"沉砂池及環場水路開挖 Excavation of grit tank and trench","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-054","coldWork":"CWC-090"},{"srNo":91,"contPtwNo":"85","applyCompany":"EGST","ptwNumber":"PTW-091","issuingDate":"2025-12-29","closingDate":"2026-01-05","issuingPerson":"PT","startDate":"2025-12-30","validDate":"2026-01-05","applicant":"Hunter","holder":"Hunter","supervisor":"Hunter","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"Geological survey 地質鑽探","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-055","coldWork":"CWC-091"},{"srNo":92,"contPtwNo":"80","applyCompany":"GW","ptwNumber":"PTW-092","issuingDate":"2025-12-30","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2025-12-31","validDate":"2026-01-06","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"回填、地工織布、護岸鋪設施工\nbackfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-056","coldWork":"CWC-092"},{"srNo":93,"contPtwNo":"89","applyCompany":"GAC","ptwNumber":"PTW-093","issuingDate":"2026-01-03","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2026-01-06","validDate":"2026-01-12","applicant":"李永源","holder":"劉耀駿","supervisor":"Vicky","ehs":"Kong","location":"37號馬頭\nBerth 37","workDescription":"後線布置 Sand bag preperation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-093"},{"srNo":94,"contPtwNo":"91","applyCompany":"EGST","ptwNumber":"PTW-094","issuingDate":"2026-01-03","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2026-01-06","validDate":"2026-01-12","applicant":"Hunter","holder":"Hunter","supervisor":"Hunter","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"Geological survey 地質鑽探","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-057","coldWork":"CWC-094"},{"srNo":95,"contPtwNo":"86","applyCompany":"MGT","ptwNumber":"PTW-095","issuingDate":"2026-01-05","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-01-05","validDate":"2026-01-11","applicant":"蔡孟娟","holder":"黃紹宸","supervisor":"Kevin","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"HDD 設備架設、挖掘、試鑽作業、吊掛管材","hotWork":"HWC-014","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-058","coldWork":"CWC-095"},{"srNo":96,"contPtwNo":"84","applyCompany":"MGT","ptwNumber":"PTW-096","issuingDate":"2026-01-05","closingDate":"2026-01-19","issuingPerson":"PT","startDate":"2026-01-05","validDate":"2026-01-11","applicant":"蔡孟娟","holder":"蔡孟娟","supervisor":"Kevin","ehs":"Noah","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-015","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-096"},{"srNo":97,"contPtwNo":"90","applyCompany":"Hi-E","ptwNumber":"PTW-097","issuingDate":"2026-01-05","closingDate":"2026-01-10","issuingPerson":"PT","startDate":"2026-01-05","validDate":"2026-01-11","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"沉砂池及環場水路開挖 Excavation of grit tank and trench","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-059","coldWork":"CWC-097"},{"srNo":98,"contPtwNo":"92","applyCompany":"GW","ptwNumber":"PTW-098","issuingDate":"2026-01-05","closingDate":"2026-01-16","issuingPerson":"PT","startDate":"2026-01-07","validDate":"2026-01-13","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"回填、地工織布、護岸鋪設施工、防塵網鋪設\nbackfill, geoxtile, laying","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-060","coldWork":"CWC-098"},{"srNo":99,"contPtwNo":"87","applyCompany":"Hi-E","ptwNumber":"PTW-099","issuingDate":"2026-01-05","closingDate":"2026-01-17","issuingPerson":"PT","startDate":"2026-01-05","validDate":"2026-01-11","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr.pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"鋼板樁作業 Sheet pilling","hotWork":"HWC-016","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-061","coldWork":"CWC-099"},{"srNo":100,"contPtwNo":"88","applyCompany":"Hi-E","ptwNumber":"PTW-100","issuingDate":"2026-01-05","closingDate":"2026-01-17","issuingPerson":"PT","startDate":"2026-01-05","validDate":"2026-01-11","applicant":"賴奕杰","holder":"賴奕杰","supervisor":"Mr.pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台 Grit tank, trench, car wash station","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-062","coldWork":"CWC-100"},{"srNo":101,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-101","issuingDate":"2026-01-07","closingDate":"2026-01-15","issuingPerson":"PT","startDate":"2026-01-08","validDate":"2026-01-14","applicant":"陳怡如","holder":"周以宸","supervisor":"Jamie","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"管線蓋子拆封安裝","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-101"},{"srNo":102,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-102","issuingDate":"2026-01-09","closingDate":"2026-01-09","issuingPerson":"PT","startDate":"2026-01-09","validDate":"2026-01-09","applicant":"陳怡如","holder":"宋宸憲","supervisor":"Vicky","ehs":"Wilson","location":"管線暫置區\nPipeline stroage area","workDescription":"加油作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-102"},{"srNo":103,"contPtwNo":"95","applyCompany":"MGT","ptwNumber":"PTW-103","issuingDate":"2026-01-12","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-01-12","validDate":"2026-01-18","applicant":"蔡孟娟","holder":"黃紹宸","supervisor":"Vicky","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"HDD 設備架設、挖掘、試鑽作業、吊掛管材","hotWork":"HWC-017","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-063","coldWork":"CWC-103"},{"srNo":104,"contPtwNo":"96","applyCompany":"MGT","ptwNumber":"PTW-104","issuingDate":"2026-01-12","closingDate":"2026-01-19","issuingPerson":"PT","startDate":"2026-01-12","validDate":"2026-01-18","applicant":"蔡孟娟","holder":"蔡孟娟","supervisor":"Vicky","ehs":"Noah","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-018","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-104"},{"srNo":105,"contPtwNo":"97","applyCompany":"Hi-E","ptwNumber":"PTW-105","issuingDate":"2026-01-10","closingDate":"2026-01-20","issuingPerson":"PT","startDate":"2026-01-12","validDate":"2026-01-18","applicant":"徐凱鵬","holder":"徐凱鵬","supervisor":"Mr. Cheng","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁作業、沉砂池施作 Sheet pilling, Grit tank","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-064","coldWork":"CWC-105"},{"srNo":106,"contPtwNo":"99","applyCompany":"Hi-E","ptwNumber":"PTW-106","issuingDate":"2026-01-10","closingDate":"2026-01-27","issuingPerson":"PT","startDate":"2026-01-12","validDate":"2026-01-18","applicant":"賴奕杰","holder":"賴奕杰\n邱禹睿","supervisor":"Jeffrey","ehs":"Eason","location":"台中工區\nTaichung","workDescription":"鋼板樁作業、地質改良作業 Sheet pilling, Jet grouting","hotWork":"HWC-019","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-065","coldWork":"CWC-106"},{"srNo":107,"contPtwNo":"100","applyCompany":"Hi-E","ptwNumber":"PTW-107","issuingDate":"2026-01-10","closingDate":"2026-01-27","issuingPerson":"PT","startDate":"2026-01-12","validDate":"2026-01-18","applicant":"賴奕杰","holder":"賴奕杰\n邱禹睿","supervisor":"Jeffrey","ehs":"Eason","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台 Grit tank, trench, car wash station","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-066","coldWork":"CWC-107"},{"srNo":108,"contPtwNo":"98","applyCompany":"GW","ptwNumber":"PTW-108","issuingDate":"2026-01-10","closingDate":"2026-01-26","issuingPerson":"PT","startDate":"2026-01-14","validDate":"2026-01-20","applicant":"胡正得","holder":"胡正得","supervisor":"Mr. Cheng","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"回填、護岸鋪設施工、防塵網鋪設\nbackfill, rock installation, laying dust net","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-067","coldWork":"CWC-108"},{"srNo":109,"contPtwNo":"93","applyCompany":"GAC","ptwNumber":"PTW-109","issuingDate":"2026-01-12","closingDate":"2026-01-19","issuingPerson":"PT","startDate":"2026-01-13","validDate":"2026-01-19","applicant":"陳怡如","holder":"周以宸","supervisor":"Vicky","ehs":"Sue","location":"37號馬頭\nBerth 37","workDescription":"後線布置 Sand bag preperation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-109"},{"srNo":110,"contPtwNo":"-","applyCompany":"Amtie","ptwNumber":"PTW-110","issuingDate":"2026-01-14","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-14","validDate":"2026-01-20","applicant":"黃柏翔","holder":"黃柏翔","supervisor":"Katherine","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"CCTV 裝設","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-110"},{"srNo":111,"contPtwNo":"108","applyCompany":"GW","ptwNumber":"PTW-111","issuingDate":"2026-01-17","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-01-21","validDate":"2026-01-27","applicant":"胡正德","holder":"胡正德","supervisor":"Hunter","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"回填、護岸鋪設施工、防塵網鋪設\nbackfill, rock installation, laying dust net","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-068","coldWork":"CWC-111"},{"srNo":112,"contPtwNo":"105","applyCompany":"Hi-E","ptwNumber":"PTW-112","issuingDate":"2026-01-17","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-01-19","validDate":"2026-01-25","applicant":"徐凱鵬","holder":"徐凱鵬\n邱禹睿","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁作業、地質改良作業 Sheet pilling, Jet grouting","hotWork":"HWC-019","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-069","coldWork":"CWC-112"},{"srNo":113,"contPtwNo":"106","applyCompany":"Hi-E","ptwNumber":"PTW-113","issuingDate":"2026-01-17","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-19","validDate":"2026-01-25","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"鋼板樁作業、地質改良作業 Sheet pilling, Jet grouting","hotWork":"HWC-020","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-070","coldWork":"CWC-113"},{"srNo":114,"contPtwNo":"107","applyCompany":"Hi-E","ptwNumber":"PTW-114","issuingDate":"2026-01-17","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-19","validDate":"2026-01-25","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台 Grit tank, trench, car wash station","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-071","coldWork":"CWC-114"},{"srNo":115,"contPtwNo":"109","applyCompany":"GAC","ptwNumber":"PTW-115","issuingDate":"2026-01-19","closingDate":"2026-01-26","issuingPerson":"PT","startDate":"2026-01-20","validDate":"2026-01-26","applicant":"陳怡如","holder":"劉耀駿\n陳怡如","supervisor":"Vicky","ehs":"Sue","location":"37號馬頭\nBerth 37","workDescription":"後線布置 Sand bag preperation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-115"},{"srNo":116,"contPtwNo":"103","applyCompany":"MGT","ptwNumber":"PTW-116","issuingDate":"2026-01-19","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-01-19","validDate":"2026-01-25","applicant":"蔡孟娟","holder":"黃紹宸","supervisor":"Lucas","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"焊工考試、環保設施配置(級配、防塵網)","hotWork":"HWC-021","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-116"},{"srNo":117,"contPtwNo":"104","applyCompany":"MGT","ptwNumber":"PTW-117","issuingDate":"2026-01-19","closingDate":"2025-02-06","issuingPerson":"PT","startDate":"2026-01-19","validDate":"2026-01-25","applicant":"蔡孟娟","holder":"蔡孟娟","supervisor":"Lucas","ehs":"Jeffrey","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-022","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-117"},{"srNo":118,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-118","issuingDate":"2026-01-22","closingDate":"2026-01-26","issuingPerson":"PT","startDate":"2026-01-21","validDate":"2026-01-27","applicant":"陳怡如","holder":"劉耀駿\n楊武智","supervisor":"Lucas","ehs":"Sue","location":"管線暫置區\nPipeline stroage area","workDescription":"天然氣館卸貨吊掛存放作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-118"},{"srNo":119,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-119","issuingDate":"2026-01-22","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-23","validDate":"2026-01-29","applicant":"陳怡如","holder":"蔡銘賢\n楊武智","supervisor":"Vicky","ehs":"Sue","location":"船邊作業馬碼頭","workDescription":"貨櫃及發電機吊掛、加油","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-119"},{"srNo":120,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-120","issuingDate":"2026-01-22","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-23","validDate":"2026-01-29","applicant":"陳怡如","holder":"劉耀駿\n楊武智","supervisor":"Vicky","ehs":"Sue","location":"37號馬頭\nBerth 37","workDescription":"貨櫃及發電機吊掛、加油","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-120"},{"srNo":121,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-121","issuingDate":"2026-01-22","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-24","validDate":"2026-01-30","applicant":"陳怡如","holder":"劉耀駿\n楊武智","supervisor":"Vicky","ehs":"Sue","location":"37號馬頭\nBerth 37","workDescription":"BB4 吊掛作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-121"},{"srNo":122,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-122","issuingDate":"2026-01-22","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-24","validDate":"2026-01-30","applicant":"陳怡如","holder":"蔡銘賢\n楊武智","supervisor":"Vicky","ehs":"Sue","location":"44/45碼頭","workDescription":"管線吊掛作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-122"},{"srNo":123,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-123","issuingDate":"2026-01-23","closingDate":"2026-02-13","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Hunter","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"整地、碎石級配鋪設及不織布鋪設","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-123"},{"srNo":124,"contPtwNo":"112","applyCompany":"Hi-E","ptwNumber":"PTW-124","issuingDate":"2026-01-24","closingDate":"2026-02-04","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"徐凱鵬","holder":"徐凱鵬\n邱禹睿","supervisor":"Hunter","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁進料打設、貨櫃吊掛、堆進坑開挖、地質改良、防塵網鋪設","hotWork":"HWC-023","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-072","coldWork":"CWC-124"},{"srNo":125,"contPtwNo":"113","applyCompany":"Hi-E","ptwNumber":"PTW-125","issuingDate":"2026-01-24","closingDate":"2026-02-08","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"鋼板樁作業","hotWork":"HWC-024","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-073","coldWork":"CWC-125"},{"srNo":126,"contPtwNo":"114","applyCompany":"Hi-E","ptwNumber":"PTW-126","issuingDate":"2026-01-24","closingDate":"2026-02-08","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台、整地","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-074","coldWork":"CWC-126"},{"srNo":127,"contPtwNo":"116","applyCompany":"MGT","ptwNumber":"PTW-127","issuingDate":"2026-01-24","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"焊工考試、環保設施配置(級配、防塵網)","hotWork":"HWC-025","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-075","coldWork":"CWC-127"},{"srNo":128,"contPtwNo":"117","applyCompany":"MGT","ptwNumber":"PTW-128","issuingDate":"2026-01-24","closingDate":"2026-02-06","issuingPerson":"PT","startDate":"2026-01-26","validDate":"2026-02-01","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-026","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-128"},{"srNo":129,"contPtwNo":"111","applyCompany":"GW","ptwNumber":"PTW-129","issuingDate":"2026-01-24","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-01-28","validDate":"2026-02-03","applicant":"胡正德","holder":"胡正德","supervisor":"Hunter","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"回填、護岸鋪設施工、防塵網鋪設\nbackfill, rock installation, laying dust net","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-076","coldWork":"CWC-129"},{"srNo":130,"contPtwNo":"119","applyCompany":"GAC","ptwNumber":"PTW-130","issuingDate":"2026-01-28","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-30","validDate":"2026-02-05","applicant":"蕭宜真","holder":"劉耀駿","supervisor":"Vicky","ehs":"Sue","location":"船邊作業馬碼頭","workDescription":"貨櫃及發電機吊掛、加油","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-130"},{"srNo":131,"contPtwNo":"120","applyCompany":"GAC","ptwNumber":"PTW-131","issuingDate":"2026-01-28","closingDate":"2026-01-30","issuingPerson":"PT","startDate":"2026-01-30","validDate":"2026-02-05","applicant":"蕭宜真","holder":"劉耀駿","supervisor":"Vicky","ehs":"Sue","location":"37號馬頭\nBerth 37","workDescription":"貨櫃及發電機吊掛、加油","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-131"},{"srNo":132,"contPtwNo":"125","applyCompany":"Hi-E","ptwNumber":"PTW-132","issuingDate":"2026-01-30","closingDate":"","issuingPerson":"PT","startDate":"2026-02-02","validDate":"2026-02-08","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"鋼板樁作業","hotWork":"HWC-027","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-077","coldWork":"CWC-132"},{"srNo":133,"contPtwNo":"126","applyCompany":"Hi-E","ptwNumber":"PTW-133","issuingDate":"2026-01-30","closingDate":"","issuingPerson":"PT","startDate":"2026-02-02","validDate":"2026-02-08","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台、整地","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-078","coldWork":"CWC-133"},{"srNo":134,"contPtwNo":"127","applyCompany":"MGT","ptwNumber":"PTW-134","issuingDate":"2026-02-02","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-02-02","validDate":"2026-02-08","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr. Pai","ehs":"Jeffrey","location":"台中工區\nTaichung","workDescription":"焊工考試、環保設施配置(級配、防塵網)","hotWork":"HWC-028","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-134"},{"srNo":135,"contPtwNo":"128","applyCompany":"MGT","ptwNumber":"PTW-135","issuingDate":"2026-02-02","closingDate":"2026-02-12","issuingPerson":"PT","startDate":"2026-02-02","validDate":"2026-02-08","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr. Pai","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"管材Coating, 缺失改善","hotWork":"HWC-029","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-135"},{"srNo":136,"contPtwNo":"118","applyCompany":"GAC","ptwNumber":"PTW-136","issuingDate":"2026-02-03","closingDate":"2026-02-05","issuingPerson":"PT","startDate":"2026-02-03","validDate":"2026-02-09","applicant":"蕭宜真","holder":"劉耀駿","supervisor":"LuCAS","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"天然氣館卸貨吊掛存放作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-136"},{"srNo":137,"contPtwNo":"123","applyCompany":"MGT","ptwNumber":"PTW-137","issuingDate":"2026-02-03","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-02-03","validDate":"2026-02-09","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr.cheng","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"整地、碎石級配鋪設及不織布鋪設","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-137"},{"srNo":138,"contPtwNo":"124","applyCompany":"Hi-E","ptwNumber":"PTW-138","issuingDate":"2026-02-03","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-02-04","validDate":"2026-02-10","applicant":"徐凱鵬","holder":"徐凱鵬\n邱禹睿","supervisor":"Mr.cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁進料打設、貨櫃吊掛、堆進坑開挖、地質改良、防塵網鋪設","hotWork":"HWC-030","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-079","coldWork":"CWC-138"},{"srNo":139,"contPtwNo":"110","applyCompany":"Amtie","ptwNumber":"PTW-139","issuingDate":"2026-02-04","closingDate":"2026-02-11","issuingPerson":"PT","startDate":"2026-02-05","validDate":"2026-02-11","applicant":"黃柏鈞","holder":"黃柏鈞","supervisor":"Mr.cheng","ehs":"Ben","location":"通霄工區\nTong Hsiao","workDescription":"CCTV 裝設作業  CCTV installation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-139"},{"srNo":140,"contPtwNo":"101","applyCompany":"GAC","ptwNumber":"PTW-140","issuingDate":"2026-02-06","closingDate":"2026-02-09","issuingPerson":"Hao","startDate":"2026-02-07","validDate":"2026-02-13","applicant":"蕭宜真","holder":"劉耀駿\n倪紹龍","supervisor":"戴漢廷","ehs":"Jeffrey","location":"天力儲區\nTien-li","workDescription":"管蓋拆裝作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-140"},{"srNo":141,"contPtwNo":"-","applyCompany":"MGT","ptwNumber":"PTW-141","issuingDate":"2026-02-06","closingDate":"2026-02-11","issuingPerson":"Hao","startDate":"2026-02-06","validDate":"2026-02-12","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"Mr.cheng","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"於通霄工區內進行鋼材底座吊掛作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-141"},{"srNo":142,"contPtwNo":"-","applyCompany":"BinYang","ptwNumber":"PTW-142","issuingDate":"2026-02-07","closingDate":"","issuingPerson":"PT","startDate":"2026-02-09","validDate":"2026-02-10","applicant":"Mandy","holder":"陳萱恩","supervisor":"Vicky","ehs":"Kong","location":"37號碼頭\nBerth 37","workDescription":"保全亭、發電機、油桶吊掛作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-142"},{"srNo":143,"contPtwNo":"132","applyCompany":"Hi-E","ptwNumber":"PTW-143","issuingDate":"2026-02-08","closingDate":"","issuingPerson":"PT","startDate":"2026-02-09","validDate":"2026-02-15","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"鋼板樁作業","hotWork":"HWC-031","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-080","coldWork":"CWC-143"},{"srNo":144,"contPtwNo":"133","applyCompany":"Hi-E","ptwNumber":"PTW-144","issuingDate":"2026-02-08","closingDate":"","issuingPerson":"PT","startDate":"2026-02-09","validDate":"2026-02-15","applicant":"賴奕杰","holder":"賴亦杰\n邱禹睿","supervisor":"Mr. Pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"沉砂池、環場水路、洗車台、整地","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-081","coldWork":"CWC-144"},{"srNo":145,"contPtwNo":"135","applyCompany":"MGT","ptwNumber":"PTW-145","issuingDate":"2026-02-09","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-09","validDate":"2026-02-15","applicant":"蔡孟娟","holder":"蔡孟娟\n黃韶辰\n黃彥翔\n周泰安\n邱小語","supervisor":"Kevin","ehs":"Sue","location":"管線暫置區\nPipeline stroage area","workDescription":"於天力管線暫存區管材包覆作業以及吊掛管材","hotWork":"HWC-032","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-145"},{"srNo":146,"contPtwNo":"103","applyCompany":"MGT","ptwNumber":"PTW-146","issuingDate":"2026-02-09","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-09","validDate":"2026-02-15","applicant":"蔡孟娟","holder":"蔡孟娟\n黃韶辰\n黃彥翔\n周泰安\n邱小語","supervisor":"Mr. Pai","ehs":"Noah","location":"台中工區\nTaichung","workDescription":"於台中工區內進行HDD設備架設設置,側溝開挖以及吊掛管材","hotWork":"HWC-033","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-082","coldWork":"CWC-146"},{"srNo":147,"contPtwNo":"131","applyCompany":"GAC","ptwNumber":"PTW-147","issuingDate":"2026-02-10","closingDate":"2026-02-12","issuingPerson":"Hao","startDate":"2026-02-12","validDate":"2026-02-18","applicant":"蕭宜真","holder":"劉耀駿\n倪紹龍","supervisor":"Lucas","ehs":"Sue","location":"天力儲區\nTien-li","workDescription":"貨櫃及發電機吊掛、加油","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-147"},{"srNo":148,"contPtwNo":"138","applyCompany":"Hi-E","ptwNumber":"PTW-148","issuingDate":"2026-02-11","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-12","validDate":"2026-02-18","applicant":"徐凱鵬","holder":"徐凱鵬\n許岱揚","supervisor":"Mr.cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁進料打設、貨櫃吊掛、堆進坑開挖、地質改良、防塵網鋪設","hotWork":"HWC-032","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-082","coldWork":"CWC-148"},{"srNo":149,"contPtwNo":"139","applyCompany":"Amtie","ptwNumber":"PTW-149","issuingDate":"2026-02-11","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-12","validDate":"2026-02-18","applicant":"黃柏鈞","holder":"黃柏鈞","supervisor":"Mr.cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"CCTV 裝設作業  CCTV installation","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-149"},{"srNo":150,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-150","issuingDate":"2026-02-11","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-13","validDate":"2026-02-19","applicant":"謝承宏","holder":"劉澤懷","supervisor":"Sam","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"組合屋搭設","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-150"},{"srNo":151,"contPtwNo":"-","applyCompany":"NMDC","ptwNumber":"PTW-151","issuingDate":"2026-02-11","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-13","validDate":"2026-02-19","applicant":"王錦隆","holder":"王錦隆","supervisor":"Sam","ehs":"Elson","location":"通霄工區\nTong Hsiao","workDescription":"組合屋搭設","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-151"},{"srNo":152,"contPtwNo":"-","applyCompany":"GAC","ptwNumber":"PTW-152","issuingDate":"2026-02-12","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-21","validDate":"2026-02-27","applicant":"蕭宜真","holder":"劉耀駿","supervisor":"Jamie","ehs":"Sue","location":"28號碼頭","workDescription":"船邊作業","hotWork":"","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-152"},{"srNo":153,"contPtwNo":"148","applyCompany":"Hi-E","ptwNumber":"PTW-153","issuingDate":"2026-02-13","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-18","validDate":"2026-02-24","applicant":"徐凱鵬","holder":"徐凱鵬\n許岱揚","supervisor":"Mr. Cheng","ehs":"Jin","location":"通霄工區\nTong Hsiao","workDescription":"鋼板樁進料打設、設備吊掛、堆進坑開挖、地質改良、防塵網鋪設、護欄施作","hotWork":"HWC-033","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-083","coldWork":"CWC-153"},{"srNo":154,"contPtwNo":"146","applyCompany":"MGT","ptwNumber":"PTW-154","issuingDate":"2026-02-13","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-16","validDate":"2026-02-22","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"張嘉甫","ehs":"Jet","location":"台中工區\nTaichung","workDescription":"於台中工區內進行HDD設備架設設置,側溝開挖以及吊掛管材","hotWork":"HWC-034","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"EXC-084","coldWork":"CWC-154"},{"srNo":155,"contPtwNo":"145","applyCompany":"MGT","ptwNumber":"PTW-155","issuingDate":"2026-02-13","closingDate":"","issuingPerson":"Hao","startDate":"2026-02-16","validDate":"2026-02-22","applicant":"蔡孟娟","holder":"黃韶辰\n黃彥翔\n周泰安\n邱小語\n蔡孟娟","supervisor":"張嘉甫","ehs":"Kong","location":"管線暫置區\nPipeline stroage area","workDescription":"於天力管線暫存區管材包覆作業以及吊掛管材","hotWork":"HWC-035","electrical":"","diving":"","radiography":"","confinedSpace":"","excavation":"","coldWork":"CWC-155"}];

const COS=["MGT","GW","BinYang","Amtie","NMDC","EGST","KaoShen","Hi-E","GAC"];
const LOCS=["台中工區","通霄工區","天力管線暫置區","37號碼頭管線暫置區","通霄電廠","其他"];
const CATS=[
  {key:"hotWork",en:"Hot Work",zh:"動火作業",pre:"HWC"},
  {key:"electrical",en:"Electrical",zh:"電氣作業",pre:"ELC"},
  {key:"diving",en:"Diving",zh:"潛水作業",pre:"DVC"},
  {key:"radiography",en:"Radiography",zh:"輻射作業",pre:"RAD"},
  {key:"confinedSpace",en:"Confined Space",zh:"局限空間",pre:"CSC"},
  {key:"excavation",en:"Excavation",zh:"開挖作業",pre:"EXC"},
  {key:"coldWork",en:"Cold Work",zh:"一般作業",pre:"CWC"},
];

const empty={srNo:"",contPtwNo:"-",applyCompany:"",ptwNumber:"",issuingDate:"",closingDate:"",issuingPerson:"",startDate:"",validDate:"",applicant:"",holder:"",supervisor:"",ehs:"",location:"",workDescription:"",hotWork:"",electrical:"",diving:"",radiography:"",confinedSpace:"",excavation:"",coldWork:""};
const PERSONS=[{"no": 1, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "顏正安", "title": "HSE", "trainedDate": "2025-08-05", "remark": ""}, {"no": 2, "unit": "Issuing", "dept": "Supervisor (Onshore/nearshore)", "company": "NMDC", "person": "Kathrien Lien", "title": "Project Superintendent", "trainedDate": "2025-08-08", "remark": ""}, {"no": 3, "unit": "Performing", "dept": "-", "company": "Glory Wealth", "person": "許雅婷", "title": "Engineer", "trainedDate": "2025-08-05", "remark": "V"}, {"no": 4, "unit": "Performing", "dept": "-", "company": "NorthGo", "person": "陳朝海", "title": "Chairman", "trainedDate": "2025-08-05", "remark": ""}, {"no": 5, "unit": "Performing", "dept": "-", "company": "NorthGo", "person": "陳嘉俊", "title": "EHS", "trainedDate": "2025-08-05", "remark": ""}, {"no": 6, "unit": "Performing", "dept": "-", "company": "NorthGo", "person": "鮑雪兒", "title": "Operation", "trainedDate": "2025-08-05", "remark": ""}, {"no": 7, "unit": "Performing", "dept": "-", "company": "NorthGo", "person": "賴澔興", "title": "Operation", "trainedDate": "2025-08-05", "remark": ""}, {"no": 8, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "劉澤懷 Jeffery Liu", "title": "EHS", "trainedDate": "2025-08-08", "remark": ""}, {"no": 9, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "王信為 Vic Wang", "title": "EHS", "trainedDate": "2025-08-08", "remark": ""}, {"no": 10, "unit": "Issuing", "dept": "PTW coordinator", "company": "NMDC", "person": "Kong Yon Wong", "title": "EHS", "trainedDate": "2025-08-05", "remark": ""}, {"no": 11, "unit": "Performing", "dept": "-", "company": "Glory Wealth", "person": "江傑霖", "title": "Engineer", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 12, "unit": "Performing", "dept": "-", "company": "Glory Wealth", "person": "嚴心衛", "title": "Engineer", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 13, "unit": "Performing", "dept": "-", "company": "Glory Wealth", "person": "胡正得", "title": "Engineer", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 14, "unit": "Performing", "dept": "-", "company": "Glory Wealth", "person": "羅祥羽", "title": "Engineer", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 15, "unit": "Issuing", "dept": "PTW coordinator", "company": "NMDC", "person": "黃郁翔", "title": "Env engineer", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 16, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "李偉程", "title": "EHS", "trainedDate": "2025-08-13", "remark": ""}, {"no": 17, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "王錦隆", "title": "EHS", "trainedDate": "2025-08-13", "remark": "V"}, {"no": 18, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "周泰安", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 19, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "朱雅瑄", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 20, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "蔣孟清", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 21, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "陳怡君", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 22, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "鄭為謙", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 23, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "蔡正偉", "title": "Engineer", "trainedDate": "2025-08-13", "remark": ""}, {"no": 24, "unit": "Issuing", "dept": "PTW coordinator", "company": "NMDC", "person": "童保舜", "title": "Env engineer", "trainedDate": "2025-08-05", "remark": ""}, {"no": 25, "unit": "Issuing", "dept": "Supervisor(Survey)", "company": "NMDC", "person": "Daryll Enano", "title": "Chief surveyor", "trainedDate": "2025-08-15", "remark": ""}, {"no": 26, "unit": "Issuing", "dept": "Supervisor(Logistic)", "company": "NMDC", "person": "Evan Su", "title": "Logistic Superintendent", "trainedDate": "2025-08-15", "remark": ""}, {"no": 27, "unit": "Issuing", "dept": "Supervisor(Survey)", "company": "NMDC", "person": "Mok Wai Heng", "title": "Survey manager", "trainedDate": "2025-08-15", "remark": ""}, {"no": 28, "unit": "Issuing", "dept": "Supervisor(Offfshore)", "company": "NMDC", "person": "Peter Wu", "title": "Offhsore construction manager", "trainedDate": "2025-08-15", "remark": ""}, {"no": 29, "unit": "Issuing", "dept": "Supervisor (Onshore/nearshore)", "company": "NMDC", "person": "Berk", "title": "Project engineer", "trainedDate": "2025-08-19", "remark": ""}, {"no": 30, "unit": "Issuing", "dept": "Supervisor (Onshore/nearshore)", "company": "NMDC", "person": "Nandhu", "title": "Project engineer", "trainedDate": "2025-08-19", "remark": ""}, {"no": 31, "unit": "Issuing", "dept": "Supervisor (Onshore/nearshore)", "company": "NMDC", "person": "Ibrahim", "title": "Construction manager", "trainedDate": "2025-08-19", "remark": ""}, {"no": 32, "unit": "Issuing", "dept": "Supervisor (Onshore/nearshore)", "company": "NMDC", "person": "Subin", "title": "Project supervisor", "trainedDate": "2025-08-19", "remark": ""}, {"no": 33, "unit": "Performing", "dept": "-", "company": "Magitech", "person": "賴仲彥", "title": "Site manager", "trainedDate": "2025-08-25", "remark": ""}, {"no": 34, "unit": "Issuing", "dept": "Supervisor (QAQC)", "company": "NMDC", "person": "古定坤", "title": "QA/QC", "trainedDate": "2025-08-25", "remark": ""}, {"no": 35, "unit": "Issuing", "dept": "Supervisor (QAQC)", "company": "NMDC", "person": "鄭凱旭", "title": "QA/QC", "trainedDate": "2025-08-25", "remark": ""}, {"no": 36, "unit": "Issuing", "dept": "Supervisor (QAQC)", "company": "NMDC", "person": "張建華", "title": "QA/QC", "trainedDate": "2025-08-25", "remark": ""}, {"no": 37, "unit": "Issuing", "dept": "Supervisor (offshore)", "company": "NMDC", "person": "NG KAH CHANG", "title": "offshore engineer", "trainedDate": "2025-08-25", "remark": ""}, {"no": 38, "unit": "Issuing", "dept": "Supervisor (Environment)", "company": "NMDC", "person": "朱修成", "title": "Env engineer", "trainedDate": "2025-09-02", "remark": ""}, {"no": 39, "unit": "Issuing", "dept": "Supervisor (Site manager)", "company": "NMDC", "person": "鄭春淵", "title": "Site manager", "trainedDate": "2025-09-02", "remark": "V"}, {"no": 40, "unit": "Issuing", "dept": "Supervisor (Project Engineer)", "company": "NMDC", "person": "沈丞穎", "title": "Project Engineer", "trainedDate": "2025-09-02", "remark": ""}, {"no": 41, "unit": "Issuing", "dept": "Supervisor (Project Engineer)", "company": "NMDC", "person": "李尚澤", "title": "Project Engineer", "trainedDate": "2025-09-02", "remark": ""}, {"no": 42, "unit": "Issuing", "dept": "Supervisor (Site responsible person)", "company": "NMDC", "person": "柯懿軒", "title": "Site responsibl sogineer", "trainedDate": "2025-09-02", "remark": ""}, {"no": 43, "unit": "Performing", "dept": "-", "company": "高軒", "person": "嚴文愷", "title": "Site manager", "trainedDate": "2025-09-02", "remark": ""}, {"no": 44, "unit": "Issuing", "dept": "Supervisor (Site manager)", "company": "NMDC", "person": "白曉穎", "title": "Site manager", "trainedDate": "2025-09-02", "remark": ""}, {"no": 45, "unit": "Performing", "dept": "-", "company": "MGT", "person": "張瑀娟", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 46, "unit": "Performing", "dept": "-", "company": "MGT", "person": "邱小語", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 47, "unit": "Performing", "dept": "-", "company": "MGT", "person": "李宜恩", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 48, "unit": "Performing", "dept": "-", "company": "MGT", "person": "魏鴻鎮", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 49, "unit": "Performing", "dept": "-", "company": "MGT", "person": "黃紹宸", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 50, "unit": "Performing", "dept": "-", "company": "圓泰", "person": "賴勇叡", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 51, "unit": "Performing", "dept": "-", "company": "圓泰", "person": "黃柏鈞", "title": "Engineer", "trainedDate": "2025-09-09", "remark": ""}, {"no": 52, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "林綻承", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 53, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "黃連德", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 54, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "邱禹睿", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 55, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "徐凱鵬", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 56, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "賴奕杰", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 57, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "陳柏村", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 58, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "陳宗琦", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 59, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "張國勳", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 60, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "許岱揚", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 61, "unit": "Performing", "dept": "-", "company": "Hi E", "person": "陳立德", "title": "Engineer", "trainedDate": "2025-10-08", "remark": ""}, {"no": 62, "unit": "Performing", "dept": "-", "company": "GAC", "person": "周以宸", "title": "Boarding officer", "trainedDate": "2025-11-07", "remark": ""}, {"no": 63, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "張重興", "title": "Assistant VP", "trainedDate": "2025-11-07", "remark": ""}, {"no": 64, "unit": "Performing", "dept": "-", "company": "GAC", "person": "倪紹龍", "title": "Logistic Coordinator", "trainedDate": "2025-11-07", "remark": ""}, {"no": 65, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "鄭書凱", "title": "Specialist", "trainedDate": "2025-11-07", "remark": ""}, {"no": 66, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "柯慰欽", "title": "Supervisor", "trainedDate": "2025-11-07", "remark": ""}, {"no": 67, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "李永源", "title": "Deputy manager", "trainedDate": "2025-11-07", "remark": ""}, {"no": 68, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "楊琮閔", "title": "Supervisor", "trainedDate": "2025-11-07", "remark": ""}, {"no": 69, "unit": "Performing", "dept": "-", "company": "GAC/CSHS/ Cheng An", "person": "洪志強", "title": "PIC", "trainedDate": "2025-11-07", "remark": ""}, {"no": 70, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "謝承宏", "title": "EHS", "trainedDate": "2025-11-07", "remark": ""}, {"no": 71, "unit": "Performing", "dept": "-", "company": "GAC", "person": "蔡明賢", "title": "Project manager", "trainedDate": "2025-11-07", "remark": ""}, {"no": 72, "unit": "Performing", "dept": "-", "company": "GAC", "person": "賴奕源", "title": "Shipping operation", "trainedDate": "2025-11-07", "remark": ""}, {"no": 73, "unit": "Performing", "dept": "-", "company": "GAC", "person": "王志忠", "title": "Boarding officer", "trainedDate": "2025-11-07", "remark": ""}, {"no": 74, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "白閔億", "title": "Division lead", "trainedDate": "2025-11-07", "remark": ""}, {"no": 75, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "楊武智", "title": "Supervisor", "trainedDate": "2025-11-07", "remark": ""}, {"no": 76, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "王建豐", "title": "manager", "trainedDate": "2025-11-07", "remark": ""}, {"no": 77, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "顏國川", "title": "Division lead", "trainedDate": "2025-11-07", "remark": ""}, {"no": 78, "unit": "Issuing", "dept": "construction", "company": "NMDC", "person": "謝瀚庭", "title": "Project engineer", "trainedDate": "2025-11-07", "remark": ""}, {"no": 79, "unit": "Issuing", "dept": "EHS", "company": "NMDC", "person": "彭粟筠", "title": "EHS", "trainedDate": "2025-11-07", "remark": ""}, {"no": 80, "unit": "Performing", "dept": "-", "company": "GAC/CSHS", "person": "林姿伶", "title": "assistant manager", "trainedDate": "2025-11-07", "remark": ""}, {"no": 81, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "許仁豪", "title": "Specialist", "trainedDate": "2025-11-17", "remark": ""}, {"no": 82, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "姚詠騰", "title": "Supervisor", "trainedDate": "2025-11-17", "remark": ""}, {"no": 83, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "吳玫勳", "title": "Coordinator", "trainedDate": "2025-11-17", "remark": ""}, {"no": 84, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "卓美如", "title": "Coordinator", "trainedDate": "2025-11-17", "remark": ""}, {"no": 85, "unit": "Performing", "dept": "", "company": "GAC", "person": "Ryan", "title": "Intern", "trainedDate": "2025-11-17", "remark": ""}, {"no": 86, "unit": "Performing", "dept": "", "company": "GAC", "person": "宋宸憲", "title": "Manager", "trainedDate": "2025-11-17", "remark": ""}, {"no": 87, "unit": "Performing", "dept": "", "company": "Hi E", "person": "黃騰鈞", "title": "Project management", "trainedDate": "2025-11-17", "remark": ""}, {"no": 88, "unit": "Performing", "dept": "", "company": "MGT", "person": "黃彥翔", "title": "Engineer", "trainedDate": "2025-11-17", "remark": ""}, {"no": 89, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Benny Yang", "title": "Techinical Translator", "trainedDate": "2025-11-17", "remark": ""}, {"no": 90, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Vicky Tseng", "title": "Logistic engineer", "trainedDate": "2025-12-12", "remark": ""}, {"no": 91, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Jamie Tseng", "title": "Logistic engineer", "trainedDate": "2025-12-12", "remark": ""}, {"no": 92, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Carol Kao", "title": "QC inspector", "trainedDate": "2025-12-12", "remark": ""}, {"no": 93, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Tim Dai", "title": "QC inspector", "trainedDate": "2025-12-12", "remark": ""}, {"no": 94, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Allen Cheng", "title": "QA/QC", "trainedDate": "2025-12-12", "remark": ""}, {"no": 95, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "曹耿誠", "title": "Supervisor", "trainedDate": "2025-12-12", "remark": ""}, {"no": 96, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "李志國", "title": "Supervisor", "trainedDate": "2025-12-12", "remark": ""}, {"no": 97, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "程文龍", "title": "Supervisor", "trainedDate": "2025-12-12", "remark": ""}, {"no": 98, "unit": "Performing", "dept": "", "company": "BinYang", "person": "陳萱恩", "title": "Admin", "trainedDate": "2025-12-12", "remark": ""}, {"no": 99, "unit": "Performing", "dept": "", "company": "Hi E", "person": "徐雅誼", "title": "Admin", "trainedDate": "2025-12-12", "remark": ""}, {"no": 100, "unit": "Performing", "dept": "", "company": "GAC", "person": "鄭伊鈞", "title": "Site coordinator", "trainedDate": "2025-12-12", "remark": ""}, {"no": 101, "unit": "Performing", "dept": "", "company": "GAC", "person": "高尉展", "title": "Site coordinator", "trainedDate": "2025-12-12", "remark": ""}, {"no": 102, "unit": "Performing", "dept": "", "company": "GAC/Stark", "person": "蕭志偉", "title": "HSE", "trainedDate": "2025-12-12", "remark": ""}, {"no": 103, "unit": "Performing", "dept": "", "company": "GAC/Stark", "person": "范綱宏", "title": "manager", "trainedDate": "2025-12-12", "remark": ""}, {"no": 104, "unit": "Performing", "dept": "", "company": "GAC/Stark", "person": "古昌酈", "title": "manager", "trainedDate": "2025-12-12", "remark": ""}, {"no": 105, "unit": "Performing", "dept": "", "company": "GAC/Stark", "person": "李建輝", "title": "manager", "trainedDate": "2025-12-12", "remark": ""}, {"no": 106, "unit": "Performing", "dept": "", "company": "GAC/Stark", "person": "陳科賓", "title": "manager", "trainedDate": "2025-12-12", "remark": ""}, {"no": 107, "unit": "Performing", "dept": "", "company": "GAC", "person": "陳怡如", "title": "HSE", "trainedDate": "2025-12-12", "remark": ""}, {"no": 108, "unit": "Performing", "dept": "", "company": "Benline", "person": "Daria", "title": "Project manager", "trainedDate": "2025-12-30", "remark": ""}, {"no": 109, "unit": "Performing", "dept": "", "company": "Benline", "person": "Weiming", "title": "Project manager", "trainedDate": "2025-12-30", "remark": ""}, {"no": 110, "unit": "Performing", "dept": "", "company": "Benline", "person": "Russell", "title": "Marine supervisor", "trainedDate": "2025-12-30", "remark": ""}, {"no": 111, "unit": "Issuing", "dept": "", "company": "MMDC", "person": "Chiao Lin", "title": "Permit coordinator", "trainedDate": "2025-12-30", "remark": ""}, {"no": 113, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "陳聯益", "title": "Lead", "trainedDate": "2025-12-30", "remark": ""}, {"no": 114, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "張哲源", "title": "Logistic", "trainedDate": "2025-12-30", "remark": ""}, {"no": 115, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "紀誌達", "title": "Logistic", "trainedDate": "2025-12-30", "remark": ""}, {"no": 116, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "盧佑維", "title": "Logistic", "trainedDate": "2025-12-30", "remark": ""}, {"no": 117, "unit": "Performing", "dept": "", "company": "GAC/CSHS", "person": "陳孟申", "title": "Logistic", "trainedDate": "2025-12-30", "remark": ""}, {"no": 118, "unit": "Issuing", "dept": "", "company": "MMDC", "person": "何譿恩", "title": "Project engineer", "trainedDate": "2025-12-30", "remark": ""}, {"no": 119, "unit": "Performing", "dept": "", "company": "GAC", "person": "張美蓁", "title": "Interm", "trainedDate": "2026-01-08", "remark": ""}, {"no": 120, "unit": "Performing", "dept": "", "company": "GAC", "person": "劉耀駿", "title": "Logistic coordinator", "trainedDate": "2026-01-08", "remark": ""}, {"no": 121, "unit": "Performing", "dept": "", "company": "Benline", "person": "李詩婷", "title": "HSEQ", "trainedDate": "2026-01-08", "remark": ""}, {"no": 122, "unit": "Performing", "dept": "", "company": "Benline", "person": "林和明", "title": "Project Liasi Ion", "trainedDate": "2026-01-08", "remark": ""}, {"no": 123, "unit": "Performing", "dept": "", "company": "Benline", "person": "張勝閎", "title": "Executive", "trainedDate": "2026-01-08", "remark": ""}, {"no": 124, "unit": "Performing", "dept": "", "company": "Benline", "person": "韓明容", "title": "Logistic Executive", "trainedDate": "2026-01-08", "remark": ""}, {"no": 125, "unit": "Performing", "dept": "", "company": "Benline", "person": "林品堯", "title": "Executive", "trainedDate": "2026-01-08", "remark": ""}, {"no": 126, "unit": "Performing", "dept": "", "company": "Benline", "person": "Andrei KHOSHOTDIKOV", "title": "HSEQ manager", "trainedDate": "2026-01-13", "remark": ""}, {"no": 127, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "張元曦", "title": "QC inspector", "trainedDate": "2026-01-13", "remark": ""}, {"no": 128, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "王森民", "title": "QC manager(Civil)", "trainedDate": "2026-01-13", "remark": ""}, {"no": 121, "unit": "Performing", "dept": "", "company": "Benline", "person": "林君宇", "title": "Executive", "trainedDate": "2026-01-23", "remark": ""}, {"no": 122, "unit": "Performing", "dept": "", "company": "Benline", "person": "黃允聖", "title": "Senior Executive", "trainedDate": "2026-01-23", "remark": ""}, {"no": 123, "unit": "Performing", "dept": "", "company": "Benline", "person": "王家鴻", "title": "Executive", "trainedDate": "2026-01-23", "remark": ""}, {"no": 124, "unit": "Performing", "dept": "", "company": "Benline", "person": "鄭智瑋", "title": "Agent", "trainedDate": "2026-01-23", "remark": ""}, {"no": 125, "unit": "Performing", "dept": "", "company": "Benline", "person": "王欣怡", "title": "BD manager", "trainedDate": "2026-01-23", "remark": ""}, {"no": 126, "unit": "Performing", "dept": "", "company": "Benline", "person": "趙建凱", "title": "Chief engineer", "trainedDate": "2026-01-23", "remark": ""}, {"no": 127, "unit": "Performing", "dept": "", "company": "Benline", "person": "賴永智", "title": "assistant manager", "trainedDate": "2026-01-23", "remark": ""}, {"no": 128, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "彭肖瑛", "title": "Environment officer", "trainedDate": "2026-01-23", "remark": ""}, {"no": 129, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "唐郁茹", "title": "CCTV supervisor", "trainedDate": "2026-01-23", "remark": ""}, {"no": 130, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "鄭文旻", "title": "Site supervisor", "trainedDate": "2026-02-05", "remark": ""}, {"no": 131, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "Toh Lin Sid", "title": "QC inspector", "trainedDate": "2026-02-05", "remark": ""}, {"no": 132, "unit": "Issuing", "dept": "", "company": "NMDC", "person": "林志浩", "title": "PTW coordinator", "trainedDate": "2026-02-05", "remark": ""}, {"no": 133, "unit": "Performing", "dept": "", "company": "MGT", "person": "劉佑昌", "title": "Engineer", "trainedDate": "2026-02-05", "remark": ""}, {"no": 134, "unit": "Performing", "dept": "", "company": "Benline", "person": "郭文竹", "title": "Log manager", "trainedDate": "2026-02-05", "remark": ""}, {"no": 135, "unit": "Performing", "dept": "", "company": "Benline", "person": "李文銓", "title": "Executive", "trainedDate": "2026-02-05", "remark": ""}, {"no": 136, "unit": "Performing", "dept": "", "company": "Benline", "person": "陳韋綸", "title": "Senior Executive", "trainedDate": "2026-02-05", "remark": ""}];
const P_UNITS=["Issuing","Performing"];
const P_COS=["Benline", "BinYang", "GAC", "GAC/CSHS", "GAC/CSHS/ Cheng An", "GAC/Stark", "Glory Wealth", "Hi E", "MGT", "MMDC", "Magitech", "NMDC", "NorthGo", "圓泰", "高軒"];
/* PTW公司名→人員公司名 對照表 */
const CO_ALIAS={"GW":"Glory Wealth","Hi-E":"Hi E","KaoShen":"高軒","Amtie":"圓泰"};
const getPersonCos=(ptwCo)=>{if(!ptwCo)return null;const alias=CO_ALIAS[ptwCo];if(alias)return[ptwCo,alias];if(ptwCo==="MGT")return["MGT","Magitech"];if(ptwCo==="GAC")return["GAC","GAC/CSHS","GAC/CSHS/ Cheng An","GAC/Stark"];if(ptwCo==="NMDC")return["NMDC","MMDC"];return[ptwCo]};
/* PDF Export */
function exportTablePDF(filtered,mode,subtitle,fmtD){
  const rows=filtered.map(r=>[r.srNo,r.ptwNumber,r.contPtwNo!=="-"?r.contPtwNo:"",r.applyCompany,fmtD(r.issuingDate),fmtD(r.closingDate),fmtD(r.startDate),fmtD(r.validDate),r.applicant,r.holder,r.supervisor,r.ehs,(r.location||"").replace(/\n/g," "),(r.workDescription||"").replace(/\n/g," "),r.hotWork||"",r.electrical||"",r.diving||"",r.radiography||"",r.confinedSpace||"",r.excavation||"",r.coldWork||""]);
  const heads=["#","PTW No.","Cont.","Company","Issue","Close","Start","Valid","Applicant","Holder","Supv.","EHS","Location","Description","HWC","ELC","DVC","RAD","CSC","EXC","CWC"];
  let html=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>PTW Register</title><style>
    @page{size:A3 landscape;margin:8mm}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans TC','Segoe UI',Arial,sans-serif;font-size:8px;color:#222}
    h2{font-size:16px;text-align:center;margin:6px 0 2px}
    .sub{text-align:center;font-size:10px;color:#666;margin-bottom:6px}
    table{width:100%;border-collapse:collapse}
    th{background:#3c3c3c;color:#fff;font-size:7px;padding:4px 2px;border:1px solid #555;font-weight:700;white-space:nowrap}
    td{padding:3px 2px;border:1px solid #ccc;font-size:7px;word-break:break-word;vertical-align:top}
    tr:nth-child(even){background:#f5f5f5}
    .closed{color:#16a34a}.unclosed{color:#dc2626;font-weight:700}.expired{color:#dc2626;font-weight:700}
    @media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}
  </style></head><body>
  <h2>PTW Register</h2><div class="sub">${subtitle} | Generated: ${new Date().toLocaleDateString()}</div>
  <table><thead><tr>${heads.map(h=>"<th>"+h+"</th>").join("")}</tr></thead><tbody>`;
  rows.forEach((r,i)=>{
    const rec=filtered[i];
    const isOpen=!rec.closingDate||rec.closingDate.trim()==="";
    const isExp=rec.validDate&&new Date(rec.validDate)<new Date();
    html+="<tr>"+r.map((c,j)=>{
      let cls="";
      if(j===5){cls=isOpen?"unclosed":"closed"}
      if(j===7&&isOpen&&isExp){cls="expired"}
      return '<td class="'+cls+'">'+c+"</td>";
    }).join("")+"</tr>";
  });
  html+="</tbody></table><script>window.onload=function(){window.print()}<\/script></body></html>";
  const w=window.open("","_blank");
  if(w){w.document.write(html);w.document.close()}
  else{alert("請允許彈出視窗 (pop-up) 以輸出列印頁面")}
}

function exportSummaryPDF(rows,getUnclosed,getDateColor,fmtD){
  let html=`<!DOCTYPE html><html><head><meta charset="utf-8"><title>PTW Weekly Summary</title><style>
    @page{size:A4 landscape;margin:10mm}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Noto Sans TC','Segoe UI',Arial,sans-serif;font-size:10px;color:#222}
    h2{font-size:16px;text-align:center;margin:8px 0 4px}
    .sub{text-align:center;font-size:10px;color:#666;margin-bottom:8px}
    table{width:100%;border-collapse:collapse}
    th{background:#3c3c3c;color:#fff;font-size:9px;padding:6px 4px;border:1px solid #555;font-weight:700}
    td{padding:5px 4px;border:1px solid #ccc;font-size:9px;vertical-align:top}
    .bg-red{background:#fee2e2;color:#dc2626;font-weight:700}
    .bg-green{background:#dcfce7;color:#16a34a}
    .bg-gray{background:#f1f5f9;color:#94a3b8;font-style:italic}
    @media print{body{-webkit-print-color-adjust:exact;print-color-adjust:exact}}
  </style></head><body>
  <h2>PTW Weekly Status Update</h2>
  <div class="sub">Generated: ${new Date().toLocaleDateString()}</div>
  <table><thead><tr><th style="width:12%">Company</th><th style="width:20%">Location</th><th style="width:30%">Description</th><th style="width:10%">PTW No.</th><th style="width:13%">Valid Date</th><th style="width:15%">Unclosed</th></tr></thead><tbody>`;
  rows.forEach(co=>{
    const uc=getUnclosed(co.company);
    co.items.forEach((item,ii)=>{
      const cls=item.noWork?"bg-gray":item.expired?"bg-red":(!item.noWork&&item.validDate&&item.validDate!=="-")?"bg-green":"";
      const vd=item.validDate&&item.validDate!=="-"?fmtD(item.validDate):"-";
      html+="<tr>"
        +"<td>"+(ii===0?co.company:"")+"</td>"
        +"<td>"+item.loc+"</td>"
        +'<td class="'+cls+'">'+(item.noWork?"暫無工作":item.desc)+"</td>"
        +'<td class="'+cls+'">'+(item.ptwNo||"")+"</td>"
        +'<td class="'+cls+'">'+vd+"</td>"
        +"<td>"+(ii===0?uc:"")+"</td>"
        +"</tr>";
    });
  });
  html+=`</tbody></table><script>window.onload=function(){window.print()}<\/script></body></html>`;
  const w=window.open("","_blank");
  if(w){w.document.write(html);w.document.close()}
  else{alert("請允許彈出視窗 (pop-up) 以輸出列印頁面")}
}


const c={bg:"#0c1220",card:"#141e30",accent:"#38bdf8",danger:"#f87171",success:"#34d399",warn:"#fbbf24",text:"#e2e8f0",dim:"#94a3b8",border:"#253552",input:"#0f1a2e"};
const iS={width:"100%",padding:"10px 14px",borderRadius:8,border:"1px solid #253552",background:"#0f1a2e",color:"#e2e8f0",fontSize:14,fontFamily:"inherit",boxSizing:"border-box"};

function fmtD(d){if(!d)return"—";const s=String(d).trim();if(!s)return"—";const m1=s.match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);if(m1)return m1[1]+"/"+m1[2].padStart(2,"0")+"/"+m1[3].padStart(2,"0");const m2=s.match(/^(\d{4})\/(\d{1,2})\/(\d{1,2})/);if(m2)return m2[1]+"/"+m2[2].padStart(2,"0")+"/"+m2[3].padStart(2,"0");const m3=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);if(m3)return m3[3]+"/"+m3[1].padStart(2,"0")+"/"+m3[2].padStart(2,"0");return s}
function ptwNum(s){const m=(s||"").match(/(\d+)$/);return m?parseInt(m[1],10):0}
function normLoc(s){return(s||"").replace(/\n/g," ").split(/\s+/)[0].replace(/[（(].*/,"")}

function getNextCertNum(records,catKey,prefix){
  let max=0;
  records.forEach(r=>{const v=r[catKey];if(v&&v.trim()){const m=v.match(/\d+$/);if(m)max=Math.max(max,parseInt(m[0],10))}});
  return prefix+"-"+String(max+1).padStart(3,"0");
}

function getNextPTW(records){
  let max=0;
  records.forEach(r=>{const n=ptwNum(r.ptwNumber);if(n>max)max=n});
  return "PTW-"+String(max+1).padStart(3,"0");
}

function Sec({icon,zh,en,color}){return <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14,paddingBottom:6,borderBottom:"2px solid "+color+"33"}}><span style={{fontSize:16}}>{icon}</span><span style={{fontSize:14,fontWeight:800,color}}>{zh}</span><span style={{fontSize:11,color:"#94a3b8"}}>{en}</span></div>}
function Fld({label,req,children}){return <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>{label}{req&&<span style={{color:"#f87171"}}> *</span>}</label>{children}</div>}

/* ============================================================ */
/*  WEEKLY SUMMARY GENERATOR                                     */
/* ============================================================ */
function generateWeeklySummary(records){
  const today=new Date();
  const coGroups={};
  
  // known main locations per logic
  const mainLocs=["台中工區","通霄工區","管線暫置區","通霄電廠","28號碼頭","天力儲區","37號碼頭","44/45碼頭","103號碼頭","船邊作業碼頭","台中港106碼頭"];
  
  records.forEach(r=>{
    const co=r.applyCompany;
    if(!coGroups[co])coGroups[co]={records:[],locs:{}};
    coGroups[co].records.push(r);
    const loc=normLoc(r.location);
    if(!coGroups[co].locs[loc])coGroups[co].locs[loc]=[];
    coGroups[co].locs[loc].push(r);
  });

  const rows=[];
  const coOrder=COS.filter(co=>coGroups[co]);
  
  coOrder.forEach(co=>{
    const g=coGroups[co];
    const locEntries=Object.entries(g.locs);
    // sort locations by most recent PTW
    locEntries.sort((a,b)=>{
      const maxA=Math.max(...a[1].map(r=>ptwNum(r.ptwNumber)));
      const maxB=Math.max(...b[1].map(r=>ptwNum(r.ptwNumber)));
      return maxB-maxA;
    });
    
    // unclosed for this company
    const unclosed=g.records.filter(r=>!r.closingDate||r.closingDate.trim()==="");
    const unclosedNums=unclosed.map(r=>ptwNum(r.ptwNumber)).sort((a,b)=>a-b);
    
    const coRows=[];
    locEntries.forEach(([loc,recs])=>{
      // get latest PTW by number
      const sorted=[...recs].sort((a,b)=>ptwNum(b.ptwNumber)-ptwNum(a.ptwNumber));
      const latest=sorted[0];
      const isClosed=latest.closingDate&&latest.closingDate.trim()!=="";
      const isExpired=latest.validDate&&new Date(latest.validDate)<today;
      
      // Check if this location has any open/active PTW
      const hasActive=recs.some(r=>(!r.closingDate||r.closingDate.trim()===""));
      
      if(isClosed&&!hasActive){
        coRows.push({loc,desc:"暫無工作",ptwNo:"-",validDate:"-",noWork:true,expired:false});
      }else{
        // show most recent active, or latest if still valid
        const activeRecs=sorted.filter(r=>!r.closingDate||r.closingDate.trim()==="");
        const show=activeRecs.length?activeRecs[0]:latest;
        coRows.push({
          loc,
          desc:(show.workDescription||"").replace(/\n/g,"、"),
          ptwNo:String(ptwNum(show.ptwNumber)),
          validDate:show.validDate||"-",
          noWork:false,
          expired:show.validDate&&new Date(show.validDate)<today,
          expiringSoon:show.validDate&&(()=>{const v=new Date(show.validDate);const diff=(v-today)/(1000*60*60*24);return diff>=0&&diff<=3})()
        });
      }
    });
    
    rows.push({
      company:co,
      items:coRows,
      unclosedCount:unclosed.length,
      unclosedNums:unclosedNums.join(",")
    });
  });
  
  return rows;
}

/* ============================================================ */
/*  EXPORT MODAL                                                 */
/* ============================================================ */
function ExportModal({records,onClose}){
  const [mode,setMode]=useState("all");
  const [expCo,setExpCo]=useState("");
  const [dateFrom,setDateFrom]=useState("");
  const [dateTo,setDateTo]=useState("");
  const [summaryData,setSummaryData]=useState(null);
  const printRef=useRef(null);

  const today=new Date();
  const dow=today.getDay();
  const satOff=dow>=6?0:-(dow+1);
  const wkS=new Date(today);wkS.setDate(today.getDate()+satOff);wkS.setHours(0,0,0,0);
  const wkE=new Date(wkS);wkE.setDate(wkS.getDate()+6);wkE.setHours(23,59,59,999);

  const getFiltered=()=>{
    let r=[...records];
    if(mode==="company"&&expCo)r=r.filter(x=>x.applyCompany===expCo);
    if(mode==="dateRange"){
      if(dateFrom)r=r.filter(x=>x.issuingDate&&new Date(x.issuingDate)>=new Date(dateFrom));
      if(dateTo)r=r.filter(x=>x.issuingDate&&new Date(x.issuingDate)<=new Date(dateTo+"T23:59:59"));
    }
    if(mode==="weekly"){
      r=r.filter(x=>{
        const uc=!x.closingDate||x.closingDate.trim()==="";
        const av=x.validDate&&new Date(x.validDate)>=today;
        return uc||av;
      });
    }
    return r;
  };

  const [showTablePreview,setShowTablePreview]=useState(false);

  const handleExport=()=>{
    if(mode==="summary"){
      setSummaryData(generateWeeklySummary(records));
    } else {
      setSummaryData(null);
      setShowTablePreview(true);
    }
  };

  const filtered=getFiltered();

  const rOpt=(val,label,desc)=>(
    <label onClick={()=>setMode(val)} style={{display:"flex",alignItems:"flex-start",gap:10,padding:"12px 16px",borderRadius:10,border:"1px solid "+(mode===val?"#38bdf8":"#253552"),background:mode===val?"#38bdf810":"transparent",cursor:"pointer",transition:"all .2s"}}>
      <div style={{width:20,height:20,borderRadius:10,border:"2px solid "+(mode===val?"#38bdf8":"#555"),background:mode===val?"#38bdf8":"transparent",flexShrink:0,marginTop:2,display:"flex",alignItems:"center",justifyContent:"center"}}>
        {mode===val&&<div style={{width:8,height:8,borderRadius:4,background:"#fff"}}/>}
      </div>
      <div><div style={{fontSize:13,fontWeight:700,color:mode===val?"#38bdf8":"#e2e8f0"}}>{label}</div><div style={{fontSize:11,color:"#94a3b8",marginTop:2}}>{desc}</div></div>
    </label>
  );

  return(<>
    <div className="modal-overlay no-print" onClick={e=>{if(e.target===e.currentTarget)onClose()}}>
      <div style={{background:"#141e30",borderRadius:16,border:"1px solid #253552",padding:"28px 32px",maxWidth:520,width:"95vw",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0,0,0,.6)"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}>
          <h3 style={{fontSize:18,fontWeight:900,margin:0}}>🖨 輸出選項 Export Options</h3>
          <button onClick={onClose} style={{width:32,height:32,borderRadius:8,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:16}}>✕</button>
        </div>
        
        <div style={{display:"flex",flexDirection:"column",gap:8,marginBottom:20}}>
          {rOpt("all","📋 輸出全部紀錄","Export all "+records.length+" records")}
          {rOpt("company","🏢 依公司篩選","Filter by company")}
          {mode==="company"&&<div style={{marginLeft:40,marginTop:-4,marginBottom:4}}>
            <select value={expCo} onChange={e=>setExpCo(e.target.value)} style={{...iS,width:200,padding:"7px 10px",fontSize:12}}>
              <option value="">-- 選擇公司 --</option>{COS.map(x=><option key={x}>{x}</option>)}
            </select>
          </div>}
          {rOpt("dateRange","📅 依期間篩選","Filter by date range (issuing date)")}
          {mode==="dateRange"&&<div style={{marginLeft:40,marginTop:-4,marginBottom:4,display:"flex",gap:8,alignItems:"center"}}>
            <input type="date" value={dateFrom} onChange={e=>setDateFrom(e.target.value)} style={{...iS,width:160,padding:"7px 10px",fontSize:12}}/>
            <span style={{color:"#94a3b8",fontSize:12}}>～</span>
            <input type="date" value={dateTo} onChange={e=>setDateTo(e.target.value)} style={{...iS,width:160,padding:"7px 10px",fontSize:12}}/>
          </div>}
          {rOpt("weekly","📊 週報格式","Unclosed + still valid PTWs ("+records.filter(x=>(!x.closingDate||x.closingDate.trim()==="")||(x.validDate&&new Date(x.validDate)>=today)).length+" records)")}
          {rOpt("summary","📝 每周摘要","PTW 周狀態更新 — by company & location")}
        </div>

        <div style={{background:"#0f1a2e",borderRadius:10,padding:"12px 16px",marginBottom:20,fontSize:12,color:"#94a3b8"}}>
          {mode==="summary"?
            <span>將產生各公司×工作地點的最新 PTW 狀態摘要，所有欄位皆可在輸出前編輯。</span>:
            <span>篩選結果: <strong style={{color:"#38bdf8"}}>{filtered.length}</strong> 筆紀錄 — 橫式 A3 格式，自動換行</span>
          }
        </div>

        <div style={{display:"flex",justifyContent:"flex-end",gap:10}}>
          <button onClick={onClose} style={{padding:"10px 24px",borderRadius:8,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:13}}>取消</button>
          <button onClick={handleExport} style={{padding:"10px 30px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#34d399,#38bdf8)",color:"#0c1220",cursor:"pointer",fontSize:13,fontWeight:800}}>🖨 輸出 PDF</button>
        </div>
      </div>
    </div>

    {/* ===== TABLE PREVIEW (fullscreen) ===== */}
    {showTablePreview&&mode!=="summary"&&<div className="no-print" style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#0c1220",zIndex:300,overflowY:"auto",padding:"20px"}}>
      <div style={{maxWidth:1200,margin:"0 auto"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,flexWrap:"wrap",gap:10}}>
          <h2 style={{fontSize:18,fontWeight:900}}>🖨 輸出預覽 <span style={{fontSize:12,color:"#94a3b8",fontWeight:400}}>— {mode==="all"?"全部紀錄":mode==="company"?"公司篩選: "+(expCo||"全部"):mode==="dateRange"?"期間: "+(dateFrom||"—")+" ~ "+(dateTo||"—"):"週報格式"} | 共 {filtered.length} 筆</span></h2>
          <div style={{display:"flex",gap:8}}>
            <button onClick={()=>{setShowTablePreview(false);onClose()}} style={{padding:"8px 20px",borderRadius:8,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:12}}>← 返回</button>
            <button id="tblCopyBtn" onClick={()=>{
              const cols=["#","PTW No.","Cont.","Company","Issue","Close","Start","Valid","Applicant","Holder","Supv.","EHS","Location","Description","HWC","ELC","DVC","RAD","CSC","EXC","CWC"];
              const hdr="<tr>"+cols.map(h=>"<th>"+h+"</th>").join("")+"</tr>";
              const body=filtered.map(r=>"<tr><td>"+[r.srNo,r.ptwNumber,r.contPtwNo!=="-"?r.contPtwNo:"",r.applyCompany,fmtD(r.issuingDate),fmtD(r.closingDate),fmtD(r.startDate),fmtD(r.validDate),r.applicant,r.holder,r.supervisor,r.ehs,(r.location||"").replace(/\n/g," "),(r.workDescription||"").replace(/\n/g," "),r.hotWork||"",r.electrical||"",r.diving||"",r.radiography||"",r.confinedSpace||"",r.excavation||"",r.coldWork||""].join("</td><td>")+"</td></tr>").join("");
              const html="<table border='1' cellpadding='4' cellspacing='0' style='border-collapse:collapse;font-family:sans-serif;font-size:11px'><thead style='background:#e8e8e8;font-weight:bold'>"+hdr+"</thead><tbody>"+body+"</tbody></table>";
              const text=cols.join("\t")+"\n"+filtered.map(r=>[r.srNo,r.ptwNumber,r.contPtwNo!=="-"?r.contPtwNo:"",r.applyCompany,fmtD(r.issuingDate),fmtD(r.closingDate),fmtD(r.startDate),fmtD(r.validDate),r.applicant,r.holder,r.supervisor,r.ehs,(r.location||"").replace(/\n/g," "),(r.workDescription||"").replace(/\n/g," "),r.hotWork||"",r.electrical||"",r.diving||"",r.radiography||"",r.confinedSpace||"",r.excavation||"",r.coldWork||""].join("\t")).join("\n");
              navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([html],{type:"text/html"}),"text/plain":new Blob([text],{type:"text/plain"})})]).then(()=>{const b=document.getElementById("tblCopyBtn");if(b){b.textContent="✅ 已複製!";setTimeout(()=>b.textContent="📋 複製表格",1500)}})
            }} style={{padding:"8px 20px",borderRadius:8,border:"1px solid #fbbf2444",background:"#fbbf2411",color:"#fbbf24",cursor:"pointer",fontSize:12,fontWeight:700}}>📋 複製表格</button>
            <button onClick={()=>{
              const sub=(mode==="all"?"全部紀錄":mode==="company"?"公司篩選: "+(expCo||"全部"):mode==="dateRange"?"期間: "+(dateFrom||"—")+" ~ "+(dateTo||"—"):"週報格式")+" | 共 "+filtered.length+" 筆 | "+fmtD(new Date().toISOString().slice(0,10));
              exportTablePDF(filtered,mode,sub,fmtD);
            }} style={{padding:"8px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#34d399,#38bdf8)",color:"#0c1220",cursor:"pointer",fontSize:13,fontWeight:800}}>🖨 輸出PDF</button>
          </div>
        </div>
        <div style={{background:"#141e30",borderRadius:14,border:"1px solid #253552",overflow:"hidden"}}>
          <div style={{textAlign:"center",padding:"14px",borderBottom:"1px solid #253552"}}>
            <div style={{fontSize:18,fontWeight:900}}>PTW Register 工作許可紀錄表</div>
            <div style={{fontSize:11,color:"#94a3b8",marginTop:4}}>
              {mode==="all"&&"全部紀錄"}
              {mode==="company"&&("公司篩選: "+(expCo||"全部"))}
              {mode==="dateRange"&&("期間: "+(dateFrom||"—")+" ~ "+(dateTo||"—"))}
              {mode==="weekly"&&"週報格式 (未關閉 + 仍在效期)"}
              {" | 共 "+filtered.length+" 筆 | "+fmtD(new Date().toISOString().slice(0,10))}
            </div>
          </div>
          <div style={{overflowX:"auto"}}>
          <table style={{width:"100%",borderCollapse:"collapse",fontSize:11}}>
            <thead><tr style={{background:"#1a2744"}}>
              {["#","PTW No.","Cont.","Company","Issue","Close","Start","Valid","Applicant","Holder","Supv.","EHS","Location","Description","HWC","ELC","DVC","RAD","CSC","EXC","CWC"].map(h=>
                <th key={h} style={{padding:"8px 5px",fontSize:10,fontWeight:700,color:"#94a3b8",textAlign:"left",borderBottom:"2px solid #253552",whiteSpace:"nowrap"}}>{h}</th>
              )}
            </tr></thead>
            <tbody>{filtered.map((r,i)=>{
              const isOpen=!r.closingDate||r.closingDate.trim()==="";
              const isExp=r.validDate&&new Date(r.validDate)<new Date();
              return(<tr key={i} style={{background:i%2===0?"#141e30":"#1a274422",borderBottom:"1px solid #253552"}}>
                <td style={{padding:"6px 5px",fontSize:10,color:"#94a3b8"}}>{r.srNo}</td>
                <td style={{padding:"6px 5px",fontWeight:700,color:"#38bdf8",fontSize:11}}>{r.ptwNumber}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.contPtwNo!=="-"?r.contPtwNo:""}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.applyCompany}</td>
                <td style={{padding:"6px 5px",fontSize:10,whiteSpace:"nowrap"}}>{fmtD(r.issuingDate)}</td>
                <td style={{padding:"6px 5px",fontSize:10,whiteSpace:"nowrap"}}>{r.closingDate&&r.closingDate.trim()?<span style={{color:"#34d399"}}>{fmtD(r.closingDate)}</span>:<span style={{color:"#f87171",fontWeight:700}}>未關閉</span>}</td>
                <td style={{padding:"6px 5px",fontSize:10,whiteSpace:"nowrap"}}>{fmtD(r.startDate)}</td>
                <td style={{padding:"6px 5px",fontSize:10,whiteSpace:"nowrap",color:isOpen&&isExp?"#f87171":"inherit",fontWeight:isOpen&&isExp?700:400}}>{fmtD(r.validDate)}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.applicant}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.holder}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.supervisor}</td>
                <td style={{padding:"6px 5px",fontSize:10}}>{r.ehs}</td>
                <td style={{padding:"6px 5px",fontSize:10,maxWidth:120,wordBreak:"break-word"}}>{(r.location||"")}</td>
                <td style={{padding:"6px 5px",fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:"1.4"}}>{(r.workDescription||"")}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.hotWork||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.electrical||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.diving||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.radiography||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.confinedSpace||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.excavation||""}</td>
                <td style={{padding:"6px 5px",fontSize:10,textAlign:"center"}}>{r.coldWork||""}</td>
              </tr>)
            })}</tbody>
          </table>
          </div>
        </div>
      </div>
    </div>}

    {/* ===== PRINT CSS VIEW (for window.print) ===== */}

    {mode==="summary"&&summaryData&&<SummaryPrintView data={summaryData} records={records}/>}
  </>);
}

/* ============================================================ */
/*  SUMMARY PRINT VIEW (editable before print)                   */
/* ============================================================ */
function SummaryPrintView({data,records}){
  const [rows,setRows]=useState(data);
  const today=new Date();
  const todayStr=today.getFullYear()+"-"+String(today.getMonth()+1).padStart(2,"0")+"-"+String(today.getDate()).padStart(2,"0");

  const getDateColor=(vd)=>{
    if(!vd||vd==="-")return{bg:"transparent",fg:"#e2e8f0",isRed:false};
    const cmp=vd.replace(/\//g,"-");
    if(cmp>todayStr)return{bg:"#34d39922",fg:"#34d399",isRed:false};
    return{bg:"#f87171",fg:"#fff",isRed:true};
  };

  const getUnclosed=(company)=>{
    const uc=records.filter(r=>r.applyCompany===company&&(!r.closingDate||r.closingDate.trim()===""));
    const nums=uc.map(r=>ptwNum(r.ptwNumber)).sort((a,b)=>a-b);
    return uc.length>0?uc.length+"("+nums.join(",")+")":"0";
  };

  const updateCell=(coIdx,itemIdx,field,value)=>{
    setRows(prev=>{
      const n=[...prev];
      n[coIdx]={...n[coIdx],items:[...n[coIdx].items]};
      n[coIdx].items[itemIdx]={...n[coIdx].items[itemIdx],[field]:value};
      return n;
    });
  };
  const updateDateCell=(coIdx,itemIdx,value)=>{
    setRows(prev=>{
      const n=[...prev];
      n[coIdx]={...n[coIdx],items:[...n[coIdx].items]};
      n[coIdx].items[itemIdx]={...n[coIdx].items[itemIdx],validDate:value};
      return n;
    });
  };
  const updateCo=(coIdx,field,value)=>{
    setRows(prev=>{
      const n=[...prev];
      n[coIdx]={...n[coIdx],[field]:field==="unclosedCount"?parseInt(value)||0:value};
      return n;
    });
  };
  const addRow=(coIdx)=>{
    setRows(prev=>{
      const n=[...prev];
      n[coIdx]={...n[coIdx],items:[...n[coIdx].items,{loc:"",desc:"",ptwNo:"-",validDate:"-",noWork:false,expired:false}]};
      return n;
    });
  };
  const removeRow=(coIdx,itemIdx)=>{
    setRows(prev=>{
      const n=[...prev];
      n[coIdx]={...n[coIdx],items:n[coIdx].items.filter((_,i)=>i!==itemIdx)};
      return n;
    });
  };

  return(<>
    {/* On-screen editable preview */}
    <div className="no-print" style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"#0c1220",zIndex:300,overflowY:"auto",padding:"20px"}}>
      <div style={{maxWidth:1100,margin:"0 auto"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
          <h2 style={{fontSize:18,fontWeight:900}}>📝 每周摘要預覽 <span style={{fontSize:12,color:"#94a3b8",fontWeight:400}}>— 點擊任何欄位可編輯</span></h2>
          <div style={{display:"flex",gap:8}}>
            <button onClick={()=>window.history.length>1?window.location.reload():window.location.reload()} style={{padding:"8px 20px",borderRadius:8,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:12}}>← 返回</button>
            <button onClick={()=>{
              const hdr="<tr><th>包商名稱</th><th>工作地點</th><th>預計工作內容</th><th>許可號碼</th><th>許可到期日</th><th>未關數量(號碼)</th></tr>";
              let body="";
              rows.forEach(co=>{co.items.forEach((item,ii)=>{
                body+="<tr>";
                if(ii===0)body+="<td rowspan='"+co.items.length+"'>"+co.company+"</td>";
                body+="<td>"+item.loc+"</td>";
                body+="<td>"+(item.noWork?"暫無工作":item.desc)+"</td>";
                body+="<td style='text-align:center'>"+item.ptwNo+"</td>";
                const dc=getDateColor(item.validDate);
                const vdDisplay=item.validDate&&item.validDate!=="-"?(()=>{try{const dt=new Date(item.validDate);return dt.getFullYear()+"/"+(dt.getMonth()+1).toString().padStart(2,"0")+"/"+dt.getDate().toString().padStart(2,"0")}catch{return item.validDate}})():"-";
                body+="<td style='text-align:center"+(dc.isRed?";background:#ff4444;color:#fff":";color:#22c55e")+";font-weight:bold'>"+vdDisplay+"</td>";
                if(ii===0)body+="<td rowspan='"+co.items.length+"' style='text-align:center'>"+getUnclosed(co.company)+"</td>";
                body+="</tr>"
              })});
              const html="<table border='1' cellpadding='4' cellspacing='0' style='border-collapse:collapse;font-family:sans-serif;font-size:12px'><thead style='background:#e8e8e8;font-weight:bold'>"+hdr+"</thead><tbody>"+body+"</tbody></table>";
              const blob=new Blob([html],{type:"text/html"});
              const text=rows.map(co=>co.items.map((item,ii)=>{const vd=item.validDate&&item.validDate!=="-"?(()=>{try{const dt=new Date(item.validDate);return dt.getFullYear()+"/"+(dt.getMonth()+1).toString().padStart(2,"0")+"/"+dt.getDate().toString().padStart(2,"0")}catch{return item.validDate}})():"-";return[ii===0?co.company:"",item.loc,item.noWork?"暫無工作":item.desc,item.ptwNo,vd,ii===0?getUnclosed(co.company):""].join("\t")}).join("\n")).join("\n");
              navigator.clipboard.write([new ClipboardItem({"text/html":blob,"text/plain":new Blob([text],{type:"text/plain"})})]).then(()=>{const btn=document.getElementById("copyOk");if(btn){btn.textContent="✅ 已複製!";setTimeout(()=>btn.textContent="📋 複製表格",1500)}})
            }} id="copyOk" style={{padding:"8px 20px",borderRadius:8,border:"1px solid #fbbf2444",background:"#fbbf2411",color:"#fbbf24",cursor:"pointer",fontSize:12,fontWeight:700}}>📋 複製表格</button>
            <button onClick={()=>{exportSummaryPDF(rows,getUnclosed,getDateColor,fmtD)}} style={{padding:"8px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#34d399,#38bdf8)",color:"#0c1220",cursor:"pointer",fontSize:13,fontWeight:800}}>🖨 輸出PDF</button>
          </div>
        </div>
        
        <div style={{background:"#141e30",borderRadius:14,border:"1px solid #253552",overflow:"hidden"}}>
          <div style={{textAlign:"center",padding:"16px",borderBottom:"1px solid #253552"}}>
            <div style={{fontSize:20,fontWeight:900}}>PTW 周狀態更新 {fmtD(new Date().toISOString().slice(0,10))}</div>
          </div>
          <table style={{width:"100%",borderCollapse:"collapse",fontSize:13}}>
            <thead><tr style={{background:"#1a2744"}}>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"8%"}}>包商名稱</th>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"12%"}}>工作地點</th>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"40%"}}>預計工作內容</th>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"8%"}}>許可號碼</th>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"12%"}}>許可到期日</th>
              <th style={{padding:"10px 12px",border:"1px solid #253552",fontWeight:700,width:"14%"}}>未關數量(號碼)</th>
              <th style={{padding:"10px 6px",border:"1px solid #253552",fontWeight:700,width:"6%"}} className="no-print">操作</th>
            </tr></thead>
            <tbody>
              {rows.map((co,ci)=>co.items.map((item,ii)=>(
                <tr key={co.company+"-"+ii} style={{background:ii%2===0?"transparent":"#0f1a2e11"}}>
                  {ii===0&&<td rowSpan={co.items.length} style={{padding:"8px 10px",border:"1px solid #253552",fontWeight:700,verticalAlign:"top",background:"#1a274433"}} contentEditable suppressContentEditableWarning onBlur={e=>updateCo(ci,"company",e.target.textContent)}>{co.company}</td>}
                  <td style={{padding:"6px 8px",border:"1px solid #253552"}} contentEditable suppressContentEditableWarning className="editable-cell" onBlur={e=>updateCell(ci,ii,"loc",e.target.textContent)}>{item.loc}</td>
                  <td style={{padding:"6px 8px",border:"1px solid #253552",color:item.noWork?"#94a3b8":"#e2e8f0",fontStyle:item.noWork?"italic":"normal",textAlign:item.noWork?"center":"left"}} contentEditable suppressContentEditableWarning className="editable-cell" onBlur={e=>updateCell(ci,ii,"desc",e.target.textContent)}>{item.desc}</td>
                  <td style={{padding:"6px 8px",border:"1px solid #253552",textAlign:"center",fontFamily:"'JetBrains Mono',monospace",fontWeight:700,color:"#38bdf8"}} contentEditable suppressContentEditableWarning className="editable-cell" onBlur={e=>updateCell(ci,ii,"ptwNo",e.target.textContent)}>{item.ptwNo}</td>
                  <td style={{padding:"4px 6px",border:"1px solid #253552",textAlign:"center",fontWeight:700,background:getDateColor(item.validDate).bg,color:getDateColor(item.validDate).fg}}><input type="date" value={(item.validDate&&item.validDate!=="-")?item.validDate.replace(/\//g,"-"):""} onChange={e=>updateDateCell(ci,ii,e.target.value)} style={{background:"transparent",border:"none",color:"inherit",fontWeight:700,fontSize:12,textAlign:"center",width:"100%",cursor:"pointer"}}/></td>
                  {ii===0&&<td rowSpan={co.items.length} style={{padding:"8px 10px",border:"1px solid #253552",textAlign:"center",verticalAlign:"top",fontWeight:700,fontSize:12}}>{getUnclosed(co.company)}</td>}
                  <td style={{padding:"4px",border:"1px solid #253552",textAlign:"center"}} className="no-print">
                    <button onClick={()=>removeRow(ci,ii)} style={{width:22,height:22,borderRadius:4,border:"1px solid #f8717133",background:"#f8717111",color:"#f87171",cursor:"pointer",fontSize:10}}>✕</button>
                  </td>
                </tr>
              )))}
              {rows.map((co,ci)=>(
                <tr key={"add-"+ci} className="no-print">
                  <td colSpan={7} style={{padding:"4px 8px",border:"1px solid #253552"}}>
                    <button onClick={()=>addRow(ci)} style={{padding:"3px 12px",borderRadius:4,border:"1px dashed #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:11}}>+ 新增 {co.company} 列</button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    {/* Actual print view */}
    <div className="print-view" style={{display:"none"}}>
      <div className="print-title">PTW 周狀態更新 {fmtD(new Date().toISOString().slice(0,10))}</div>
      <table className="summary-table">
        <thead><tr>
          <th style={{width:"8%"}}>包商名稱</th>
          <th style={{width:"12%"}}>工作地點</th>
          <th style={{width:"40%"}}>預計工作內容</th>
          <th style={{width:"8%"}}>許可號碼</th>
          <th style={{width:"14%"}}>許可到期日</th>
          <th style={{width:"14%"}}>未關數量(號碼)</th>
        </tr></thead>
        <tbody>
          {rows.map((co,ci)=>co.items.map((item,ii)=>(
            <tr key={co.company+"-p-"+ii}>
              {ii===0&&<td rowSpan={co.items.length} style={{fontWeight:700,verticalAlign:"top"}}>{co.company}</td>}
              <td>{item.loc}</td>
              <td className={item.noWork?"no-work":""}>{item.desc}</td>
              <td style={{textAlign:"center",fontWeight:700}}>{item.ptwNo}</td>
              <td style={{textAlign:"center",fontWeight:700}} className={getDateColor(item.validDate).isRed?"expired-date":(item.validDate&&item.validDate!=="-"?"green-date":"")}>{item.validDate&&item.validDate!=="-"?fmtD(item.validDate):"-"}</td>
              {ii===0&&<td rowSpan={co.items.length} style={{textAlign:"center",fontWeight:700,verticalAlign:"top"}}>{getUnclosed(co.company)}</td>}
            </tr>
          )))}
        </tbody>
      </table>
    </div>
  </>);
}

/* ============================================================ */
/*  MAIN APP                                                     */
/* ============================================================ */
/* ===== CLOUD SYNC CONFIG ===== */
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzkY-2GE-WwWRrlrCcvmYr_mxSZbVUwo_rMipL26XxDXDjNhg3p79p10FqxxG3soegT/exec";  // ← 貼上你的 Google Apps Script 網址

async function cloudUpload(sheetName, data) {
  if (!APPS_SCRIPT_URL) throw new Error("尚未設定雲端同步網址");
  try {
    const res = await fetch(APPS_SCRIPT_URL + "?action=write&sheet=" + encodeURIComponent(sheetName), {
      method: "POST",
      body: JSON.stringify(data),
      redirect: "follow"
    });
    const text = await res.text();
    try { return JSON.parse(text); } catch(e) { return { success: true, raw: text }; }
  } catch(e) {
    // If CORS blocks reading response, try no-cors (fire-and-forget)
    await fetch(APPS_SCRIPT_URL + "?action=write&sheet=" + encodeURIComponent(sheetName), {
      method: "POST",
      mode: "no-cors",
      body: JSON.stringify(data)
    });
    return { success: true, message: "已送出（no-cors mode）" };
  }
}

async function cloudDownload(sheetName) {
  if (!APPS_SCRIPT_URL) throw new Error("尚未設定雲端同步網址");
  // Use Google Apps Script redirect workaround
  const url = APPS_SCRIPT_URL + "?action=read&sheet=" + encodeURIComponent(sheetName);
  try {
    const res = await fetch(url, { redirect: "follow" });
    const text = await res.text();
    return JSON.parse(text);
  } catch(e1) {
    // Fallback: use script tag JSONP-style or try with no-cors
    throw new Error("下載失敗: " + e1.message + "。請確認 Apps Script 部署設定為「所有人」可存取");
  }
}

const LS_KEY="ptw_records";
const LS_SNAP="ptw_snapshots";
const LS_PERSONS="ptw_persons";
function loadRecords(){try{const s=localStorage.getItem(LS_KEY);if(s){const d=JSON.parse(s);if(Array.isArray(d)&&d.length)return d}}catch(e){}return INIT}
function saveToLS(records){try{localStorage.setItem(LS_KEY,JSON.stringify(records))}catch(e){}}
function loadPersons(){try{const s=localStorage.getItem(LS_PERSONS);if(s){const d=JSON.parse(s);if(Array.isArray(d)&&d.length)return d}}catch(e){}return PERSONS}
function savePersonsLS(p){try{localStorage.setItem(LS_PERSONS,JSON.stringify(p))}catch(e){}}
function loadSnapshots(){try{const s=localStorage.getItem(LS_SNAP);if(s)return JSON.parse(s)}catch(e){}return[]}
function saveSnapshot(records,label){try{const snaps=loadSnapshots();snaps.unshift({label,time:new Date().toISOString(),count:records.length,data:records});if(snaps.length>20)snaps.length=20;localStorage.setItem(LS_SNAP,JSON.stringify(snaps))}catch(e){}}

/* ============= Login Modal ============= */
function LoginModal({c,loginErr,doLogin,onClose}){
  const [u,setU]=useState("");
  const [p,setP]=useState("");
  const iSL={background:"#1a2744",border:"1px solid #253552",borderRadius:8,padding:"10px 14px",color:"#e2e8f0",width:"100%",fontSize:13,boxSizing:"border-box"};
  return(<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001}} onClick={onClose}>
    <div style={{background:c.card,borderRadius:16,padding:"32px 36px",border:"1px solid "+c.border,minWidth:340,maxWidth:400}} onClick={e=>e.stopPropagation()}>
      <div style={{textAlign:"center",marginBottom:20}}>
        <div style={{width:48,height:48,borderRadius:12,background:"linear-gradient(135deg,#38bdf8,#6366f1)",display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:900,fontSize:22,color:"#fff",marginBottom:10}}>🔑</div>
        <div style={{fontSize:16,fontWeight:800}}>登入 Login</div>
        <div style={{fontSize:11,color:c.dim,marginTop:4}}>登入後可使用編輯功能</div>
      </div>
      <div style={{marginBottom:12}}>
        <label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>帳號 Username</label>
        <input value={u} onChange={e=>setU(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")doLogin(u,p)}} placeholder="請輸入帳號" autoFocus style={iSL}/>
      </div>
      <div style={{marginBottom:16}}>
        <label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>密碼 Password</label>
        <input type="password" value={p} onChange={e=>setP(e.target.value)} onKeyDown={e=>{if(e.key==="Enter")doLogin(u,p)}} placeholder="請輸入密碼" style={iSL}/>
      </div>
      {loginErr&&<div style={{color:c.danger,fontSize:12,fontWeight:700,marginBottom:12,textAlign:"center"}}>{loginErr}</div>}
      <button onClick={()=>doLogin(u,p)} style={{width:"100%",padding:"10px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:14,fontWeight:700}}>登入</button>
    </div>
  </div>);
}

/* ============= Personnel View ============= */
function PersonnelView({persons,setPersons,c,show,askConfirm,isAuth}){
  const [pSearch,setPSearch]=useState("");
  const [pUnit,setPUnit]=useState("");
  const [pCo,setPCo]=useState("");
  const [showAdd,setShowAdd]=useState(false);
  const [editP,setEditP]=useState(null);
  const emptyP={unit:"Performing",dept:"-",company:"",person:"",title:"",trainedDate:new Date().toISOString().slice(0,10),remark:""};
  const [pForm,setPForm]=useState(emptyP);
  const iSp={background:"#1a2744",border:"1px solid #253552",borderRadius:8,padding:"8px 12px",color:"#e2e8f0",width:"100%",fontSize:13,boxSizing:"border-box"};
  const allCos=useMemo(()=>{
    const base=pUnit?persons.filter(p=>p.unit===pUnit):persons;
    return[...new Set(base.map(p=>p.company).filter(Boolean))].sort();
  },[persons,pUnit]);
  useEffect(()=>{if(pCo&&!allCos.includes(pCo))setPCo("")},[pUnit]);

  const filtered=useMemo(()=>{
    let r=[...persons];
    if(pUnit)r=r.filter(x=>x.unit===pUnit);
    if(pCo)r=r.filter(x=>x.company===pCo);
    if(pSearch){const s=pSearch.toLowerCase();r=r.filter(x=>[x.person,x.company,x.title,x.dept].some(v=>(v||"").toLowerCase().includes(s)))}
    return r;
  },[persons,pUnit,pCo,pSearch]);

  const submitP=()=>{
    if(!pForm.person.trim()||!pForm.company.trim()){show("請填寫姓名及公司","err");return}
    if(editP!==null){
      setPersons(prev=>prev.map((p,i)=>i===editP?{...pForm,no:p.no}:p));
      show("✅ 已更新 "+pForm.person);
    }else{
      const maxNo=persons.reduce((m,p)=>Math.max(m,p.no||0),0);
      setPersons(prev=>[...prev,{...pForm,no:maxNo+1}]);
      show("✅ 已新增 "+pForm.person);
    }
    setPForm(emptyP);setShowAdd(false);setEditP(null);
  };

  const issCount=persons.filter(p=>p.unit==="Issuing").length;
  const perfCount=persons.filter(p=>p.unit==="Performing").length;

  return(<div>
    <div className="ptw-dash-header" style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14,flexWrap:"wrap",gap:10}}>
      <div>
        <h2 style={{fontSize:18,fontWeight:800,margin:0}}>👤 合格人員 Certified Personnel ({filtered.length}/{persons.length})</h2>
        <div style={{fontSize:11,color:c.dim,marginTop:4}}>Issuing {issCount} 人 | Performing {perfCount} 人 | 共 {persons.length} 人</div>
      </div>
      <div className="ptw-dash-controls" style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
        <input value={pSearch} onChange={e=>setPSearch(e.target.value)} placeholder="🔍 搜尋姓名/公司/職稱..." style={{...iSp,width:190,padding:"7px 12px",fontSize:12}}/>
        <select value={pUnit} onChange={e=>setPUnit(e.target.value)} style={{...iSp,width:110,padding:"7px 10px",fontSize:12}}>
          <option value="">全部類型</option><option value="Issuing">Issuing</option><option value="Performing">Performing</option>
        </select>
        <select value={pCo} onChange={e=>setPCo(e.target.value)} style={{...iSp,width:120,padding:"7px 10px",fontSize:12}}>
          <option value="">全部公司</option>{allCos.map(x=><option key={x}>{x}</option>)}
        </select>
        {isAuth&&<button onClick={()=>{setPForm(emptyP);setEditP(null);setShowAdd(true)}} style={{padding:"8px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:700}}>+ 新增人員</button>}
      </div>
    </div>

    <div className="ptw-table-wrap" style={{overflowX:"auto"}}>
    <table style={{width:"100%",minWidth:900,borderCollapse:"separate",borderSpacing:"0 3px",fontSize:12}}>
      <thead><tr style={{background:"#1a2744"}}>
        {["#","類型","部門","公司","姓名","職稱","訓練日期","備註"].concat(isAuth?["操作"]:[]).map(h=>
          <th key={h} style={{padding:"10px 8px",textAlign:"left",fontSize:11,fontWeight:700,color:"#94a3b8",borderBottom:"2px solid #253552"}}>{h}</th>
        )}
      </tr></thead>
      <tbody>{filtered.map((p,idx)=>{
        const realIdx=persons.indexOf(p);
        return(
        <tr key={p.no+"-"+idx} style={{background:idx%2===0?"#141e30":"#1a274422"}}>
          <td style={{padding:"8px",fontSize:11,color:c.dim}}>{p.no}</td>
          <td style={{padding:"8px"}}><span style={{padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700,background:p.unit==="Issuing"?"#6366f122":"#34d39922",color:p.unit==="Issuing"?"#818cf8":"#34d399"}}>{p.unit}</span></td>
          <td style={{padding:"8px",fontSize:11}}>{p.dept||"-"}</td>
          <td style={{padding:"8px"}}><span style={{padding:"2px 6px",borderRadius:4,fontSize:10,fontWeight:700,background:c.accent+"18",color:c.accent}}>{p.company}</span></td>
          <td style={{padding:"8px",fontWeight:700}}>{p.person}</td>
          <td style={{padding:"8px",fontSize:11}}>{p.title}</td>
          <td style={{padding:"8px",fontSize:11,whiteSpace:"nowrap"}}>{fmtD(p.trainedDate)}</td>
          <td style={{padding:"8px",fontSize:11,color:p.remark?"#fbbf24":c.dim}}>{p.remark||"-"}</td>
          {isAuth&&<td style={{padding:"8px"}}>
            <div style={{display:"flex",gap:3}}>
              <button onClick={()=>{setPForm({...p});setEditP(realIdx);setShowAdd(true)}} style={{width:26,height:26,borderRadius:5,border:"1px solid "+c.accent+"44",background:c.accent+"11",color:c.accent,cursor:"pointer",fontSize:11}}>✏️</button>
              <button onClick={()=>askConfirm("確定刪除「"+p.person+"」？",()=>{setPersons(prev=>prev.filter((_,i)=>i!==realIdx));show("已刪除 "+p.person)})} style={{width:26,height:26,borderRadius:5,border:"1px solid #f8717144",background:"#f8717111",color:"#f87171",cursor:"pointer",fontSize:11}}>🗑</button>
            </div>
          </td>}
        </tr>)
      })}</tbody>
    </table>
    </div>
    {filtered.length===0&&<div style={{textAlign:"center",padding:40,color:c.dim,fontSize:13}}>無符合條件的人員</div>}

    {showAdd&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999}} onClick={()=>{setShowAdd(false);setEditP(null)}}>
      <div style={{background:c.card,borderRadius:16,padding:"28px 32px",border:"1px solid "+c.border,maxWidth:480,width:"92vw",maxHeight:"85vh",overflowY:"auto"}} onClick={e=>e.stopPropagation()}>
        <div style={{fontSize:16,fontWeight:800,marginBottom:18}}>{editP!==null?"✏️ 編輯人員":"➕ 新增合格人員"}</div>
        <div className="ptw-chart-grid" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12}}>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>類型 Unit <span style={{color:"#f87171"}}>*</span></label>
            <select value={pForm.unit} onChange={e=>setPForm(p=>({...p,unit:e.target.value}))} style={iSp}>
              <option value="Issuing">Issuing</option><option value="Performing">Performing</option>
            </select>
          </div>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>部門 Dept.</label>
            <input value={pForm.dept} onChange={e=>setPForm(p=>({...p,dept:e.target.value}))} style={iSp}/>
          </div>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>公司 Company <span style={{color:"#f87171"}}>*</span></label>
            <input value={pForm.company} onChange={e=>setPForm(p=>({...p,company:e.target.value}))} list="pCos" style={iSp}/>
            <datalist id="pCos">{allCos.map(x=><option key={x} value={x}/>)}</datalist>
          </div>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>姓名 Name <span style={{color:"#f87171"}}>*</span></label>
            <input value={pForm.person} onChange={e=>setPForm(p=>({...p,person:e.target.value}))} style={iSp}/>
          </div>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>職稱 Title</label>
            <input value={pForm.title} onChange={e=>setPForm(p=>({...p,title:e.target.value}))} style={iSp}/>
          </div>
          <div><label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>訓練日期 Trained Date</label>
            <input type="date" value={pForm.trainedDate} onChange={e=>setPForm(p=>({...p,trainedDate:e.target.value}))} style={iSp}/>
          </div>
        </div>
        <div style={{marginBottom:18}}>
          <label style={{display:"block",fontSize:11,fontWeight:600,color:"#94a3b8",marginBottom:5}}>備註 Remark</label>
          <input value={pForm.remark} onChange={e=>setPForm(p=>({...p,remark:e.target.value}))} style={iSp}/>
        </div>
        <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
          <button onClick={()=>{setShowAdd(false);setEditP(null)}} style={{padding:"9px 20px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:13}}>取消</button>
          <button onClick={submitP} style={{padding:"9px 24px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:700}}>{editP!==null?"更新":"新增"}</button>
        </div>
      </div>
    </div>}
  </div>);
}

function App(){
  const [records,setRecords]=useState(()=>loadRecords());
  const [persons,setPersons]=useState(()=>loadPersons());
  const [isAuth,setIsAuth]=useState(false);
  const [showLogin,setShowLogin]=useState(false);
  const [showSync,setShowSync]=useState(false);
  const [syncing,setSyncing]=useState(false);
  const [cloudLoading,setCloudLoading]=useState(!!APPS_SCRIPT_URL);
  const [loginErr,setLoginErr]=useState("");
  const [form,setForm]=useState(empty);
  const [view,setView]=useState("dashboard");
  const [editIdx,setEditIdx]=useState(null);
  const [toast,setToast]=useState(null);
  const [search,setSearch]=useState("");
  const [filterCo,setFilterCo]=useState("");
  const [page,setPage]=useState(0);
  const [showExport,setShowExport]=useState(false);
  const [closingIdx,setClosingIdx]=useState(null);
  const [closeDate,setCloseDate]=useState("");
  const [showRestore,setShowRestore]=useState(false);
  const [confirmDlg,setConfirmDlg]=useState(null);
  const [tblWeekOn,setTblWeekOn]=useState(false);
  const tblToday=new Date();
  const tblDow=tblToday.getDay();
  const tblSatOff=tblDow>=6?0:-(tblDow+1);
  const tblDefS=new Date(tblToday.getFullYear(),tblToday.getMonth(),tblToday.getDate()+tblSatOff);
  const tblDefE=new Date(tblDefS.getFullYear(),tblDefS.getMonth(),tblDefS.getDate()+6);
  const tblFmt=d=>{const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,"0"),dd=String(d.getDate()).padStart(2,"0");return y+"-"+m+"-"+dd};
  const [tblWkS,setTblWkS]=useState(tblFmt(tblDefS));
  const [tblWkE,setTblWkE]=useState(tblFmt(tblDefE));
  const tblSnapSat=(val)=>{const p=val.split("-").map(Number);const dt=new Date(p[0],p[1]-1,p[2]);const dw=dt.getDay();const off=dw>=6?0:-(dw+1);dt.setDate(dt.getDate()+off);return dt};
  const tblPickDate=(val)=>{const s=tblSnapSat(val);const e=new Date(s.getFullYear(),s.getMonth(),s.getDate()+6);setTblWkS(tblFmt(s));setTblWkE(tblFmt(e))};
  const tblQuickWeek=(offset)=>{if(offset===0){setTblWkS(tblFmt(tblDefS));setTblWkE(tblFmt(tblDefE));return}const cur=tblSnapSat(tblWkS);cur.setDate(cur.getDate()+offset*7);const e=new Date(cur.getFullYear(),cur.getMonth(),cur.getDate()+6);setTblWkS(tblFmt(cur));setTblWkE(tblFmt(e))};
  const tblDayNames=["日","一","二","三","四","五","六"];
  const topScrollRef=useRef(null);
  const tblScrollRef=useRef(null);
  const syncingRef=useRef(false);
  const syncScroll=(src,dst)=>{if(syncingRef.current)return;syncingRef.current=true;dst.scrollLeft=src.scrollLeft;syncingRef.current=false};
  const PER=50;

  const show=(msg,t="success")=>{setToast({msg,t});setTimeout(()=>setToast(null),2200)};
  useEffect(()=>{saveToLS(records)},[records]);
  useEffect(()=>{savePersonsLS(persons)},[persons]);

  /* 雲端資料正規化 - 確保型別和格式正確 */
  const normDate=(v)=>{
    if(!v||typeof v!=="string"||!v.trim())return"";
    const s=v.trim();
    if(/^\d{4}-\d{2}-\d{2}$/.test(s))return s;
    if(/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(s)){const p=s.split("/");return p[0]+"-"+p[1].padStart(2,"0")+"-"+p[2].padStart(2,"0")}
    const m1=s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
    if(m1)return m1[3]+"-"+m1[1].padStart(2,"0")+"-"+m1[2].padStart(2,"0");
    try{const d=new Date(s);if(!isNaN(d.getTime()))return d.getFullYear()+"-"+(d.getMonth()+1).toString().padStart(2,"0")+"-"+d.getDate().toString().padStart(2,"0")}catch(e){}
    return"";
  };
  const normalizeRecords=(data)=>data.map(r=>{
    const n={};
    Object.keys(r).forEach(k=>{n[k]=typeof r[k]==="string"?r[k].trim():r[k]});
    n.srNo=parseInt(r.srNo)||0;
    ["issuingDate","closingDate","startDate","validDate"].forEach(k=>{n[k]=normDate(r[k])});
    return n;
  });
  const normalizePersons=(data)=>data.map(p=>{
    const n={};
    Object.keys(p).forEach(k=>{n[k]=typeof p[k]==="string"?p[k].trim():p[k]});
    n.no=parseInt(p.no)||0;
    if(p.trainedDate)n.trainedDate=normDate(p.trainedDate);
    return n;
  });

  /* 網頁開啟時自動從雲端載入最新資料 */
  useEffect(()=>{
    if(!APPS_SCRIPT_URL){setCloudLoading(false);return}
    (async()=>{
      try{
        const r1=await cloudDownload("PTW");
        const r2=await cloudDownload("Persons");
        if(r1.success&&r1.data&&r1.data.length>0){const d=normalizeRecords(r1.data);setRecords(d);saveToLS(d)}
        if(r2.success&&r2.data&&r2.data.length>0){const d=normalizePersons(r2.data);setPersons(d);savePersonsLS(d)}
        show("☁️ 已自動載入雲端資料 (PTW "+(r1.data?r1.data.length:0)+", 人員 "+(r2.data?r2.data.length:0)+")");
      }catch(e){show("⚠️ 雲端同步失敗，使用本機資料")}
      finally{setCloudLoading(false)}
    })();
  },[]);
  const doSave=()=>{saveSnapshot(records,"手動儲存");saveToLS(records);savePersonsLS(persons);show("💾 已儲存 ("+records.length+" 筆紀錄, "+persons.length+" 位人員)")};
  const askConfirm=(msg,onYes)=>setConfirmDlg({msg,onYes});
  const doLogin=async(u,p)=>{
    if(u==="NMDC"&&p==="00180225"){
      setIsAuth(true);setShowLogin(false);setLoginErr("");
      show("🔓 已登入，正在同步雲端資料...");
      if(APPS_SCRIPT_URL){
        try{
          const r1=await cloudDownload("PTW");
          const r2=await cloudDownload("Persons");
          if(r1.success&&r1.data&&r1.data.length>0){const d=normalizeRecords(r1.data);setRecords(d);saveToLS(d)}
          if(r2.success&&r2.data&&r2.data.length>0){const d=normalizePersons(r2.data);setPersons(d);savePersonsLS(d)}
          show("☁️ 已載入最新雲端資料 (PTW "+(r1.data?r1.data.length:0)+", 人員 "+(r2.data?r2.data.length:0)+")");
        }catch(e){show("⚠️ 雲端同步失敗，使用本機資料: "+e.message)}
      }else{show("🔓 已登入，編輯功能已啟用")}
    }else{setLoginErr("帳號或密碼錯誤")}
  };
  const doManualSync=async()=>{
    if(!APPS_SCRIPT_URL){show("⚠️ 尚未設定雲端同步網址");return}
    setCloudLoading(true);
    try{
      const r1=await cloudDownload("PTW");
      const r2=await cloudDownload("Persons");
      if(r1.success&&r1.data&&r1.data.length>0){const d=normalizeRecords(r1.data);setRecords(d);saveToLS(d)}
      if(r2.success&&r2.data&&r2.data.length>0){const d=normalizePersons(r2.data);setPersons(d);savePersonsLS(d)}
      show("☁️ 同步完成！PTW "+(r1.data?r1.data.length:0)+" 筆, 人員 "+(r2.data?r2.data.length:0)+" 筆");
    }catch(e){show("❌ 同步失敗: "+e.message)}
    finally{setCloudLoading(false)}
  };

  const doLogout=()=>{askConfirm("確定要登出？將切換為唯讀模式。",()=>{setIsAuth(false);if(view==="form"||view==="preview")setView("dashboard");show("🔒 已登出，切換為唯讀模式")})};

  const doCloudUpload=async()=>{
    if(!APPS_SCRIPT_URL){show("⚠️ 尚未設定雲端同步網址，請參考教學文件");return}
    setSyncing(true);
    try{
      const r1=await cloudUpload("PTW",records);
      const r2=await cloudUpload("Persons",persons);
      if(r1.error||r2.error){show("⚠️ 部分失敗: "+(r1.error||"")+" "+(r2.error||""))}
      else{show("☁️ 上傳成功！PTW "+records.length+" 筆, 人員 "+persons.length+" 筆")}
      setShowSync(false);
    }catch(e){show("❌ 上傳失敗: "+e.message)}
    finally{setSyncing(false)}
  };

  const doCloudDownload=async()=>{
    if(!APPS_SCRIPT_URL){show("⚠️ 尚未設定雲端同步網址，請參考教學文件");return}
    setSyncing(true);
    try{
      const r1=await cloudDownload("PTW");
      const r2=await cloudDownload("Persons");
      if(r1.error){throw new Error("PTW: "+r1.error)}
      if(r2.error){throw new Error("Persons: "+r2.error)}
      if(r1.success&&r1.data&&r1.data.length>0){const d=normalizeRecords(r1.data);setRecords(d);saveToLS(d)}
      if(r2.success&&r2.data&&r2.data.length>0){const d=normalizePersons(r2.data);setPersons(d);savePersonsLS(d)}
      show("☁️ 下載成功！PTW "+(r1.data?r1.data.length:0)+" 筆, 人員 "+(r2.data?r2.data.length:0)+" 筆");
      setShowSync(false);
    }catch(e){show("❌ 下載失敗: "+e.message)}
    finally{setSyncing(false)}
  };
  const doRestore=(snap)=>{askConfirm("確定還原到「"+snap.label+"」("+new Date(snap.time).toLocaleString("zh-TW")+") ？\n目前資料將被覆蓋。",()=>{setRecords(snap.data);show("✅ 已還原 "+snap.count+" 筆");setShowRestore(false)})};
  const doReset=()=>{askConfirm("確定要恢復初始資料？將清除所有修改。",()=>{setRecords(INIT);setPersons(PERSONS);show("已恢復初始資料")})};
  const chg=(f,v)=>setForm(p=>{
    const n={...p,[f]:v};
    if(f==="startDate"&&v){const d=new Date(v);d.setDate(d.getDate()+6);n.validDate=d.toISOString().slice(0,10)}
    return n;
  });
  const toggleCert=(cat)=>{
    setForm(p=>{
      if(p[cat.key]&&p[cat.key].trim())return{...p,[cat.key]:""};
      return{...p,[cat.key]:getNextCertNum(records,cat.key,cat.pre)};
    });
  };
  const submit=()=>{
    const reqFields=[["ptwNumber","許可號碼"],["applyCompany","申請公司"],["issuingPerson","發證人"],["issuingDate","發證日期"],["startDate","開始日期"],["applicant","申請人"],["holder","持有人"],["supervisor","工程師"],["ehs","環安衛"],["location","作業區域"],["workDescription","工作描述"]];
    const missing=reqFields.filter(([k])=>!form[k]||!form[k].trim()).map(([,l])=>l);
    if(missing.length){show("請填寫："+missing.join("、"),"err");return}
    const clean=({_locCustom,...rest})=>rest;
    if(editIdx!==null){setRecords(r=>r.map((x,i)=>i===editIdx?clean(form):x));setEditIdx(null);show("已更新")}
    else{setRecords(r=>[...r,{...clean(form),srNo:r.length}]);show("已新增")}
    setForm(empty);setView("table");
  };

  const filtered=useMemo(()=>{
    let r=records;
    if(filterCo)r=r.filter(x=>x.applyCompany===filterCo);
    if(search){const s=search.toLowerCase();r=r.filter(x=>[x.ptwNumber,x.applicant,x.holder,x.workDescription,x.location,x.ehs,x.supervisor].some(v=>(v||"").toLowerCase().includes(s)))}
    if(tblWeekOn){const pS2=s=>{const p=s.split("-").map(Number);return new Date(p[0],p[1]-1,p[2])};const ws=pS2(tblWkS);ws.setHours(0,0,0,0);const we=pS2(tblWkE);we.setHours(23,59,59,999);r=r.filter(x=>{if(!x.issuingDate)return false;const d=pS2(x.issuingDate);return d>=ws&&d<=we})}
    r=[...r].sort((a,b)=>ptwNum(b.ptwNumber)-ptwNum(a.ptwNumber));
    return r;
  },[records,filterCo,search,tblWeekOn,tblWkS,tblWkE]);

  const totalPages=Math.ceil(filtered.length/PER);
  const pageData=filtered.slice(page*PER,(page+1)*PER);
  const activeCerts=CATS.filter(x=>form[x.key]&&form[x.key].trim());

  return(
    <div style={{minHeight:"100vh",background:"linear-gradient(160deg,#0c1220,#111b2e,#0e1525)",fontFamily:"'Noto Sans TC','Segoe UI',sans-serif",color:"#e2e8f0"}}>
      {cloudLoading&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(12,18,32,0.92)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,padding:"0 20px"}}>
        <div className="ptw-loading-icon" style={{fontSize:40,marginBottom:16,animation:"spin 1.5s linear infinite"}}>☁️</div>
        <div className="ptw-loading-text" style={{fontSize:18,fontWeight:800,color:"#e2e8f0",marginBottom:8,textAlign:"center"}}>請稍待，表單同步中...</div>
        <div className="ptw-loading-sub" style={{fontSize:13,color:"#64748b",textAlign:"center"}}>正在從 Google Sheets 載入最新資料</div>
        <style>{`@keyframes spin{0%{transform:scale(1)}50%{transform:scale(1.2)}100%{transform:scale(1)}}`}</style>
      </div>}
      {toast&&<div className="no-print" style={{position:"fixed",top:20,left:"50%",transform:"translateX(-50%)",zIndex:999,padding:"10px 24px",borderRadius:10,background:toast.t==="err"?c.danger:c.success,color:"#fff",fontWeight:700,fontSize:13,boxShadow:"0 8px 32px rgba(0,0,0,.4)"}}>{toast.msg}</div>}

      <header className="no-print ptw-header" style={{background:c.card,borderBottom:"1px solid "+c.border,padding:"14px 28px",display:"flex",alignItems:"center",justifyContent:"space-between",position:"sticky",top:0,zIndex:50}}>
        <div className="ptw-logo-area" style={{display:"flex",alignItems:"center",gap:12}}>
          <div style={{display:"flex",alignItems:"center",gap:6}}>
            <img src={"data:image/png;base64,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"} style={{width:36,height:36,borderRadius:"50%"}}/>
            <img src={"data:image/png;base64,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"} style={{height:30}}/>
          </div>
          <div><div className="ptw-title-text" style={{fontSize:16,fontWeight:800}}>PTW Register</div><div className="ptw-sub-text" style={{fontSize:10,color:c.dim}}>工作許可紀錄表 — {records.length} records {isAuth?<span style={{color:c.success,fontWeight:700}}>🔓 編輯模式</span>:<span style={{color:"#94a3b8"}}>🔒 唯讀模式</span>}</div></div>
        </div>
        <nav className="ptw-nav" style={{display:"flex",gap:4,alignItems:"center"}}>
          {[{k:"dashboard",l:"儀表板",i:"📊"},{k:"form",l:"表單",i:"📝",auth:true},{k:"preview",l:"預覽",i:"👁",auth:true},{k:"table",l:"列表",i:"📋"},{k:"persons",l:"合格人員",i:"👤"}].filter(t=>!t.auth||isAuth).map(t=>
            <button key={t.k} onClick={()=>{setView(t.k);if(t.k==="table")setPage(0)}} style={{padding:"7px 16px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:view===t.k?700:500,background:view===t.k?c.accent:"transparent",color:view===t.k?"#0c1220":c.dim}}>{t.i} {t.l}</button>
          )}
          <div className="ptw-sep" style={{width:1,height:24,background:c.border,margin:"0 6px"}}/>
          <button onClick={doManualSync} disabled={cloudLoading} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:cloudLoading?"not-allowed":"pointer",fontSize:12,fontWeight:700,background:"#06b6d422",color:"#06b6d4",opacity:cloudLoading?0.5:1}}>🔄 同步表單</button>
          {isAuth&&<button onClick={doSave} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:700,background:"#34d39922",color:"#34d399"}}>💾 儲存</button>}
          {isAuth&&<button onClick={()=>setShowSync(true)} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:700,background:"#8b5cf622",color:"#a78bfa"}}>☁️ 雲端</button>}
          {isAuth&&<button onClick={()=>setShowRestore(true)} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:500,background:"transparent",color:c.dim}}>⏪ 還原</button>}
          <div className="ptw-sep" style={{width:1,height:24,background:c.border,margin:"0 6px"}}/>
          {isAuth?<button onClick={doLogout} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:700,background:c.danger+"22",color:c.danger}}>🔒 登出</button>
          :<button onClick={()=>{setShowLogin(true);setLoginErr("")}} style={{padding:"7px 14px",borderRadius:8,border:"none",cursor:"pointer",fontSize:12,fontWeight:700,background:c.accent+"22",color:c.accent}}>🔑 登入</button>}
        </nav>
      </header>

      <main className="no-print ptw-main" style={{maxWidth:1200,margin:"0 auto",padding:"24px 16px"}}>
        {view==="dashboard"&&<DashboardView records={records} persons={persons} c={c} isAuth={isAuth} onAdd={()=>{setForm({...empty,ptwNumber:getNextPTW(records)});setEditIdx(null);setView("form")}}/>}
        
        {view==="form"&&<div>
          {editIdx!==null&&<div style={{background:c.warn+"22",border:"1px solid "+c.warn+"55",borderRadius:10,padding:"8px 16px",marginBottom:16,fontSize:12,color:c.warn,fontWeight:600}}>✏️ 編輯 #{editIdx} — {form.ptwNumber}</div>}
          <Sec icon="📌" zh="基本資訊" en="Basic Information" color={c.accent}/>
          <div className="ptw-form-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:12,marginBottom:24}}>
            <Fld label="許可號碼 PTW Number" req><input value={form.ptwNumber} onChange={e=>chg("ptwNumber",e.target.value)} placeholder="PTW-001" style={iS}/></Fld>
            <Fld label="延續證號 Conti. PTW"><input value={form.contPtwNo} onChange={e=>chg("contPtwNo",e.target.value)} style={iS}/></Fld>
            <Fld label="申請公司 Company" req><select value={form.applyCompany} onChange={e=>chg("applyCompany",e.target.value)} style={iS}><option value="">-- 選擇 --</option>{COS.map(x=><option key={x}>{x}</option>)}</select></Fld>
            <Fld label="發證人 Issuing Person" req><input value={form.issuingPerson} onChange={e=>chg("issuingPerson",e.target.value)} style={iS}/></Fld>
          </div>
          <Sec icon="📅" zh="日期資訊" en="Dates" color="#a78bfa"/>
          <div className="ptw-form-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:12,marginBottom:24}}>
            <Fld label="發證日期 Issuing Date" req><input type="date" value={form.issuingDate} onChange={e=>chg("issuingDate",e.target.value)} style={iS}/></Fld>
            <Fld label="關閉日期 Closing Date"><input type="date" value={form.closingDate} onChange={e=>chg("closingDate",e.target.value)} style={iS}/></Fld>
            <Fld label="開始日期 Start Date" req><input type="date" value={form.startDate} onChange={e=>chg("startDate",e.target.value)} style={iS}/></Fld>
            <Fld label="到期日 Valid (自動+6天)"><input type="date" value={form.validDate} onChange={e=>chg("validDate",e.target.value)} style={{...iS,borderColor:c.accent+"66"}}/></Fld>
          </div>
          <Sec icon="👷" zh="人員資訊" en="Personnel" color="#f472b6"/>
          <div className="ptw-form-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(200px,1fr))",gap:12,marginBottom:24}}>
            <Fld label="申請人 Applicant" req><input value={form.applicant} onChange={e=>chg("applicant",e.target.value)} style={iS}/></Fld>
            <Fld label="持有人 Holder" req><input value={form.holder} onChange={e=>chg("holder",e.target.value)} style={iS}/></Fld>
            <Fld label="工程師 Supervisor" req><input value={form.supervisor} onChange={e=>chg("supervisor",e.target.value)} style={iS}/></Fld>
            <Fld label="環安衛 EHS" req><input value={form.ehs} onChange={e=>chg("ehs",e.target.value)} style={iS}/></Fld>
          </div>
          <Sec icon="🔧" zh="作業內容" en="Work Details" color="#fbbf24"/>
          <div className="ptw-chart-grid" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,marginBottom:12}}>
            <Fld label="作業區域 Location" req>{(()=>{
              const isPreset=LOCS.filter(l=>l!=="其他").includes(form.location);
              const selVal=isPreset?form.location:(form.location!==""||form._locCustom)?"其他":"";
              return<>
                <select value={selVal} onChange={e=>{if(e.target.value==="其他"){chg("location","");setForm(p=>({...p,_locCustom:true}))}else{chg("location",e.target.value);setForm(p=>({...p,_locCustom:false}))}}} style={iS}><option value="">-- 選擇 --</option>{LOCS.map(l=><option key={l}>{l}</option>)}</select>
                {selVal==="其他"&&<input value={form.location||""} onChange={e=>chg("location",e.target.value)} placeholder="請輸入自訂區域..." style={{...iS,marginTop:6,width:"100%"}}/>}
              </>
            })()}</Fld>
          </div>
          <div style={{marginBottom:24}}><Fld label="工作描述 Work Description" req><textarea value={form.workDescription} onChange={e=>chg("workDescription",e.target.value)} rows={3} style={{...iS,resize:"vertical",minHeight:64}}/></Fld></div>
          <Sec icon="📜" zh="額外證書" en="Certificates (勾選自動編號)" color="#34d399"/>
          <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(220px,1fr))",gap:10,marginBottom:28}}>
            {CATS.map(cat=>{
              const isOn=form[cat.key]&&form[cat.key].trim();
              return(
                <div key={cat.key} onClick={()=>toggleCert(cat)} style={{display:"flex",alignItems:"center",gap:10,padding:"12px 16px",borderRadius:10,border:"1px solid "+(isOn?"#34d39966":c.border),background:isOn?"#34d39912":c.input,cursor:"pointer",userSelect:"none"}}>
                  <div style={{width:22,height:22,borderRadius:6,border:"2px solid "+(isOn?"#34d399":c.border),background:isOn?"#34d399":"transparent",display:"flex",alignItems:"center",justifyContent:"center",fontSize:13,color:"#fff",fontWeight:900,flexShrink:0}}>{isOn?"✓":""}</div>
                  <div style={{flex:1}}>
                    <div style={{fontSize:12,fontWeight:700,color:isOn?"#34d399":c.dim}}>{cat.zh} {cat.en}</div>
                    {isOn&&<div style={{fontSize:12,fontWeight:800,color:"#34d399",marginTop:2,fontFamily:"'JetBrains Mono',monospace"}}>{form[cat.key]}</div>}
                  </div>
                </div>
              );
            })}
          </div>
          <div style={{display:"flex",gap:10,justifyContent:"flex-end",borderTop:"1px solid "+c.border,paddingTop:18}}>
            <button onClick={()=>{setForm({...empty,ptwNumber:getNextPTW(records)});setEditIdx(null)}} style={{padding:"10px 24px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:13}}>清除</button>
            <button onClick={()=>setView("preview")} style={{padding:"10px 24px",borderRadius:8,border:"1px solid "+c.accent+"44",background:c.accent+"15",color:c.accent,cursor:"pointer",fontSize:13}}>👁 預覽</button>
            {isAuth?<button onClick={submit} style={{padding:"10px 30px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:700}}>{editIdx!==null?"✏️ 更新":"💾 儲存"}</button>
            :<div style={{padding:"10px 20px",borderRadius:8,background:c.card,border:"1px solid "+c.border,color:c.dim,fontSize:12,fontWeight:600}}>🔒 請先登入以啟用編輯功能</div>}
          </div>
        </div>}

        {view==="preview"&&<PreviewView form={form} setView={setView} activeCerts={activeCerts} c={c}/>}

        {view==="table"&&(
          <div>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,flexWrap:"wrap",gap:10}}>
              <h2 style={{fontSize:18,fontWeight:800,margin:0}}>📋 紀錄列表 ({filtered.length}/{records.length}){tblWeekOn&&<span style={{fontSize:12,fontWeight:400,color:c.dim,marginLeft:8}}>{(()=>{const s=new Date(tblWkS.replace(/-/g,"/"));const e=new Date(tblWkE.replace(/-/g,"/"));const fR2=d=>d.toLocaleDateString("zh-TW",{month:"2-digit",day:"2-digit"});return fR2(s)+"("+tblDayNames[s.getDay()]+") ~ "+fR2(e)+"("+tblDayNames[e.getDay()]+")"})()}</span>}</h2>
              <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
                <input value={search} onChange={e=>{setSearch(e.target.value);setPage(0)}} placeholder="🔍 搜尋..." style={{...iS,width:160,padding:"7px 12px",fontSize:12}}/>
                <select value={filterCo} onChange={e=>{setFilterCo(e.target.value);setPage(0)}} style={{...iS,width:110,padding:"7px 10px",fontSize:12}}>
                  <option value="">全部公司</option>{COS.map(x=><option key={x}>{x}</option>)}
                </select>
                <button onClick={()=>setShowExport(true)} style={{padding:"8px 18px",borderRadius:8,border:"1px solid #34d39944",background:"#34d39915",color:"#34d399",cursor:"pointer",fontSize:12,fontWeight:700}}>🖨 輸出</button>
                {isAuth&&<button onClick={()=>{setForm({...empty,ptwNumber:getNextPTW(records)});setEditIdx(null);setView("form")}} style={{padding:"8px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:12,fontWeight:700}}>+ 新增</button>}
              </div>
            </div>
            <div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap",marginBottom:14}}>
              <button onClick={()=>{setTblWeekOn(!tblWeekOn);setPage(0)}} style={{padding:"5px 12px",borderRadius:6,border:"1px solid "+(tblWeekOn?c.accent+"88":c.border),background:tblWeekOn?c.accent+"18":"transparent",color:tblWeekOn?c.accent:c.dim,cursor:"pointer",fontSize:11,fontWeight:tblWeekOn?700:500}}>📅 {tblWeekOn?"週期篩選 ON":"週期篩選"}</button>
              {tblWeekOn&&<>
                <button onClick={()=>{tblQuickWeek(-1);setPage(0)}} style={{padding:"4px 10px",borderRadius:6,border:"1px solid #253552",background:"transparent",color:c.dim,cursor:"pointer",fontSize:11}}>◀ 上週</button>
                <input type="date" value={tblWkS} onChange={e=>{tblPickDate(e.target.value);setPage(0)}} style={{background:"#1a2744",border:"1px solid #253552",borderRadius:6,color:"#e2e8f0",padding:"5px 8px",fontSize:12}}/>
                <span style={{color:c.dim,fontSize:11}}>~</span>
                <input type="date" value={tblWkE} readOnly style={{background:"#1a2744",border:"1px solid #253552",borderRadius:6,color:"#e2e8f0",padding:"5px 8px",fontSize:12,opacity:.7,cursor:"default"}}/>
                <button onClick={()=>{tblQuickWeek(1);setPage(0)}} style={{padding:"4px 10px",borderRadius:6,border:"1px solid #253552",background:"transparent",color:c.dim,cursor:"pointer",fontSize:11}}>下週 ▶</button>
                <button onClick={()=>{tblQuickWeek(0);setPage(0)}} style={{padding:"4px 10px",borderRadius:6,border:"none",background:c.accent+"22",color:c.accent,cursor:"pointer",fontSize:11,fontWeight:700}}>本週</button>
              </>}
            </div>
            <div ref={topScrollRef} onScroll={()=>{if(tblScrollRef.current)syncScroll(topScrollRef.current,tblScrollRef.current)}} style={{overflowX:"auto",overflowY:"hidden",height:12,marginBottom:-1}}>
              <div className="tbl-scroll-spacer" style={{width:1100,height:1}}/>
            </div>
            <div ref={tblScrollRef} onScroll={()=>{if(topScrollRef.current)syncScroll(tblScrollRef.current,topScrollRef.current)}} className="ptw-table-wrap" style={{overflowX:"auto"}}>
            <table style={{width:"100%",minWidth:1100,borderCollapse:"separate",borderSpacing:"0 3px",fontSize:11,tableLayout:"fixed"}}>
              <colgroup>
                <col style={{width:28}}/>
                <col style={{width:62}}/>
                <col style={{width:32}}/>
                <col style={{width:50}}/>
                <col style={{width:62}}/>
                <col style={{width:62}}/>
                <col style={{width:62}}/>
                <col style={{width:62}}/>
                <col style={{width:48}}/>
                <col style={{width:60}}/>
                <col style={{width:80}}/>
                <col/>
                <col style={{width:62}}/>
                <col style={{width:78}}/>
              </colgroup>
              <thead><tr>
                {["#","PTW","延續","公司","發證日","開始日","到期日","關閉日","申請人","持有人","區域","工作描述","證書","操作"].map((h,hi)=>
                  <th key={h} className={[5,8,9].includes(hi)?"tbl-hide-m":""} style={{padding:"8px 5px",fontSize:10,fontWeight:700,color:c.dim,textAlign:"left",borderBottom:"1px solid "+c.border,whiteSpace:"nowrap"}}>{h}</th>
                )}
              </tr></thead>
              <tbody>{pageData.map((r,i)=>{
                const certs=CATS.filter(x=>r[x.key]&&r[x.key].trim()).map(x=>x.zh);
                const isOpen=!r.closingDate||r.closingDate.trim()==="";
                const isExpired=r.validDate&&new Date(r.validDate)<new Date();
                return(
                  <tr key={r.ptwNumber+i} style={{background:isOpen&&isExpired?c.danger+"08":c.card}}>
                    <td style={{...tdS,fontSize:10,color:c.dim}}>{r.srNo}</td>
                    <td style={tdS}><span style={{fontWeight:800,color:c.accent,fontFamily:"'JetBrains Mono',monospace",fontSize:11}}>{r.ptwNumber}</span></td>
                    <td style={{...tdS,fontSize:10,color:c.dim}}>{r.contPtwNo!=="-"?r.contPtwNo:""}</td>
                    <td style={tdS}><span style={{padding:"2px 5px",borderRadius:4,fontSize:9,fontWeight:700,background:c.accent+"18",color:c.accent,whiteSpace:"nowrap"}}>{r.applyCompany}</span></td>
                    <td style={{...tdS,fontSize:10,whiteSpace:"nowrap"}}>{fmtD(r.issuingDate)}</td>
                    <td className="tbl-hide-m" style={{...tdS,fontSize:10,whiteSpace:"nowrap"}}>{fmtD(r.startDate)}</td>
                    <td style={{...tdS,fontSize:10,whiteSpace:"nowrap",color:isOpen&&isExpired?c.danger:c.text,fontWeight:isOpen&&isExpired?700:400}}>{fmtD(r.validDate)}</td>
                    <td style={{...tdS,fontSize:10,whiteSpace:"nowrap"}}>{r.closingDate&&r.closingDate.trim()?<span style={{color:c.success,fontWeight:600}}>{fmtD(r.closingDate)}</span>:<span style={{color:c.danger,fontSize:9,fontWeight:700}}>未關閉</span>}</td>
                    <td className="tbl-hide-m" style={{...tdS,fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{r.applicant||"—"}</td>
                    <td className="tbl-hide-m" style={{...tdS,fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{r.holder||"—"}</td>
                    <td style={{...tdS,fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:1.4}}>{(r.location||"")}</td>
                    <td style={{...tdS,fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word",lineHeight:1.4}}>{r.workDescription||"—"}</td>
                    <td style={tdS}><div style={{display:"flex",gap:2,flexWrap:"wrap"}}>{certs.length?certs.map((x,j)=><span key={j} style={{fontSize:8,background:"#34d39918",color:"#34d399",padding:"1px 4px",borderRadius:3,whiteSpace:"nowrap"}}>{x}</span>):<span style={{color:c.dim,fontSize:9}}>—</span>}</div></td>
                    <td style={tdS}><div style={{display:"flex",gap:3,flexWrap:"nowrap"}}>
                      {isAuth&&<button onClick={()=>{setForm({...r});setEditIdx(records.findIndex(x=>x.ptwNumber===r.ptwNumber));setView("form")}} style={ab(c.accent)} title="編輯">✏️</button>}
                      {isAuth&&<button onClick={()=>{setForm({...r});setView("preview")}} style={ab("#a78bfa")} title="預覽">👁</button>}
                      {isAuth&&isOpen&&<button onClick={()=>{const ri=records.findIndex(x=>x.ptwNumber===r.ptwNumber);setClosingIdx(ri);setCloseDate(new Date().toISOString().slice(0,10))}} style={ab("#fbbf24")} title="關閉">🔒</button>}
                      {isAuth&&<button onClick={()=>askConfirm("確定刪除 "+r.ptwNumber+"？",()=>{setRecords(x=>x.filter(v=>v.ptwNumber!==r.ptwNumber));show("已刪除 "+r.ptwNumber)})} style={ab(c.danger)} title="刪除">🗑</button>}
                    </div></td>
                  </tr>
                )})}</tbody>
            </table>
            </div>
            {totalPages>1&&<div style={{display:"flex",justifyContent:"center",gap:6,marginTop:16,alignItems:"center"}}>
              <button onClick={()=>setPage(p=>Math.max(0,p-1))} disabled={page===0} style={{...pgB,opacity:page===0?.4:1}}>◀</button>
              <span style={{fontSize:11,color:c.dim,padding:"0 8px"}}>第 {page+1}/{totalPages} 頁</span>
              <button onClick={()=>setPage(p=>Math.min(totalPages-1,p+1))} disabled={page>=totalPages-1} style={{...pgB,opacity:page>=totalPages-1?.4:1}}>▶</button>
            </div>}
          </div>
        )}

        {view==="persons"&&<PersonnelView persons={persons} setPersons={setPersons} c={c} show={show} askConfirm={askConfirm} isAuth={isAuth}/>}
      </main>

      {showExport&&<ExportModal records={records} onClose={()=>setShowExport(false)}/>}
      {closingIdx!==null&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999}} onClick={()=>setClosingIdx(null)}>
        <div style={{background:c.card,borderRadius:16,padding:"28px 32px",border:"1px solid "+c.border,minWidth:320,maxWidth:400}} onClick={e=>e.stopPropagation()}>
          <div style={{fontSize:16,fontWeight:800,marginBottom:6}}>🔒 關閉 PTW</div>
          <div style={{fontSize:13,color:c.accent,fontWeight:700,marginBottom:16}}>{records[closingIdx]?.ptwNumber} — {records[closingIdx]?.applyCompany}</div>
          <div style={{fontSize:12,color:c.dim,marginBottom:6}}>請選擇關閉日期：</div>
          <input type="date" value={closeDate} onChange={e=>setCloseDate(e.target.value)} style={{...iS,width:"100%",padding:"10px 14px",fontSize:14,marginBottom:18}}/>
          <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
            <button onClick={()=>setClosingIdx(null)} style={{padding:"9px 20px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:13}}>取消</button>
            <button onClick={()=>{if(!closeDate){show("請選擇日期","err");return}setRecords(prev=>prev.map((r,i)=>i===closingIdx?{...r,closingDate:closeDate}:r));show("✅ 已關閉 "+records[closingIdx]?.ptwNumber);setClosingIdx(null)}} style={{padding:"9px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#34d399,#38bdf8)",color:"#fff",cursor:"pointer",fontSize:13,fontWeight:700}}>確認關閉</button>
          </div>
        </div>
      </div>}

      {confirmDlg&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1000}} onClick={()=>setConfirmDlg(null)}>
        <div style={{background:c.card,borderRadius:16,padding:"28px 32px",border:"1px solid "+c.border,minWidth:320,maxWidth:420}} onClick={e=>e.stopPropagation()}>
          <div style={{fontSize:15,fontWeight:700,marginBottom:16,whiteSpace:"pre-wrap",lineHeight:1.5}}>{confirmDlg.msg}</div>
          <div style={{display:"flex",gap:10,justifyContent:"flex-end"}}>
            <button onClick={()=>setConfirmDlg(null)} style={{padding:"9px 20px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:13}}>取消</button>
            <button onClick={()=>{confirmDlg.onYes();setConfirmDlg(null)}} style={{padding:"9px 20px",borderRadius:8,border:"none",background:c.danger,color:"#fff",cursor:"pointer",fontSize:13,fontWeight:700}}>確定</button>
          </div>
        </div>
      </div>}

      {showLogin&&<LoginModal c={c} loginErr={loginErr} doLogin={doLogin} onClose={()=>setShowLogin(false)}/>}

      {showSync&&<div className="modal-overlay" onClick={e=>{if(e.target===e.currentTarget)setShowSync(false)}}>
        <div style={{background:"#141e30",borderRadius:16,border:"1px solid #253552",padding:"28px 32px",maxWidth:420,width:"92vw",boxShadow:"0 20px 60px rgba(0,0,0,.6)"}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:20}}>
            <h3 style={{fontSize:18,fontWeight:900,margin:0}}>☁️ 雲端同步 Cloud Sync</h3>
            <button onClick={()=>setShowSync(false)} style={{width:32,height:32,borderRadius:8,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:16}}>✕</button>
          </div>
          
          <div style={{background:APPS_SCRIPT_URL?"#34d39915":"#f8717115",borderRadius:10,padding:"12px 16px",marginBottom:20,fontSize:12,border:"1px solid "+(APPS_SCRIPT_URL?"#34d39933":"#f8717133")}}>
            {APPS_SCRIPT_URL
              ?<span style={{color:"#34d399"}}>✅ 已連接 Google Sheets</span>
              :<span style={{color:"#f87171"}}>❌ 尚未設定 API 網址，請參考教學文件修改 HTML 中的 <code style={{background:"#0f1a2e",padding:"2px 6px",borderRadius:4}}>APPS_SCRIPT_URL</code></span>
            }
          </div>

          <div style={{background:"#0f1a2e",borderRadius:10,padding:"14px 16px",marginBottom:12,fontSize:12,color:"#94a3b8"}}>
            📊 本機資料：<strong style={{color:"#38bdf8"}}>{records.length}</strong> 筆 PTW + <strong style={{color:"#a78bfa"}}>{persons.length}</strong> 位人員
          </div>

          <div style={{display:"flex",flexDirection:"column",gap:10,marginBottom:20}}>
            <button onClick={doCloudUpload} disabled={syncing||!APPS_SCRIPT_URL} style={{padding:"14px 20px",borderRadius:10,border:"none",background:syncing?"#253552":"linear-gradient(135deg,#34d399,#38bdf8)",color:syncing?"#94a3b8":"#0c1220",cursor:syncing||!APPS_SCRIPT_URL?"not-allowed":"pointer",fontSize:14,fontWeight:800,opacity:APPS_SCRIPT_URL?1:0.4}}>
              {syncing?"⏳ 同步中...":"⬆ 上傳到雲端"}
            </button>
            <div style={{fontSize:11,color:"#64748b",textAlign:"center",marginTop:-6}}>本機資料 → 覆蓋 Google Sheets</div>
            
            <button onClick={doCloudDownload} disabled={syncing||!APPS_SCRIPT_URL} style={{padding:"14px 20px",borderRadius:10,border:"1px solid #253552",background:syncing?"#253552":"transparent",color:syncing?"#94a3b8":"#e2e8f0",cursor:syncing||!APPS_SCRIPT_URL?"not-allowed":"pointer",fontSize:14,fontWeight:700,opacity:APPS_SCRIPT_URL?1:0.4}}>
              {syncing?"⏳ 同步中...":"⬇ 從雲端下載"}
            </button>
            <div style={{fontSize:11,color:"#64748b",textAlign:"center",marginTop:-6}}>Google Sheets → 覆蓋本機資料</div>
          </div>

          <div style={{fontSize:11,color:"#475569",background:"#0f1a2e",borderRadius:8,padding:"10px 14px",lineHeight:1.6}}>
            💡 <strong>使用建議：</strong>編輯完按「⬆ 上傳」，換電腦時按「⬇ 下載」
          </div>
        </div>
      </div>}

      {showRestore&&<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:999}} onClick={()=>setShowRestore(false)}>
        <div style={{background:c.card,borderRadius:16,padding:"28px 32px",border:"1px solid "+c.border,minWidth:400,maxWidth:520,maxHeight:"80vh",overflowY:"auto"}} onClick={e=>e.stopPropagation()}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
            <div style={{fontSize:16,fontWeight:800}}>⏪ 還原資料</div>
            <button onClick={()=>setShowRestore(false)} style={{width:28,height:28,borderRadius:6,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:14}}>✕</button>
          </div>
          <div style={{fontSize:11,color:c.dim,marginBottom:16}}>選擇一個儲存點還原，目前資料將被覆蓋。</div>
          {(()=>{const snaps=loadSnapshots();return snaps.length?<div style={{display:"flex",flexDirection:"column",gap:6}}>
            {snaps.map((s,i)=>{const t=new Date(s.time);return(
              <div key={i} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 14px",borderRadius:8,border:"1px solid "+c.border,background:c.input}}>
                <div>
                  <div style={{fontSize:12,fontWeight:700}}>{s.label||"儲存"}</div>
                  <div style={{fontSize:10,color:c.dim,marginTop:2}}>{t.toLocaleDateString("zh-TW")} {t.toLocaleTimeString("zh-TW")} — {s.count} 筆</div>
                </div>
                <button onClick={()=>doRestore(s)} style={{padding:"6px 14px",borderRadius:6,border:"none",background:c.accent+"22",color:c.accent,cursor:"pointer",fontSize:11,fontWeight:700}}>還原</button>
              </div>
            )})}
          </div>:<div style={{textAlign:"center",padding:20,color:c.dim,fontSize:12}}>尚無儲存紀錄，請先點擊「💾 儲存」建立還原點</div>})()}
          <div style={{borderTop:"1px solid "+c.border,marginTop:16,paddingTop:16,display:"flex",justifyContent:"space-between"}}>
            <button onClick={doReset} style={{padding:"8px 16px",borderRadius:8,border:"1px solid "+c.danger+"44",background:c.danger+"11",color:c.danger,cursor:"pointer",fontSize:11,fontWeight:700}}>🔄 恢復初始資料</button>
            <button onClick={()=>setShowRestore(false)} style={{padding:"8px 20px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:12}}>關閉</button>
          </div>
        </div>
      </div>}
    </div>
  );
}

const tdS={padding:"8px 6px",borderTop:"1px solid #25355222",borderBottom:"1px solid #25355222",verticalAlign:"top"};
const ab=(color)=>({width:26,height:26,borderRadius:6,border:"1px solid "+color+"33",background:color+"11",cursor:"pointer",fontSize:11,display:"flex",alignItems:"center",justifyContent:"center"});
const pgB={padding:"6px 14px",borderRadius:6,border:"1px solid #253552",background:"transparent",color:"#94a3b8",cursor:"pointer",fontSize:12,fontWeight:600};

/* ============================================================ */
/*  DASHBOARD                                                    */
/* ============================================================ */
function DashboardView({records,persons,c,isAuth,onAdd}){
  const today=new Date();
  const dow=today.getDay();
  const satOff=dow>=6?0:-(dow+1);
  const defS=new Date(today.getFullYear(),today.getMonth(),today.getDate()+satOff);
  const defE=new Date(defS.getFullYear(),defS.getMonth(),defS.getDate()+6,23,59,59,999);
  const fmt2=d=>{const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,"0"),dd=String(d.getDate()).padStart(2,"0");return y+"-"+m+"-"+dd};
  const [customS,setCustomS]=useState(fmt2(defS));
  const [customE,setCustomE]=useState(fmt2(defE));
  const [dashCo,setDashCo]=useState("");
  const [dashStatus,setDashStatus]=useState("");
  const pS=(s)=>{if(!s||typeof s!=="string"||!s.trim())return new Date(NaN);const p=s.split("-").map(Number);if(p.length<3||isNaN(p[0]))return new Date(NaN);return new Date(p[0],p[1]-1,p[2])};
  const wkS=pS(customS);wkS.setHours(0,0,0,0);
  const wkE=pS(customE);wkE.setHours(23,59,59,999);
  const fR=(d)=>d.toLocaleDateString("zh-TW",{month:"2-digit",day:"2-digit"});
  const dayNames=["日","一","二","三","四","五","六"];
  const wkSDay=dayNames[wkS.getDay()];
  const wkEDay=dayNames[wkE.getDay()];
  const iS2={background:"#1a2744",border:"1px solid #253552",borderRadius:6,color:"#e2e8f0",padding:"5px 8px",fontSize:12};
  const snapToSat=(d)=>{const p=d.split("-").map(Number);const dt=new Date(p[0],p[1]-1,p[2]);const dw=dt.getDay();const off=dw>=6?0:-(dw+1);dt.setDate(dt.getDate()+off);return dt};
  const quickWeek=(offset)=>{if(offset===0){setCustomS(fmt2(defS));setCustomE(fmt2(defE));return}const cur=snapToSat(customS);cur.setDate(cur.getDate()+offset*7);const e=new Date(cur.getFullYear(),cur.getMonth(),cur.getDate()+6);setCustomS(fmt2(cur));setCustomE(fmt2(e))};
  const onPickDate=(val)=>{const s=snapToSat(val);const e=new Date(s.getFullYear(),s.getMonth(),s.getDate()+6);setCustomS(fmt2(s));setCustomE(fmt2(e))};

  const td=new Date(today.getFullYear(),today.getMonth(),today.getDate());
  const baseRecords=records.filter(r=>{
    if(dashCo&&r.applyCompany!==dashCo)return false;
    if(dashStatus==="open"&&r.closingDate&&r.closingDate.trim()!=="")return false;
    if(dashStatus==="closed"&&(!r.closingDate||r.closingDate.trim()===""))return false;
    if(dashStatus==="expired"){const isOpen=!r.closingDate||r.closingDate.trim()==="";const isExp=r.validDate&&pS(r.validDate)<td;if(!(isOpen&&isExp))return false}
    return true;
  });
  const periodRecords=baseRecords.filter(r=>{if(!r.issuingDate)return false;const d=pS(r.issuingDate);return d>=wkS&&d<=wkE});
  const cumRecords=baseRecords.filter(r=>{if(!r.issuingDate)return false;return pS(r.issuingDate)<=wkE});
  const unclosed=cumRecords.filter(r=>!r.closingDate||r.closingDate.trim()==="");
  const unclosedExpired=unclosed.filter(r=>r.validDate&&pS(r.validDate)<td);
  const unclosedActive=unclosed.filter(r=>!r.validDate||pS(r.validDate)>=td);
  const activeV=cumRecords.filter(r=>{if(!r.validDate)return false;return pS(r.validDate)>=td});

  const coC={};cumRecords.forEach(r=>{coC[r.applyCompany]=(coC[r.applyCompany]||0)+1});
  const coArr=Object.entries(coC).sort((a,b)=>b[1]-a[1]);
  const maxCo=coArr.length?coArr[0][1]:1;
  const ucByCo={};unclosed.forEach(r=>{ucByCo[r.applyCompany]=(ucByCo[r.applyCompany]||0)+1});

  const certC={};CATS.forEach(x=>{certC[x.zh]=cumRecords.filter(r=>r[x.key]&&r[x.key].trim()).length});
  const certArr=Object.entries(certC).sort((a,b)=>b[1]-a[1]);
  const maxCert=certArr.length?certArr[0][1]:1;

  const kpi=(icon,label,val,color,sub)=>(
    <div className="ptw-kpi-card" style={{background:c.card,borderRadius:14,border:"1px solid "+c.border,padding:"20px 22px",position:"relative",overflow:"hidden"}}>
      <div className="ptw-kpi-icon" style={{position:"absolute",top:-10,right:-10,fontSize:50,opacity:.06}}>{icon}</div>
      <div className="ptw-kpi-label" style={{fontSize:11,color:c.dim,fontWeight:600,marginBottom:6}}>{label}</div>
      <div className="ptw-kpi-val" style={{fontSize:32,fontWeight:900,color,lineHeight:1}}>{val}</div>
      {sub&&<div className="ptw-kpi-sub" style={{fontSize:10,color:c.dim,marginTop:6}}>{sub}</div>}
    </div>
  );
  const barC=["#38bdf8","#6366f1","#f472b6","#fbbf24","#34d399","#f87171","#a78bfa","#fb923c","#22d3ee"];

  return(<div>
    <div className="ptw-dash-header" style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20,flexWrap:"wrap",gap:12}}>
      <div><h2 style={{fontSize:20,fontWeight:900,margin:0}}>📊 儀表板 Dashboard</h2><div style={{fontSize:11,color:c.dim,marginTop:4}}>統計區間 {fR(wkS)}({wkSDay}) ~ {fR(wkE)}({wkEDay}) | 累計 {cumRecords.length} 筆 | 區間新增 {periodRecords.length} 筆{(dashCo||dashStatus)?<span style={{color:c.warn}}> (已篩選)</span>:""}</div></div>
      <div className="ptw-dash-controls" style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}>
        <button onClick={()=>quickWeek(-1)} style={{padding:"4px 10px",borderRadius:6,border:"1px solid #253552",background:"transparent",color:c.dim,cursor:"pointer",fontSize:11}}>◀ 上週</button>
        <input type="date" value={customS} onChange={e=>onPickDate(e.target.value)} style={iS2}/>
        <span style={{color:c.dim,fontSize:11}}>~</span>
        <input type="date" value={customE} readOnly style={{...iS2,opacity:.7,cursor:"default"}}/>
        <button onClick={()=>quickWeek(1)} style={{padding:"4px 10px",borderRadius:6,border:"1px solid #253552",background:"transparent",color:c.dim,cursor:"pointer",fontSize:11}}>下週 ▶</button>
        <button onClick={()=>quickWeek(0)} style={{padding:"4px 10px",borderRadius:6,border:"none",background:c.accent+"22",color:c.accent,cursor:"pointer",fontSize:11,fontWeight:700}}>本週</button>
        {isAuth&&<button onClick={onAdd} style={{padding:"6px 16px",borderRadius:8,border:"none",background:"linear-gradient(135deg,#38bdf8,#6366f1)",color:"#fff",cursor:"pointer",fontSize:11,fontWeight:700}}>+ 新增</button>}
      </div>
    </div>
    <div className="ptw-dash-filter" style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap",marginBottom:16}}>
      <span style={{fontSize:11,color:c.dim,fontWeight:600}}>🔍 篩選：</span>
      <select value={dashCo} onChange={e=>setDashCo(e.target.value)} style={{...iS2,width:120,padding:"5px 8px",fontSize:11}}>
        <option value="">全部公司</option>{COS.map(x=><option key={x}>{x}</option>)}
      </select>
      <select value={dashStatus} onChange={e=>setDashStatus(e.target.value)} style={{...iS2,width:120,padding:"5px 8px",fontSize:11}}>
        <option value="">全部狀態</option>
        <option value="open">未關閉</option>
        <option value="closed">已關閉</option>
        <option value="expired">逾期未關</option>
      </select>
      {(dashCo||dashStatus)&&<button onClick={()=>{setDashCo("");setDashStatus("")}} style={{padding:"4px 12px",borderRadius:6,border:"1px solid "+c.danger+"44",background:c.danger+"11",color:c.danger,cursor:"pointer",fontSize:11}}>✕ 清除篩選</button>}
    </div>
    <div className="ptw-kpi-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(190px,1fr))",gap:14,marginBottom:24}}>
      {kpi("📋","累計許可 Total",cumRecords.length,c.accent,"專案開始至 "+fR(td)+" 已發證")}
      {kpi("🆕","區間新增 Period",periodRecords.length,"#6366f1",fR(wkS)+"("+wkSDay+")~"+fR(wkE)+"("+wkEDay+")")}
      {kpi("🔓","尚未關閉 Unclosed",unclosed.length,unclosed.length>0?"#fbbf24":c.success,"逾期 "+unclosedExpired.length+" / 未逾期 "+unclosedActive.length)}
      {kpi("⚠️","逾期未關 Overdue",unclosedExpired.length,unclosedExpired.length>0?c.danger:c.success,unclosedExpired.length>0?"以今日判斷，到期日已過":"無逾期")}
      {kpi("✅","仍在效期 Active",activeV.length,"#34d399","以今日判斷，到期日 ≥ 今天")}
      {(()=>{const matchCos=dashCo?getPersonCos(dashCo):null;const fp=persons?matchCos?persons.filter(p=>matchCos.includes(p.company)):persons:[];const totalP=fp.length;const issP=fp.filter(p=>p.unit==="Issuing").length;const perfP=fp.filter(p=>p.unit==="Performing").length;return kpi("👤","合格人員 Personnel",totalP,"#a78bfa","Issuing "+issP+" / Performing "+perfP+(dashCo?" ("+dashCo+")":""))})()}
      {(()=>{if(!persons)return null;const matchCos=dashCo?getPersonCos(dashCo):null;const fp=matchCos?persons.filter(p=>matchCos.includes(p.company)):persons;const newP=fp.filter(p=>{if(!p.trainedDate)return false;const td2=pS(p.trainedDate);return td2>=wkS&&td2<=wkE});return kpi("🎓","本週新增訓練 Trained",newP.length,"#fb923c",newP.length>0?newP.map(p=>p.person).slice(0,5).join("、")+(newP.length>5?"...":""):"本週無新增")})()}
    </div>
    <div className="ptw-chart-grid" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24}}>
      <div className="ptw-chart-card" style={{background:c.card,borderRadius:14,border:"1px solid "+c.border,padding:"18px 22px"}}>
        <div style={{fontSize:13,fontWeight:800,marginBottom:14}}>🏢 各公司許可數</div>
        <div style={{display:"flex",flexDirection:"column",gap:8}}>
          {coArr.map(([co,n],i)=>(
            <div key={co} style={{display:"flex",alignItems:"center",gap:10}}>
              <div style={{width:55,fontSize:11,fontWeight:700,textAlign:"right"}}>{co}</div>
              <div style={{flex:1,height:22,background:c.input,borderRadius:6,overflow:"hidden",position:"relative"}}>
                <div style={{width:(n/maxCo*100)+"%",height:"100%",background:"linear-gradient(90deg,"+barC[i%barC.length]+"cc,"+barC[i%barC.length]+"55)",borderRadius:6}}/>
                <span style={{position:"absolute",right:8,top:3,fontSize:10,fontWeight:700}}>{n}</span>
              </div>
              {ucByCo[co]&&<span style={{fontSize:9,padding:"2px 6px",borderRadius:4,background:c.danger+"22",color:c.danger,fontWeight:700,whiteSpace:"nowrap"}}>未關{ucByCo[co]}</span>}
            </div>
          ))}
        </div>
      </div>
      <div className="ptw-chart-card" style={{background:c.card,borderRadius:14,border:"1px solid "+c.border,padding:"18px 22px"}}>
        <div style={{fontSize:13,fontWeight:800,marginBottom:14}}>📜 證書類別統計</div>
        <div style={{display:"flex",flexDirection:"column",gap:8}}>
          {certArr.map(([cert,n])=>(
            <div key={cert} style={{display:"flex",alignItems:"center",gap:10}}>
              <div style={{width:65,fontSize:11,fontWeight:700,textAlign:"right"}}>{cert}</div>
              <div style={{flex:1,height:22,background:c.input,borderRadius:6,overflow:"hidden",position:"relative"}}>
                <div style={{width:(n/maxCert*100)+"%",height:"100%",background:"linear-gradient(90deg,#34d399cc,#34d39955)",borderRadius:6}}/>
                <span style={{position:"absolute",right:8,top:3,fontSize:10,fontWeight:700}}>{n}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
    {unclosed.length>0&&<div className="ptw-chart-grid ptw-unclosed-grid" style={{display:"grid",gridTemplateColumns:unclosedExpired.length>0&&unclosedActive.length>0?"1fr 1fr":"1fr",gap:16,marginBottom:24}}>
      {unclosedExpired.length>0&&<div style={{background:c.card,borderRadius:14,border:"1px solid "+c.danger+"44",padding:"18px 22px",overflowX:"auto"}}>
        <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14}}>
          <span style={{display:"inline-block",width:8,height:8,borderRadius:4,background:c.danger}}/>
          <span style={{fontSize:13,fontWeight:800}}>逾期未關 Overdue</span>
          <span style={{fontSize:12,color:c.danger,fontWeight:700}}>({unclosedExpired.length})</span>
        </div>
        <table style={{width:"100%",minWidth:500,borderCollapse:"separate",borderSpacing:"0 3px",fontSize:12}}>
          <thead><tr>{["PTW No.","公司","到期日","區域","描述"].map(h=><th key={h} style={{padding:"6px 8px",fontSize:10,fontWeight:700,color:c.dim,textAlign:"left",borderBottom:"1px solid "+c.border}}>{h}</th>)}</tr></thead>
          <tbody>{unclosedExpired.map((r,i)=>(
            <tr key={r.ptwNumber+i} style={{background:i%2===0?c.danger+"08":"transparent"}}>
              <td style={{padding:"7px 8px"}}><span style={{fontWeight:800,color:c.danger,fontFamily:"'JetBrains Mono',monospace",fontSize:11}}>{r.ptwNumber}</span></td>
              <td style={{padding:"7px 8px"}}><span style={{padding:"2px 6px",borderRadius:4,fontSize:10,fontWeight:700,background:c.accent+"18",color:c.accent}}>{r.applyCompany}</span></td>
              <td style={{padding:"7px 8px",fontSize:11}}><span style={{background:c.danger,color:"#fff",padding:"2px 8px",borderRadius:4,fontWeight:700}}>{fmtD(r.validDate)}</span></td>
              <td style={{padding:"7px 8px",fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{(r.location||"")}</td>
              <td style={{padding:"7px 8px",fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{r.workDescription||"—"}</td>
            </tr>
          ))}</tbody>
        </table>
      </div>}
      {unclosedActive.length>0&&<div style={{background:c.card,borderRadius:14,border:"1px solid "+c.success+"44",padding:"18px 22px",overflowX:"auto"}}>
        <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:14}}>
          <span style={{display:"inline-block",width:8,height:8,borderRadius:4,background:c.success}}/>
          <span style={{fontSize:13,fontWeight:800}}>未逾期 Still Valid</span>
          <span style={{fontSize:12,color:c.success,fontWeight:700}}>({unclosedActive.length})</span>
        </div>
        <table style={{width:"100%",minWidth:500,borderCollapse:"separate",borderSpacing:"0 3px",fontSize:12}}>
          <thead><tr>{["PTW No.","公司","到期日","區域","描述"].map(h=><th key={h} style={{padding:"6px 8px",fontSize:10,fontWeight:700,color:c.dim,textAlign:"left",borderBottom:"1px solid "+c.border}}>{h}</th>)}</tr></thead>
          <tbody>{unclosedActive.map((r,i)=>(
            <tr key={r.ptwNumber+i} style={{background:i%2===0?c.success+"08":"transparent"}}>
              <td style={{padding:"7px 8px"}}><span style={{fontWeight:800,color:c.success,fontFamily:"'JetBrains Mono',monospace",fontSize:11}}>{r.ptwNumber}</span></td>
              <td style={{padding:"7px 8px"}}><span style={{padding:"2px 6px",borderRadius:4,fontSize:10,fontWeight:700,background:c.accent+"18",color:c.accent}}>{r.applyCompany}</span></td>
              <td style={{padding:"7px 8px",fontSize:11}}><span style={{color:c.success,fontWeight:700}}>{fmtD(r.validDate)}</span></td>
              <td style={{padding:"7px 8px",fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{(r.location||"")}</td>
              <td style={{padding:"7px 8px",fontSize:10,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{r.workDescription||"—"}</td>
            </tr>
          ))}</tbody>
        </table>
      </div>}
    </div>}
    {periodRecords.length>0&&<div style={{background:c.card,borderRadius:14,border:"1px solid "+c.border,padding:"18px 22px"}}>
      <div style={{fontSize:13,fontWeight:800,marginBottom:14}}>🆕 區間新增 <span style={{color:"#6366f1"}}>({periodRecords.length})</span> <span style={{fontSize:10,color:c.dim,fontWeight:400}}>{fR(wkS)}({wkSDay}) ~ {fR(wkE)}({wkEDay})</span></div>
      <div style={{display:"flex",flexWrap:"wrap",gap:8}}>{periodRecords.map((r,i)=>(
        <div key={r.ptwNumber+i} style={{background:c.input,border:"1px solid "+c.border,borderRadius:10,padding:"10px 14px",minWidth:200,flex:"1 1 200px",maxWidth:300}}>
          <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
            <span style={{fontWeight:800,color:c.accent,fontSize:13}}>{r.ptwNumber}</span>
            <span style={{padding:"2px 6px",borderRadius:4,fontSize:9,fontWeight:700,background:c.accent+"18",color:c.accent}}>{r.applyCompany}</span>
          </div>
          <div style={{fontSize:11,color:c.dim,marginBottom:3}}>📅 {fmtD(r.issuingDate)} → {fmtD(r.validDate)}</div>
          <div style={{fontSize:11,whiteSpace:"pre-wrap",wordBreak:"break-word"}}>{r.workDescription||"—"}</div>
        </div>
      ))}</div>
    </div>}
  </div>);
}

/* ============================================================ */
/*  PREVIEW                                                      */
/* ============================================================ */
function PreviewView({form,setView,activeCerts,c}){
  return(<div>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16}}>
      <h2 style={{fontSize:18,fontWeight:800,margin:0}}>👁 預覽</h2>
      <button onClick={()=>setView("form")} style={{padding:"7px 18px",borderRadius:8,border:"1px solid "+c.border,background:"transparent",color:c.dim,cursor:"pointer",fontSize:12}}>← 返回表單</button>
    </div>
    <div style={{background:c.card,borderRadius:14,border:"1px solid "+c.border,overflow:"hidden"}}>
      <div style={{background:"linear-gradient(135deg,"+c.accent+"22,#6366f122)",padding:"18px 24px",borderBottom:"1px solid "+c.border,display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div><div style={{fontSize:20,fontWeight:900,color:c.accent}}>{form.ptwNumber||"PTW-___"}</div><div style={{fontSize:11,color:c.dim,marginTop:3}}>工作許可紀錄表</div></div>
        <div style={{display:"flex",gap:6}}>{form.applyCompany&&<span style={{padding:"3px 10px",borderRadius:6,fontSize:11,fontWeight:700,background:c.accent+"22",color:c.accent}}>{form.applyCompany}</span>}</div>
      </div>
      <div style={{padding:"20px 24px"}}>
        <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20}}>
          {[["發證日期","📅",form.issuingDate],["關閉日期","🔒",form.closingDate],["開始日期","▶️",form.startDate],["到期日","⏰",form.validDate]].map(([l,i,v])=>
            <div key={l} style={{background:c.input,borderRadius:8,padding:"10px 14px",border:"1px solid "+c.border}}><div style={{fontSize:10,color:c.dim}}>{i} {l}</div><div style={{fontSize:13,fontWeight:700,marginTop:3}}>{fmtD(v)}</div></div>
          )}
        </div>
        <div style={{display:"grid",gridTemplateColumns:"repeat(4,1fr)",gap:12,marginBottom:20}}>
          {[["申請人","👤",form.applicant],["持有人","🪪",form.holder],["工程師","👷",form.supervisor],["環安衛","🛡",form.ehs]].map(([l,i,v])=>
            <div key={l} style={{background:c.input,borderRadius:8,padding:"10px 14px",border:"1px solid "+c.border}}><div style={{fontSize:10,color:c.dim}}>{i} {l}</div><div style={{fontSize:13,fontWeight:700,marginTop:3}}>{v||"—"}</div></div>
          )}
        </div>
        <div style={{display:"grid",gridTemplateColumns:"1fr 2fr",gap:12,marginBottom:20}}>
          <div style={{background:c.input,borderRadius:8,padding:"10px 14px",border:"1px solid "+c.border}}><div style={{fontSize:10,color:c.dim}}>📍 區域</div><div style={{fontSize:13,fontWeight:700,marginTop:3}}>{form.location||"—"}</div></div>
          <div style={{background:c.input,borderRadius:8,padding:"10px 14px",border:"1px solid "+c.border}}><div style={{fontSize:10,color:c.dim}}>📝 描述</div><div style={{fontSize:13,fontWeight:700,marginTop:3}}>{form.workDescription||"—"}</div></div>
        </div>
        {form.contPtwNo&&form.contPtwNo!=="-"&&<div style={{background:c.warn+"11",border:"1px solid "+c.warn+"33",borderRadius:8,padding:"8px 14px",marginBottom:16,fontSize:12,color:c.warn}}>🔗 延續自: <strong>{form.contPtwNo}</strong></div>}
        {activeCerts.length>0&&<div><div style={{fontSize:11,fontWeight:700,color:c.dim,marginBottom:8}}>📜 額外證書</div>
          <div style={{display:"flex",flexWrap:"wrap",gap:6}}>{activeCerts.map(x=><div key={x.key} style={{background:"#34d39915",border:"1px solid #34d39933",borderRadius:6,padding:"6px 12px",fontSize:12}}><span style={{color:c.dim,fontSize:10}}>{x.zh}</span><div style={{fontWeight:700,color:"#34d399",marginTop:1}}>{form[x.key]}</div></div>)}</div>
        </div>}
      </div>
    </div>
  </div>);
}

ReactDOM.render(<App/>, document.getElementById("root"));
</script>
</body>
</html>